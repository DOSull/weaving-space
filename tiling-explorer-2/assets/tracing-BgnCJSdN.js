const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-C74t2X8O.js","./VegaLite-CiR6mhYL.js","./index-DZa9A1hR.js","./index-4fhpeWoJ.css","./compile-D94gq43r.js","./time-07eAHjQO.js","./timer-DFzT7np-.js","./linear-CfYsspmS.js","./init-DLRA0X12.js","./range-CtcPcB_L.js","./zoom-COrs4lFh.js","./ordinal-DDUp3AbE.js","./colors-bszWmPJw.js","./arc-Cuwikxov.js","./step-BwsUM5iJ.js","./index-CYaSGB0o.js"])))=>i.map(i=>d[i]);
import{m as e,H as s,M as t,af as a,ab as l,K as r,P as n,R as i,ag as c,ah as o,ai as d,aj as m,ac as p,ak as u,al as h,am as x,an as g,ao as j}from"./index-DZa9A1hR.js";import{P as f,C as v,f as y,E as I,a as b,u as S}from"./edit-page-DYAspkNM.js";import{c as N}from"./compile-D94gq43r.js";import{r as T,b as k}from"./useMarimoWebSocket-LyNZhdtO.js";import{A as R}from"./tree-D5KwLRtq.js";import{C as w}from"./circle-play-BztTxDeh.js";import"./_createAggregator-thrG5Ge0.js";import"./_baseEach-xIRqRPpa.js";import"./transform-DjHZbYKP.js";import"./timer-DFzT7np-.js";import"./zoom-COrs4lFh.js";import"./sortBy-DCcxFsWn.js";import"./_baseMap-BRjyErPA.js";import"./time-07eAHjQO.js";import"./linear-CfYsspmS.js";import"./init-DLRA0X12.js";import"./range-CtcPcB_L.js";import"./ordinal-DDUp3AbE.js";import"./colors-bszWmPJw.js";import"./arc-Cuwikxov.js";import"./step-BwsUM5iJ.js";import"./index-CYaSGB0o.js";
/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=e("circle-ellipsis",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M17 12h.01",key:"1m0b6t"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M7 12h.01",key:"eqddd0"}]]),M="hoveredCellId",_="cellHover",$="cellNum",C="startTimestamp",P="endTimestamp";const L=a(new Map),z=()=>{const e=s.c(28),{runIds:a,runMap:i}=t(T),c=t(L),{clearRuns:o}=k(),{theme:d}=l(),[m,p]=r.useState("above");let u;e[0]!==m?(u=()=>{p("above"===m?"sideBySide":"above")},e[0]=m,e[1]=u):u=e[1];const h=u;if(0===a.length){let s;return e[2]===Symbol.for("react.memo_cache_sentinel")?(s=n.jsx(f,{title:"No traces",description:n.jsx("span",{children:"Cells that have ran will appear here."}),icon:n.jsx(R,{})}),e[2]=s):s=e[2],s}let x;e[3]===Symbol.for("react.memo_cache_sentinel")?(x=n.jsx("label",{htmlFor:"chartPosition",className:"text-xs",children:"Inline chart"}),e[3]=x):x=e[3];const g="sideBySide"===m;let j,y,I,b,S,N;if(e[4]!==g||e[5]!==h?(j=n.jsxs("div",{className:"flex flex-row gap-1 items-center",children:[x,n.jsx("input",{type:"checkbox",name:"chartPosition",id:"chartPosition",onClick:h,defaultChecked:g,className:"h-3 cursor-pointer"})]}),e[4]=g,e[5]=h,e[6]=j):j=e[6],e[7]!==o?(y=n.jsx(v,{dataTestId:"clear-traces-button",onClick:o}),e[7]=o,e[8]=y):y=e[8],e[9]!==j||e[10]!==y?(I=n.jsxs("div",{className:"flex flex-row justify-end gap-3",children:[j,y]}),e[9]=j,e[10]=y,e[11]=I):I=e[11],e[12]!==m||e[13]!==c||e[14]!==a||e[15]!==i||e[16]!==d){let s;e[18]!==m||e[19]!==c||e[20]!==i||e[21]!==d?(s=(e,s)=>{const t=i.get(e);if(t)return n.jsx(A,{run:t,isExpanded:c.get(t.runId),isMostRecentRun:0===s,chartPosition:m,theme:d},t.runId)},e[18]=m,e[19]=c,e[20]=i,e[21]=d,e[22]=s):s=e[22],b=a.map(s),e[12]=m,e[13]=c,e[14]=a,e[15]=i,e[16]=d,e[17]=b}else b=e[17];return e[23]!==b?(S=n.jsx("div",{className:"flex flex-col gap-3",children:b}),e[23]=b,e[24]=S):S=e[24],e[25]!==I||e[26]!==S?(N=n.jsxs("div",{className:"py-1 px-2 overflow-y-scroll",children:[I,S]}),e[25]=I,e[26]=S,e[27]=N):N=e[27],N},B=i.lazy((()=>c((()=>import("./index-C74t2X8O.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]),import.meta.url).then((e=>({default:e.Vega}))))),H=e=>{const t=s.c(10),{ref:a,width:l}=S(),r=void 0===l?300:l,i="dark"===e.theme?"dark":void 0,c=r-50;let o,d;return t[0]!==e.height||t[1]!==e.signalListeners||t[2]!==e.vegaSpec||t[3]!==i||t[4]!==c?(o=n.jsx(B,{spec:e.vegaSpec,theme:i,width:c,height:e.height,signalListeners:e.signalListeners,actions:!1}),t[0]=e.height,t[1]=e.signalListeners,t[2]=e.vegaSpec,t[3]=i,t[4]=c,t[5]=o):o=t[5],t[6]!==e.className||t[7]!==a||t[8]!==o?(d=n.jsx("div",{className:e.className,ref:a,children:o}),t[6]=e.className,t[7]=a,t[8]=o,t[9]=d):d=t[9],d},A=({run:e,isMostRecentRun:s,chartPosition:t,isExpanded:a,theme:l})=>{const r=o(L),i=(a=a??s)?x:g,c=n.jsx(i,{height:16,className:"inline"}),m=n.jsxs("span",{className:"text-sm cursor-pointer",onClick:()=>{r((s=>{const t=new Map(s);return t.set(e.runId,!a),t}))},children:["Run - ",d(e.runStartTime),c]});return a?n.jsx(D,{run:e,chartPosition:t,theme:l,title:m},e.runId):n.jsx("div",{className:"flex flex-col",children:n.jsx("pre",{className:"font-mono font-semibold",children:m})},e.runId)},D=e=>{const t=s.c(32),{run:a,chartPosition:l,theme:i,title:c}=e,[o,d]=r.useState();let p;t[0]===Symbol.for("react.memo_cache_sentinel")?(p={[_]:(e,s)=>{var t;const a=null==(t=s.cell)?void 0:t[0];d(a??null)}},t[0]=p):p=t[0];const u=p,h=m();let x,g;if(t[1]!==h||t[2]!==l||t[3]!==a.cellRuns||t[4]!==a.runId||t[5]!==i){const e=[...a.cellRuns.values()].map((e=>{const s=e.elapsedTime??0;return{cell:e.cellId,cellNum:h.inOrderIds.indexOf(e.cellId),startTimestamp:q(e.startTime),endTimestamp:q(e.startTime+s),elapsedTime:y(1e3*s),status:e.status}}));x=`hiddenInputElement-${a.runId}`,g=N(function(e,s,t,a){return{$schema:"https://vega.github.io/schema/vega-lite/v5.json",background:"dark"===a?"black":void 0,mark:{type:"bar",cornerRadius:2},params:[{name:M,bind:{element:`#${s}`}},{name:_,select:{type:"point",on:"mouseover",fields:["cell"],clear:"mouseout"}}],height:{step:23},encoding:{y:{field:$,scale:{paddingInner:.2},sort:{field:$},title:"cell",axis:"sideBySide"===t?null:void 0},x:{field:C,type:"temporal",axis:{orient:"top",title:null}},x2:{field:P,type:"temporal"},tooltip:[{field:C,type:"temporal",timeUnit:"dayhoursminutesseconds",title:"Start"},{field:P,type:"temporal",timeUnit:"dayhoursminutesseconds",title:"End"}],size:{value:{expr:`${M} == toString(datum.cell) ? 19.5 : 18`}},color:{field:"status",scale:{domain:["success","error"],range:["#37BE5F","red"]},legend:null}},data:{values:e},config:{view:{stroke:"transparent"}}}}(e,x,l,i)),t[1]=h,t[2]=l,t[3]=a.cellRuns,t[4]=a.runId,t[5]=i,t[6]=x,t[7]=g}else x=t[6],g=t[7];const j=g.spec;let f;t[8]!==x||t[9]!==o||t[10]!==a?(f=n.jsx(F,{run:a,hoveredCellId:o,hiddenInputElementId:x}),t[8]=x,t[9]=o,t[10]=a,t[11]=f):f=t[11];const v=f;if("above"===l){let e,s,l;return t[12]!==i||t[13]!==j?(e=n.jsx(H,{vegaSpec:j,height:120,signalListeners:u,theme:i}),t[12]=i,t[13]=j,t[14]=e):e=t[14],t[15]!==e||t[16]!==c||t[17]!==v?(s=n.jsxs("pre",{className:"font-mono font-semibold",children:[c,e,v]}),t[15]=e,t[16]=c,t[17]=v,t[18]=s):s=t[18],t[19]!==a.runId||t[20]!==s?(l=n.jsx("div",{className:"flex flex-col",children:s},a.runId),t[19]=a.runId,t[20]=s,t[21]=l):l=t[21],l}let I,b,S;return t[22]!==c||t[23]!==v?(I=n.jsxs("pre",{className:"font-mono font-semibold",children:[c,v]}),t[22]=c,t[23]=v,t[24]=I):I=t[24],t[25]!==i||t[26]!==j?(b=n.jsx(H,{className:"-mt-0.5 flex-1",vegaSpec:j,height:100,signalListeners:u,theme:i}),t[25]=i,t[26]=j,t[27]=b):b=t[27],t[28]!==a.runId||t[29]!==I||t[30]!==b?(S=n.jsxs("div",{className:"flex flex-row",children:[I,b]},a.runId),t[28]=a.runId,t[29]=I,t[30]=b,t[31]=S):S=t[31],S},F=e=>{const t=s.c(12),{run:a,hoveredCellId:l,hiddenInputElementId:i}=e,c=r.useRef(null);let o;t[0]===Symbol.for("react.memo_cache_sentinel")?(o=e=>{c.current&&(c.current.value=String(e),c.current.dispatchEvent(new Event("input",{bubbles:!0})))},t[0]=o):o=t[0];const d=o,m=l||"";let p,u,h,x;return t[1]!==i||t[2]!==m?(p=n.jsx("input",{type:"text",id:i,defaultValue:m,hidden:!0,ref:c}),t[1]=i,t[2]=m,t[3]=p):p=t[3],t[4]!==a.cellRuns?(u=[...a.cellRuns.values()],t[4]=a.cellRuns,t[5]=u):u=t[5],t[6]!==l||t[7]!==u?(h=u.map((e=>n.jsx(V,{cellRun:e,hovered:e.cellId===l,dispatchHoverEvent:d},e.cellId))),t[6]=l,t[7]=u,t[8]=h):h=t[8],t[9]!==p||t[10]!==h?(x=n.jsxs("div",{className:"text-xs mt-0.5 ml-3 flex flex-col gap-0.5",children:[p,h]}),t[9]=p,t[10]=h,t[11]=x):x=t[11],x},O={success:n.jsx(b,{color:"green",size:14}),running:n.jsx(w,{color:"var(--blue-10)",size:14}),error:n.jsx(j,{color:"red",size:14}),queued:n.jsx(E,{color:"grey",size:14})},V=e=>{const t=s.c(39),{cellRun:a,hovered:l,dispatchHoverEvent:r}=e;let i;t[0]!==a.elapsedTime?(i=a.elapsedTime?y(1e3*a.elapsedTime):"-",t[0]=a.elapsedTime,t[1]=i):i=t[1];const c=i;let o;t[2]!==a.elapsedTime||t[3]!==c?(o=a.elapsedTime?n.jsxs("span",{children:["This cell took ",n.jsx(I,{elapsedTime:c})," to run"]}):n.jsx("span",{children:"This cell has not been run"}),t[2]=a.elapsedTime,t[3]=c,t[4]=o):o=t[4];const m=o;let x;t[5]!==a.cellId||t[6]!==r?(x=()=>{r(a.cellId)},t[5]=a.cellId,t[6]=r,t[7]=x):x=t[7];const g=x;let j;t[8]!==r?(j=()=>{r(null)},t[8]=r,t[9]=j):j=t[9];const f=j,v=l&&"bg-[var(--gray-3)] opacity-100";let b,S,N,T,k,R,w;t[10]!==v?(b=p("flex flex-row gap-2 py-1 px-1 opacity-70 hover:bg-[var(--gray-3)] hover:opacity-100",v),t[10]=v,t[11]=b):b=t[11],t[12]!==a.startTime?(S=d(a.startTime),t[12]=a.startTime,t[13]=S):S=t[13],t[14]!==S?(N=n.jsxs("span",{className:"text-[var(--gray-10)] dark:text-[var(--gray-11)]",children:["[",S,"]"]}),t[14]=S,t[15]=N):N=t[15],t[16]!==a.cellId?(T=n.jsxs("span",{className:"text-[var(--gray-10)] w-16",children:["(",n.jsx(u,{cellId:a.cellId}),")"]}),t[16]=a.cellId,t[17]=T):T=t[17],t[18]!==a.code?(k=n.jsx("span",{className:"w-40 truncate -ml-1",children:a.code}),t[18]=a.code,t[19]=k):k=t[19],t[20]!==c?(R=n.jsx("span",{className:"text-[var(--gray-10)] dark:text-[var(--gray-11)]",children:c}),t[20]=c,t[21]=R):R=t[21],t[22]!==m||t[23]!==R?(w=n.jsx(h,{content:m,children:R}),t[22]=m,t[23]=R,t[24]=w):w=t[24];const E=O[a.status];let M,_,$;return t[25]!==a.status||t[26]!==E?(M=n.jsx(h,{content:a.status,children:E}),t[25]=a.status,t[26]=E,t[27]=M):M=t[27],t[28]!==w||t[29]!==M?(_=n.jsxs("div",{className:"flex flex-row gap-1 w-16 justify-end -ml-2",children:[w,M]}),t[28]=w,t[29]=M,t[30]=_):_=t[30],t[31]!==g||t[32]!==f||t[33]!==k||t[34]!==_||t[35]!==b||t[36]!==N||t[37]!==T?($=n.jsxs("div",{className:b,onMouseEnter:g,onMouseLeave:f,children:[N,T,k,_]}),t[31]=g,t[32]=f,t[33]=k,t[34]=_,t[35]=b,t[36]=N,t[37]=T,t[38]=$):$=t[38],$};function q(e){try{const s=new Date(1e3*e),t=s.getFullYear(),a=String(s.getMonth()+1).padStart(2,"0"),l=String(s.getDate()).padStart(2,"0"),r=String(s.getHours()).padStart(2,"0"),n=String(s.getMinutes()).padStart(2,"0"),i=String(s.getSeconds()).padStart(2,"0");return`${t}-${a}-${l} ${r}:${n}:${i}.${String(s.getMilliseconds()).padStart(3,"0")}`}catch{return""}}export{z as Tracing,q as formatChartTime};
