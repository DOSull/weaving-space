import{c as t,a as e,s as a}from"./chunk-NGC4727B-CAmgbnkY.js";import{_ as r,d as i,l as n,j as d,u as o,O as s}from"./mermaid-6hHa3B5H.js";import{s as p}from"./transform-BZgIUWgO.js";import{G as l}from"./graph-BMdx2Q1m.js";import{l as g}from"./layout-Bcd3aAVF.js";import{l as c,k as h}from"./step-CjxFKgSe.js";import"./index-C_IDebto.js";import"./_baseUniq-0qVThD32.js";import"./_baseEach-Cnc8IJ8y.js";import"./min-DGW4hqeq.js";import"./_baseMap-C2Ns6n5Z.js";import"./sortBy-NAKcyWSU.js";var f=0,x=r((function(t,e,a,i,d){const s=r((function(t){switch(t){case d.db.relationType.AGGREGATION:return"aggregation";case d.db.relationType.EXTENSION:return"extension";case d.db.relationType.COMPOSITION:return"composition";case d.db.relationType.DEPENDENCY:return"dependency";case d.db.relationType.LOLLIPOP:return"lollipop"}}),"getRelationType");e.points=e.points.filter((t=>!Number.isNaN(t.y)));const p=e.points,l=c().x((function(t){return t.x})).y((function(t){return t.y})).curve(h),g=t.append("path").attr("d",l(p)).attr("id","edge"+f).attr("class","relation");let x,y,u="";i.arrowMarkerAbsolute&&(u=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,u=u.replace(/\(/g,"\\("),u=u.replace(/\)/g,"\\)")),1==a.relation.lineType&&g.attr("class","relation dashed-line"),10==a.relation.lineType&&g.attr("class","relation dotted-line"),"none"!==a.relation.type1&&g.attr("marker-start","url("+u+"#"+s(a.relation.type1)+"Start)"),"none"!==a.relation.type2&&g.attr("marker-end","url("+u+"#"+s(a.relation.type2)+"End)");const m=e.points.length;let b,w,k,E,L=o.calcLabelPosition(e.points);if(x=L.x,y=L.y,m%2!=0&&m>1){let t=o.calcCardinalityPosition("none"!==a.relation.type1,e.points,e.points[0]),r=o.calcCardinalityPosition("none"!==a.relation.type2,e.points,e.points[m-1]);n.debug("cardinality_1_point "+JSON.stringify(t)),n.debug("cardinality_2_point "+JSON.stringify(r)),b=t.x,w=t.y,k=r.x,E=r.y}if(void 0!==a.title){const e=t.append("g").attr("class","classLabel"),r=e.append("text").attr("class","label").attr("x",x).attr("y",y).attr("fill","red").attr("text-anchor","middle").text(a.title);window.label=r;const n=r.node().getBBox();e.insert("rect",":first-child").attr("class","box").attr("x",n.x-i.padding/2).attr("y",n.y-i.padding/2).attr("width",n.width+i.padding).attr("height",n.height+i.padding)}if(n.info("Rendering relation "+JSON.stringify(a)),void 0!==a.relationTitle1&&"none"!==a.relationTitle1){t.append("g").attr("class","cardinality").append("text").attr("class","type1").attr("x",b).attr("y",w).attr("fill","black").attr("font-size","6").text(a.relationTitle1)}if(void 0!==a.relationTitle2&&"none"!==a.relationTitle2){t.append("g").attr("class","cardinality").append("text").attr("class","type2").attr("x",k).attr("y",E).attr("fill","black").attr("font-size","6").text(a.relationTitle2)}f++}),"drawEdge"),y=r((function(t,e,a,r){n.debug("Rendering class ",e,a);const i=e.id,d={id:i,label:e.id,width:0,height:0},o=t.append("g").attr("id",r.db.lookUpDomId(i)).attr("class","classGroup");let s;s=e.link?o.append("svg:a").attr("xlink:href",e.link).attr("target",e.linkTarget).append("text").attr("y",a.textHeight+a.padding).attr("x",0):o.append("text").attr("y",a.textHeight+a.padding).attr("x",0);let p=!0;e.annotations.forEach((function(t){const e=s.append("tspan").text("«"+t+"»");p||e.attr("dy",a.textHeight),p=!1}));let l=u(e);const g=s.append("tspan").text(l).attr("class","title");p||g.attr("dy",a.textHeight);const c=s.node().getBBox().height;let h,f,x;if(e.members.length>0){h=o.append("line").attr("x1",0).attr("y1",a.padding+c+a.dividerMargin/2).attr("y2",a.padding+c+a.dividerMargin/2);const t=o.append("text").attr("x",a.padding).attr("y",c+a.dividerMargin+a.textHeight).attr("fill","white").attr("class","classText");p=!0,e.members.forEach((function(e){b(t,e,p,a),p=!1})),f=t.node().getBBox()}if(e.methods.length>0){x=o.append("line").attr("x1",0).attr("y1",a.padding+c+a.dividerMargin+f.height).attr("y2",a.padding+c+a.dividerMargin+f.height);const t=o.append("text").attr("x",a.padding).attr("y",c+2*a.dividerMargin+f.height+a.textHeight).attr("fill","white").attr("class","classText");p=!0,e.methods.forEach((function(e){b(t,e,p,a),p=!1}))}const y=o.node().getBBox();var m=" ";e.cssClasses.length>0&&(m+=e.cssClasses.join(" "));const w=o.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",y.width+2*a.padding).attr("height",y.height+a.padding+.5*a.dividerMargin).attr("class",m).node().getBBox().width;return s.node().childNodes.forEach((function(t){t.setAttribute("x",(w-t.getBBox().width)/2)})),e.tooltip&&s.insert("title").text(e.tooltip),h&&h.attr("x2",w),x&&x.attr("x2",w),d.width=w,d.height=y.height+a.padding+.5*a.dividerMargin,d}),"drawClass"),u=r((function(t){let e=t.id;return t.type&&(e+="<"+s(t.type)+">"),e}),"getClassTitleString"),m=r((function(t,e,a,r){n.debug("Rendering note ",e,a);const i=e.id,d={id:i,text:e.text,width:0,height:0},o=t.append("g").attr("id",i).attr("class","classGroup");let s=o.append("text").attr("y",a.textHeight+a.padding).attr("x",0);const p=JSON.parse(`"${e.text}"`).split("\n");p.forEach((function(t){n.debug(`Adding line: ${t}`),s.append("tspan").text(t).attr("class","title").attr("dy",a.textHeight)}));const l=o.node().getBBox(),g=o.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",l.width+2*a.padding).attr("height",l.height+p.length*a.textHeight+a.padding+.5*a.dividerMargin).node().getBBox().width;return s.node().childNodes.forEach((function(t){t.setAttribute("x",(g-t.getBBox().width)/2)})),d.width=g,d.height=l.height+p.length*a.textHeight+a.padding+.5*a.dividerMargin,d}),"drawNote"),b=r((function(t,e,a,r){const{displayText:i,cssStyle:n}=e.getDisplayDetails(),d=t.append("tspan").attr("x",r.padding).text(i);""!==n&&d.attr("style",e.cssStyle),a||d.attr("dy",r.textHeight)}),"addTspan"),w={getClassTitleString:u,drawClass:y,drawEdge:x,drawNote:m},k={},E=r((function(t){const e=Object.entries(k).find((e=>e[1].label===t));if(e)return e[0]}),"getGraphId"),L=r((function(t){t.append("defs").append("marker").attr("id","extensionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 1,7 L18,13 V 1 Z"),t.append("defs").append("marker").attr("id","extensionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 1,1 V 13 L18,7 Z"),t.append("defs").append("marker").attr("id","compositionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","compositionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","aggregationStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","aggregationEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","dependencyStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 5,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L14,7 L9,1 Z")}),"insertMarkers"),N={parser:t,db:e,renderer:{draw:r((function(t,e,a,r){const o=i().class;k={},n.info("Rendering diagram "+t);const s=i().securityLevel;let c;"sandbox"===s&&(c=p("#i"+e));const h=p("sandbox"===s?c.nodes()[0].contentDocument.body:"body"),f=h.select(`[id='${e}']`);L(f);const x=new l({multigraph:!0});x.setGraph({isMultiGraph:!0}),x.setDefaultEdgeLabel((function(){return{}}));const y=r.db.getClasses(),u=[...y.keys()];for(const i of u){const t=y.get(i),e=w.drawClass(f,t,o,r);k[e.id]=e,x.setNode(e.id,e),n.info("Org height: "+e.height)}r.db.getRelations().forEach((function(t){n.info("tjoho"+E(t.id1)+E(t.id2)+JSON.stringify(t)),x.setEdge(E(t.id1),E(t.id2),{relation:t},t.title||"DEFAULT")}));r.db.getNotes().forEach((function(t){n.debug(`Adding note: ${JSON.stringify(t)}`);const e=w.drawNote(f,t,o,r);k[e.id]=e,x.setNode(e.id,e),t.class&&y.has(t.class)&&x.setEdge(t.id,E(t.class),{relation:{id1:t.id,id2:t.class,relation:{type1:"none",type2:"none",lineType:10}}},"DEFAULT")})),g(x),x.nodes().forEach((function(t){void 0!==t&&void 0!==x.node(t)&&(n.debug("Node "+t+": "+JSON.stringify(x.node(t))),h.select("#"+(r.db.lookUpDomId(t)||t)).attr("transform","translate("+(x.node(t).x-x.node(t).width/2)+","+(x.node(t).y-x.node(t).height/2)+" )"))})),x.edges().forEach((function(t){void 0!==t&&void 0!==x.edge(t)&&(n.debug("Edge "+t.v+" -> "+t.w+": "+JSON.stringify(x.edge(t))),w.drawEdge(f,x.edge(t),x.edge(t).relation,o,r))}));const m=f.node().getBBox(),b=m.width+40,N=m.height+40;d(f,N,b,o.useMaxWidth);const T=`${m.x-20} ${m.y-20} ${b} ${N}`;n.debug(`viewBox ${T}`),f.attr("viewBox",T)}),"draw")},styles:a,init:r((t=>{t.class||(t.class={}),t.class.arrowMarkerAbsolute=t.arrowMarkerAbsolute,e.clear()}),"init")};export{N as diagram};
