<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>weavingspace.tiling_utils API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
        overflow-y: hidden;
    }
</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../weavingspace.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;weavingspace</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#PRECISION">PRECISION</a>
            </li>
            <li>
                    <a class="variable" href="#RESOLUTION">RESOLUTION</a>
            </li>
            <li>
                    <a class="function" href="#get_strand_ids">get_strand_ids</a>
            </li>
            <li>
                    <a class="function" href="#get_regular_polygon">get_regular_polygon</a>
            </li>
            <li>
                    <a class="function" href="#get_corners">get_corners</a>
            </li>
            <li>
                    <a class="function" href="#get_sides">get_sides</a>
            </li>
            <li>
                    <a class="function" href="#get_side_lengths">get_side_lengths</a>
            </li>
            <li>
                    <a class="function" href="#get_side_bearings">get_side_bearings</a>
            </li>
            <li>
                    <a class="function" href="#get_interior_angles">get_interior_angles</a>
            </li>
            <li>
                    <a class="function" href="#get_clean_polygon">get_clean_polygon</a>
            </li>
            <li>
                    <a class="function" href="#rotate_preserving_order">rotate_preserving_order</a>
            </li>
            <li>
                    <a class="function" href="#ensure_cw">ensure_cw</a>
            </li>
            <li>
                    <a class="function" href="#get_inner_angle">get_inner_angle</a>
            </li>
            <li>
                    <a class="function" href="#is_regular_polygon">is_regular_polygon</a>
            </li>
            <li>
                    <a class="function" href="#is_tangential">is_tangential</a>
            </li>
            <li>
                    <a class="function" href="#get_incentre">get_incentre</a>
            </li>
            <li>
                    <a class="function" href="#get_incircle">get_incircle</a>
            </li>
            <li>
                    <a class="function" href="#get_apothem">get_apothem</a>
            </li>
            <li>
                    <a class="function" href="#get_angle_bisector">get_angle_bisector</a>
            </li>
            <li>
                    <a class="function" href="#gridify">gridify</a>
            </li>
            <li>
                    <a class="function" href="#get_dual_tile_unit">get_dual_tile_unit</a>
            </li>
            <li>
                    <a class="function" href="#write_map_to_layers">write_map_to_layers</a>
            </li>
            <li>
                    <a class="function" href="#get_collapse_distance">get_collapse_distance</a>
            </li>
            <li>
                    <a class="function" href="#get_largest_polygon">get_largest_polygon</a>
            </li>
            <li>
                    <a class="function" href="#touch_along_an_edge">touch_along_an_edge</a>
            </li>
            <li>
                    <a class="function" href="#get_width_height_left_bottom">get_width_height_left_bottom</a>
            </li>
            <li>
                    <a class="function" href="#get_bounding_ellipse">get_bounding_ellipse</a>
            </li>
            <li>
                    <a class="function" href="#get_tiling_edges">get_tiling_edges</a>
            </li>
            <li>
                    <a class="function" href="#get_polygon_sector">get_polygon_sector</a>
            </li>
            <li>
                    <a class="function" href="#repair_polygon">repair_polygon</a>
            </li>
            <li>
                    <a class="function" href="#safe_union">safe_union</a>
            </li>
            <li>
                    <a class="function" href="#get_translation_transform">get_translation_transform</a>
            </li>
            <li>
                    <a class="function" href="#get_rotation_transform">get_rotation_transform</a>
            </li>
            <li>
                    <a class="function" href="#get_reflection_transform">get_reflection_transform</a>
            </li>
            <li>
                    <a class="function" href="#combine_transforms">combine_transforms</a>
            </li>
            <li>
                    <a class="function" href="#reverse_transform">reverse_transform</a>
            </li>
            <li>
                    <a class="function" href="#as_shapely_transform">as_shapely_transform</a>
            </li>
            <li>
                    <a class="function" href="#as_numpy_matrix">as_numpy_matrix</a>
            </li>
            <li>
                    <a class="class" href="#StraightLine">StraightLine</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#StraightLine.__init__">StraightLine</a>
                        </li>
                        <li>
                                <a class="variable" href="#StraightLine.A">A</a>
                        </li>
                        <li>
                                <a class="variable" href="#StraightLine.B">B</a>
                        </li>
                        <li>
                                <a class="variable" href="#StraightLine.C">C</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#get_straight_line">get_straight_line</a>
            </li>
            <li>
                    <a class="function" href="#get_intersection">get_intersection</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../weavingspace.html">weavingspace</a><wbr>.tiling_utils    </h1>

                        <div class="docstring"><p>Utility functions for the <code><a href="../weavingspace.html">weavingspace</a></code> module.</p>

<p>Most are geometric convenience functions for commonly applied
operations.</p>
</div>

                        <input id="mod-tiling_utils-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-tiling_utils-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sd">&quot;&quot;&quot;Utility functions for the `weavingspace` module.</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">Most are geometric convenience functions for commonly applied</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">operations.</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">string</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">NamedTuple</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">shapely.affinity</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">affine</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">geom</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">shapely.ops</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">shapely.algorithms</span><span class="w"> </span><span class="kn">import</span> <span class="n">polylabel</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a>  <span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterable</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="n">PRECISION</span> <span class="o">=</span> <span class="mi">6</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="n">RESOLUTION</span> <span class="o">=</span> <span class="mf">1e-6</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_parse_strand_label</span><span class="p">(</span><span class="n">s</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Break a strand label specification in to a list of labels.</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="sd">  Args:</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">    s (str): see get_strand_ids() for details</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">  Returns:</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">    list[str]: list of strand labels.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>  <span class="c1"># replace multiple open and close parentheses with single parentheses</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a>  <span class="n">clean_s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;[(]+&quot;</span><span class="p">,</span> <span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;[)]+&quot;</span><span class="p">,</span> <span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>  <span class="n">is_combo</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>  <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a>  <span class="n">current</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>  <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">clean_s</span><span class="p">:</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>    <span class="k">if</span> <span class="n">is_combo</span><span class="p">:</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>      <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;)&quot;</span><span class="p">:</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>        <span class="c1"># end of a combination</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>        <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>        <span class="n">current</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>        <span class="n">is_combo</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>      <span class="k">else</span><span class="p">:</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>        <span class="n">current</span> <span class="o">=</span> <span class="n">current</span> <span class="o">+</span> <span class="n">c</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>    <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span><span class="p">:</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>      <span class="c1"># start of a combination</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>      <span class="n">is_combo</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>      <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>  <span class="k">return</span> <span class="n">output</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_strand_ids</span><span class="p">(</span><span class="n">strands_spec</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Convert strands specification string to list of lists of strand labels.</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="sd">  String format is &quot;a|bc|(de)f&quot; where | separates strands in each</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="sd">  direction and () designates combining labels into a single strand that</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="sd">  will be sliced lengthwise. Example output:</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="sd">        &quot;a|bc|(de)f&quot; -&gt; ([&quot;a&quot;], [&quot;b&quot;, &quot;c&quot;], [&quot;de&quot;, &quot;f&quot;])</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="sd">  Superflous parentheses are removed, but no other error-checks are</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="sd">  applied.</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="sd">  Args:</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">    strands_spec (str): the strands specification to be parsed.</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">  Returns:</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="sd">    tuple[str]: tuple of lists of labels for each set of strands.</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>  <span class="n">strand_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">_parse_strand_label</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strands_spec</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>  <span class="n">strand_ids</span> <span class="o">=</span> <span class="n">strand_ids</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strand_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="p">[</span><span class="o">*</span><span class="n">strand_ids</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]]</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>  <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">strand_ids</span><span class="p">)</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_regular_polygon</span><span class="p">(</span><span class="n">spacing</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">:</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="w">  </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return regular n-gon centered on (0, 0) with height specified.</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="sd">  n-gon has horizontal base and height given by spacing. Generation is based on</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="sd">  equally spaced points around a circle with a radius calculated slightly</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a><span class="sd">  differently, depending on whether the number of sides is even or odd.</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="sd">            Even         Odd</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="sd">        \  /    \  /      |</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="sd">         \/   ___\/___    |</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a><span class="sd">         /\      /\      / \</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="sd">        /  \    /  \    /   \</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a><span class="sd">  The returned polygon is gridified. Note also that shapely silently reorders</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="sd">  the coordinates clockwise from the lower left corner, regardless of the CCW</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a><span class="sd">  order in which we supply them.</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a><span class="sd">  Args:</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a><span class="sd">    spacing (_type_): required height.</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a><span class="sd">    n (int): number of sides.</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a><span class="sd">  Returns:</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a><span class="sd">    geom.Polygon: required geom.Polygon.</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>  <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>    <span class="n">R</span> <span class="o">=</span> <span class="n">spacing</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>    <span class="n">R</span> <span class="o">=</span> <span class="n">spacing</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>  <span class="n">angle_0</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">n</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>  <span class="n">a_diff</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">n</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>  <span class="n">angles</span> <span class="o">=</span> <span class="p">[</span><span class="n">angle_0</span> <span class="o">+</span> <span class="n">a_diff</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>  <span class="n">corners</span> <span class="o">=</span> <span class="p">[(</span><span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span> <span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span> <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">]</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>  <span class="k">return</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_corners</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">,</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>                <span class="n">repeat_first</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">]:</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return list of geom.Points on boundary of a polygon.</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="sd">  The first point is optionally repeated. No simplification is carried out</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="sd">  (e.g. if a line segment has a &#39;corner&#39; along its length, it is NOT removed;</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="sd">  see get_clean_polygon for that). Points have precision set to the</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="sd">  packagedefault tiling_utils.RESOLUTION.</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="sd">  Args:</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a><span class="sd">    shape (geom.Polygon): polygon whose corners are required.</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a><span class="sd">    repeat_first (bool, optional): if True the first corner is repeated in the</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="sd">      returned list, if False it is omitted. Defaults to True.</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="sd">  Returns:</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="sd">    list[geom.Point]: list of geom.Point vertices of the polygon.</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>  <span class="n">corners</span> <span class="o">=</span> <span class="p">[</span><span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">shape</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">]</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>  <span class="k">return</span> <span class="n">corners</span> <span class="k">if</span> <span class="n">repeat_first</span> <span class="k">else</span> <span class="n">corners</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_sides</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">]:</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return polygon sides as list of geom.LineStrings.</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="sd">  Resolution is set to the package default tiling_utils.RESOLUTION. No</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="sd">  simplification for successive colinear sides is carried out.</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="sd">  Args:</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="sd">    shape (geom.Polygon): polygon whose edges are required.</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">  Returns:</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">    list[geom.LineString]: list of geom.LineString sides of the polygon.</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>  <span class="n">corners</span> <span class="o">=</span> <span class="n">get_corners</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>  <span class="k">return</span> <span class="p">[</span><span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">])</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>          <span class="k">for</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">corners</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">corners</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">strict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)]</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_side_lengths</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return list of lengths of polygon sides.</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="sd">  No simplification for corners along sides is carried out.</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a><span class="sd">  Args:</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a><span class="sd">    shape (geom.Polygon): polygon whose edge lengths are required.</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a><span class="sd">  Returns:</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="sd">    list[float]: list of side lengths.</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>  <span class="n">corners</span> <span class="o">=</span> <span class="n">get_corners</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>  <span class="k">return</span> <span class="p">[</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>    <span class="n">p1</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span> <span class="k">for</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">corners</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">corners</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">strict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)]</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_side_bearings</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">]:</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return list of angles between sides of polygon and the positive x-axis.</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">  Angle is in degrees and calculated when proceeding from the first point in</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="sd">  each side to its end point. This should usually be CW around the polygon.</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="sd">  Args:</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="sd">    shape (geom.Polygon): polygon whose side bearings are required.</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a><span class="sd">  Returns:</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a><span class="sd">    tuple[float,...]: tuple of bearings of each edge.</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>  <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>    <span class="n">e</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">e</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">e</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">e</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">get_sides</span><span class="p">(</span><span class="n">shape</span><span class="p">)])</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_interior_angles</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return angles (in degrees) between successive edges of a polygon.</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a><span class="sd">  No polygon simplification is carried out so some angles may be 180 (i.e. a</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a><span class="sd">  &#39;corner&#39; along a side, such that successive sides are colinear).</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a><span class="sd">  Args:</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="sd">    shape (geom.Polygon): polygon whose angles are required.</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">  Returns:</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a><span class="sd">    list[float]: list of angles.</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>  <span class="n">corners</span> <span class="o">=</span> <span class="n">get_corners</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">repeat_first</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>  <span class="n">wrap_corners</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">corners</span> <span class="o">+</span> <span class="n">corners</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>  <span class="n">triples</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wrap_corners</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>                <span class="n">wrap_corners</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>                <span class="n">wrap_corners</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">strict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>  <span class="k">return</span> <span class="p">[</span><span class="n">get_inner_angle</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span> <span class="k">for</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span> <span class="ow">in</span> <span class="n">triples</span><span class="p">]</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_clean_polygon</span><span class="p">(</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>      <span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="o">|</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="o">|</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">,</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>    <span class="p">)</span> <span class="o">-&gt;</span>  <span class="n">geom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="o">|</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="o">|</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">:</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return polygon with successive co-linear or very close corners removed.</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a><span class="sd">  Particularly useful for tidying polygons weave tilings that have been</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="sd">  assembled from multiple &#39;cells&#39; in the weave grid.</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a><span class="sd">  Args:</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a><span class="sd">    shape (geom.MultiPolygon|geom.Polygon): polygon to clean.</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a><span class="sd">  Returns:</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a><span class="sd">    geom.Polygon: cleaned polygon.</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">geom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">):</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>    <span class="k">return</span> <span class="n">geom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">([</span><span class="n">get_clean_polygon</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">shape</span><span class="o">.</span><span class="n">geoms</span><span class="p">])</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">geom</span><span class="o">.</span><span class="n">GeometryCollection</span><span class="p">):</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>    <span class="n">elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">shape</span><span class="o">.</span><span class="n">geoms</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)]</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>      <span class="k">return</span> <span class="n">get_clean_polygon</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>    <span class="k">return</span> <span class="n">get_clean_polygon</span><span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>  <span class="n">corners</span> <span class="o">=</span> <span class="n">get_corners</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">repeat_first</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>  <span class="c1"># first remove any &#39;near neighbour&#39; corners</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>  <span class="n">distances</span> <span class="o">=</span> <span class="n">get_side_lengths</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>  <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">RESOLUTION</span><span class="p">)</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">distances</span><span class="p">]</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>  <span class="n">corners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">to_remove</span><span class="p">,</span> <span class="n">strict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="p">]</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>  <span class="c1"># next remove any that are colinear</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>  <span class="n">p</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>  <span class="n">corners</span> <span class="o">=</span> <span class="n">get_corners</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">repeat_first</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>  <span class="n">angles</span> <span class="o">=</span> <span class="n">get_interior_angles</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>  <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">a</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">)</span> <span class="ow">or</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>               <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">)</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>               <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">]</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>  <span class="n">corners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">to_remove</span><span class="p">,</span> <span class="n">strict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="p">]</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>  <span class="k">return</span> <span class="n">gridify</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">corners</span><span class="p">))</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a><span class="k">def</span><span class="w"> </span><span class="nf">rotate_preserving_order</span><span class="p">(</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>    <span class="n">polygon</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">,</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>    <span class="n">angle</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>    <span class="n">centre</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Point</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">:</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return supplied polygon rotated with order of corners preserved.</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a><span class="sd">  Order of polygon corners is not guaranteed to be preserved by shapely.</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a><span class="sd">  affinity.rotate).</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a><span class="sd">  Args:</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a><span class="sd">    polygon (geom.Polygon): polygon to rotate.</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a><span class="sd">    angle (float): desired angle of rotation (in degrees).</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a><span class="sd">    centre (geom.Point): the rotation centre (passed on to shapely.affinity.</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="sd">      rotate).</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a><span class="sd">  Returns:</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a><span class="sd">    geom.Polygon: rotated polygon.</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>  <span class="n">ctr</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span> <span class="k">if</span> <span class="n">centre</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">centre</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>  <span class="n">corners</span> <span class="o">=</span> <span class="n">get_corners</span><span class="p">(</span><span class="n">polygon</span><span class="p">,</span> <span class="n">repeat_first</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>  <span class="k">return</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">([</span><span class="n">affine</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">ctr</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">corners</span><span class="p">])</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a><span class="k">def</span><span class="w"> </span><span class="nf">ensure_cw</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">:</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return the polygon with its outer boundary vertices in clockwise order.</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a><span class="sd">  It is important to note that shapely.set_precision() imposes clockwise order</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a><span class="sd">  on polygons, and since it is used widely throughout theses modules, it makes</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a><span class="sd">  sense to impose this order.</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a><span class="sd">  Args:</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a><span class="sd">    shape (geom.Polygon): the polygon.</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a><span class="sd">  Returns:</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a><span class="sd">    geom.Polygon: the polygon in clockwise order.</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>  <span class="k">if</span> <span class="n">geom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span><span class="o">.</span><span class="n">is_ccw</span><span class="p">:</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>    <span class="k">return</span> <span class="n">shape</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>  <span class="k">return</span> <span class="n">shape</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_inner_angle</span><span class="p">(</span><span class="n">p1</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">,</span> <span class="n">p3</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a><span class="w">  </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return angle between line p1-p2 and p2-p3, i.e., the angle A below.</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a><span class="sd">            p2</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a><span class="sd">           / \</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a><span class="sd">          / A \</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a><span class="sd">        p1     p3</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a><span class="sd">  Args:</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a><span class="sd">    p1 (geom.Point): first point.</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a><span class="sd">    p2 (geom.Point): second &#39;corner&#39; point.</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a><span class="sd">    p3 (geom.Point): third point.</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a><span class="sd">  Returns:</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a><span class="sd">    float: angle in degrees.</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">p3</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p3</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">p2</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">p2</span><span class="o">.</span><span class="n">x</span><span class="p">))</span> <span class="o">%</span> <span class="mi">360</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a><span class="k">def</span><span class="w"> </span><span class="nf">is_regular_polygon</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Test if supplied polygon is regular (i.e. equal sides and angles).</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a><span class="sd">  Args:</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a><span class="sd">    shape (geom.Polygon): polygon to test.</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a><span class="sd">  Returns:</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a><span class="sd">    bool: True if polygon is regular, False if not.</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>  <span class="n">side_lengths</span> <span class="o">=</span> <span class="n">get_side_lengths</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>  <span class="n">angles</span> <span class="o">=</span> <span class="n">get_interior_angles</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>  <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">side_lengths</span><span class="p">,</span> <span class="n">side_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> \
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>     <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">angles</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a><span class="k">def</span><span class="w"> </span><span class="nf">is_tangential</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Determine if supplied polygon is tangential.</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a><span class="sd">  A tangential polygon can have a circle inscribed tangential to all its sides.</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a><span class="sd">  NOTE: not currently used but retained in case incentre is restored to use</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a><span class="sd">  &#39;home made&#39; code rather than polylabel.polylabel.</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a><span class="sd">  Note that this will fail for polygons with successive colinear sides, meaning</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a><span class="sd">  that polygons should be fully simplified...</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a><span class="sd">  Args:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a><span class="sd">    shape (geom.Polygon): polygon to test.</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="sd">  Returns:</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a><span class="sd">    bool: True if polygon is tangential, False if not.</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>  <span class="k">if</span> <span class="n">is_regular_polygon</span><span class="p">(</span><span class="n">shape</span><span class="p">):</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>  <span class="n">side_lengths</span> <span class="o">=</span> <span class="n">get_side_lengths</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>  <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">side_lengths</span><span class="p">)</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>  <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="c1">#triangles are easy!</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>      <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>    <span class="c1"># odd number of sides there is a nice solvable system  of equations see</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>    <span class="c1"># https://math.stackexchange.com/questions/4065370/tangential-polygons-conditions-on-edge-lengths</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>    <span class="c1">#</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>    <span class="c1"># TODO: this is not reliable for reasons I don&#39;t fully understand. There is</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>    <span class="c1"># a corresponding crude catch exception in incentre... but this needs a</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>    <span class="c1"># more complete investigation</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>    <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>    <span class="n">fractions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span> <span class="o">@</span> <span class="n">side_lengths</span> <span class="o">/</span> <span class="n">side_lengths</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fractions</span><span class="p">),</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>                      <span class="mf">0.5</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">)):</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>      <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>    <span class="n">ones</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">)</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fractions</span><span class="p">]</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>    <span class="n">zeros</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">)</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>             <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fractions</span><span class="p">]</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>    <span class="n">negatives</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fractions</span><span class="p">]</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>    <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">ones</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">zeros</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">negatives</span><span class="p">))</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>  <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>    <span class="c1"># for quadrilaterals odd and even side lengths are equal</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">side_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]),</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>                      <span class="nb">sum</span><span class="p">(</span><span class="n">side_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]),</span> <span class="n">rtol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">)</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>  <span class="c1"># other even numbers of sides... hard to avoid brute force</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>  <span class="n">bisectors</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_angle_bisector</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>  <span class="n">intersects</span> <span class="o">=</span> <span class="p">[</span><span class="n">b1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">b2</span><span class="p">)</span> <span class="k">for</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span> <span class="ow">in</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>                <span class="nb">zip</span><span class="p">(</span><span class="n">bisectors</span><span class="p">,</span> <span class="n">bisectors</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">bisectors</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">strict</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>                <span class="k">if</span> <span class="n">b1</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">b2</span><span class="p">)]</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>  <span class="n">distances</span> <span class="o">=</span> <span class="p">[</span><span class="n">i1</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">i2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="ow">in</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>               <span class="nb">zip</span><span class="p">(</span><span class="n">intersects</span><span class="p">,</span> <span class="n">intersects</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">intersects</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>                   <span class="n">strict</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)]</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>  <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="n">d</span> <span class="o">&lt;=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">RESOLUTION</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">distances</span><span class="p">])</span>  <span class="c1"># noqa: C419</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_incentre</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">:</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Get a polygon incentre.</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a><span class="sd">  See https://en.wikipedia.org/wiki/Incenter.</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a><span class="sd">  This method relies on the polygon being tangential, i.e. there is an</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a><span class="sd">  inscribed circle to which all sides of the polygon are tangent. It will work</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a><span class="sd">  on all the polygons encountered in the Laves tilings, but is not guaranteed</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a><span class="sd">  to work on all polygons.</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a><span class="sd">  Given that the polygon is tangential, the radius of the inscribed circle is</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a><span class="sd">  the [apothem of the polygon](https://en.wikipedia.org/wiki/Apothem) given by</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a><span class="sd">  2 x Area / Perimeter. We apply a parallel offset of this size to two sides of</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a><span class="sd">  the polygon and find their intersection to determine the centre of the circle</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a><span class="sd">  givng the incentre of the polygon.</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a><span class="sd">  Args:</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a><span class="sd">    shape (geom.Polygon): the polygon.</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a><span class="sd">  Returns:</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a><span class="sd">    geom.Point: the incentre of the polygon.</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>  <span class="k">if</span> <span class="n">is_regular_polygon</span><span class="p">(</span><span class="n">shape</span><span class="p">):</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>    <span class="k">return</span> <span class="n">shape</span><span class="o">.</span><span class="n">centroid</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>  <span class="k">return</span> <span class="n">polylabel</span><span class="o">.</span><span class="n">polylabel</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_incircle</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">:</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return incircle of supplied polygon.</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a><span class="sd">  Args:</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="sd">    shape(geom.Polygon): polygon for which incircle is required.</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a><span class="sd">  Returns:</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a><span class="sd">    geom.Polygon: a polygon representation of the incircle</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>  <span class="n">c</span> <span class="o">=</span> <span class="n">get_incentre</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>  <span class="n">r</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">get_sides</span><span class="p">(</span><span class="n">shape</span><span class="p">)])</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>  <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_apothem</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return length of the apothem of supplied polygon.</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a><span class="sd">  Args:</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a><span class="sd">    shape(geom.Polygon): polygon for which apothem length is required.</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a><span class="sd">  Returns:</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a><span class="sd">    float: an estimate of the apothem length.</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>  <span class="k">if</span> <span class="n">is_regular_polygon</span><span class="p">(</span><span class="n">shape</span><span class="p">):</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">shape</span><span class="o">.</span><span class="n">area</span> <span class="o">/</span> <span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span><span class="o">.</span><span class="n">length</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>  <span class="n">c</span> <span class="o">=</span> <span class="n">polylabel</span><span class="o">.</span><span class="n">polylabel</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>  <span class="k">return</span> <span class="nb">min</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">get_sides</span><span class="p">(</span><span class="n">shape</span><span class="p">)])</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_angle_bisector</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">:</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return angle bisector of specified corner of supplied polygon.</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a><span class="sd">  Args:</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a><span class="sd">    shape (geom.Polygon): the polygon</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a><span class="sd">    v (int, optional): index of the corner whose bisector is required.</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a><span class="sd">    Defaults to 0.</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a><span class="sd">  Returns:</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a><span class="sd">    geom.LineString: line which bisects the specified corner.</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>  <span class="n">pts</span> <span class="o">=</span> <span class="n">get_corners</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">repeat_first</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>  <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>  <span class="n">p0</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">v</span> <span class="o">%</span> <span class="n">n</span><span class="p">]</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>  <span class="n">p1</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[(</span><span class="n">v</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">]</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>  <span class="n">p2</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[(</span><span class="n">v</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">]</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>  <span class="n">d01</span> <span class="o">=</span> <span class="n">p0</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>  <span class="n">d02</span> <span class="o">=</span> <span class="n">p0</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>  <span class="k">if</span> <span class="n">d01</span> <span class="o">&lt;</span> <span class="n">d02</span><span class="p">:</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>    <span class="n">p2</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([</span><span class="n">p0</span><span class="p">,</span> <span class="n">p2</span><span class="p">])</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">d01</span><span class="p">)</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>    <span class="n">p1</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">])</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">d02</span><span class="p">)</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>  <span class="n">m</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">((</span><span class="n">p1</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">p2</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>  <span class="c1"># we have to scale this to much larger in case of an angle near 180</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>  <span class="k">return</span> <span class="n">affine</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([</span><span class="n">p0</span><span class="p">,</span> <span class="n">m</span><span class="p">]),</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">origin</span> <span class="o">=</span> <span class="n">p0</span><span class="p">)</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_get_interior_vertices</span><span class="p">(</span><span class="n">tiles</span><span class="p">:</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">:</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return points not on outer boundary of supplied set of tiles.</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a><span class="sd">  Args:</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a><span class="sd">    tiles (gpd.GeoDataFrame): a set of polygons.</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a><span class="sd">  Returns:</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a><span class="sd">    gpd.GeoSeries: interior vertices of the set of polygons.</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>  <span class="n">tiles</span><span class="p">:</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span> <span class="o">=</span> <span class="n">gridify</span><span class="p">(</span><span class="n">tiles</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>  <span class="n">uu</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span> <span class="o">=</span> <span class="n">safe_union</span><span class="p">(</span><span class="n">tiles</span><span class="p">,</span> <span class="n">as_polygon</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>  <span class="n">interior_pts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>  <span class="k">for</span> <span class="n">tile</span> <span class="ow">in</span> <span class="n">tiles</span><span class="p">:</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>    <span class="k">for</span> <span class="n">corner</span> <span class="ow">in</span> <span class="n">tile</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>      <span class="k">if</span> <span class="n">uu</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">corner</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">cap_style</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">)):</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>        <span class="n">interior_pts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">corner</span><span class="p">)</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>  <span class="k">return</span> <span class="n">gridify</span><span class="p">(</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">([</span><span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">interior_pts</span><span class="p">]))</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a><span class="k">def</span><span class="w"> </span><span class="nf">gridify</span><span class="p">(</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>    <span class="n">gs</span><span class="p">:</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span> <span class="o">|</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span> <span class="o">|</span> <span class="n">shapely</span><span class="o">.</span><span class="n">Geometry</span><span class="p">,</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span> <span class="o">|</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span> <span class="o">|</span> <span class="n">shapely</span><span class="o">.</span><span class="n">Geometry</span><span class="p">:</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return supplied GeoSeries rounded to tiling_utils.RESOLUTION.</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a><span class="sd">  Args:</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a><span class="sd">    gs (gpd.GeoSeries): geometries to gridify.</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a><span class="sd">    precision (int, optional): digits of precision. Defaults to 6.</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a><span class="sd">  Returns:</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a><span class="sd">    gpd.GeoSeries: the rounded geometries.</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">shapely</span><span class="o">.</span><span class="n">Geometry</span><span class="p">)</span> <span class="p">:</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>    <span class="k">return</span> <span class="n">shapely</span><span class="o">.</span><span class="n">set_precision</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">grid_size</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">):</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>    <span class="k">return</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>      <span class="p">[</span><span class="n">shapely</span><span class="o">.</span><span class="n">set_precision</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">grid_size</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">gs</span><span class="p">)],</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>      <span class="n">crs</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>    <span class="n">gs</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>      <span class="p">[</span><span class="n">shapely</span><span class="o">.</span><span class="n">set_precision</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">grid_size</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">)</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>       <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">geometry</span><span class="p">)],</span> <span class="n">crs</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>    <span class="k">return</span> <span class="n">gs</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>  <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_dual_tile_unit</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Convert supplied TileUnit to candidate GeoDataFrame of its dual TileUnit.</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a><span class="sd">  NOTE: this is complicated and not remotely guaranteed to work!</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a><span class="sd">  a particular issue is that where to place the vertices of the faces</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a><span class="sd">  of the dual with respect to the tiles in the original is ill-defined.</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a><span class="sd">  This is because the dual process is topologically not metrically defined,</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a><span class="sd">  so that exact vertex locations are ambiguous. Tiling duality is defined in</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="sd">  Section 4.2 of Grunbaum B, Shephard G C, 1987 _Tilings and Patterns_ (W. H.</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a><span class="sd">  Freeman and Company, New York)</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a><span class="sd">  NOTE: In general, this method will work only if all supplied tiles are</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a><span class="sd">  regular polygons. A known exception is if the only non-regular polygons are</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a><span class="sd">  triangles.</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="sd">  NOTE: &#39;clean&#39; polygons are required. If supplied polygons have messy</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a><span class="sd">  vertices with multiple points where there is only one proper point, bad</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="sd">  things are likely to happen! Consider using `clean_polygon()` on the</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a><span class="sd">  tile geometries.</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">  Because of the above limitations, we only return a GeoDataFrame</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="sd">  for inspection. However some `weavingspace.tile_unit.TileUnit` setup</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a><span class="sd">  methods in `weavingspace.tiling_geometries` use this method, where we are</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">  confident the returned dual is valid.</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="sd">  Args:</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a><span class="sd">    unit (TileUnit): the tiling for which the dual is required.</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a><span class="sd">  Returns:</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a><span class="sd">    gpd.GeoDataFrame: GeoDataFrame that could be the tiles attribute for</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a><span class="sd">      a TileUnit of the dual tiling.</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>  <span class="c1"># get a local patch of this Tiling</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>  <span class="n">local_patch</span><span class="p">:</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span> <span class="o">=</span> <span class="n">unit</span><span class="o">.</span><span class="n">get_local_patch</span><span class="p">(</span><span class="n">r</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">include_0</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>  <span class="c1"># Find the interior points of these tiles - these will be guaranteed</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>  <span class="c1"># to have a sequence of surrounding tiles incident on them</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>  <span class="n">interior_pts</span> <span class="o">=</span> <span class="n">_get_interior_vertices</span><span class="p">(</span><span class="n">local_patch</span><span class="p">)</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>  <span class="c1"># Compile a list of the polygons incident on the interior points</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>  <span class="n">cycles</span> <span class="o">=</span> <span class="p">[{</span><span class="n">poly_id</span> <span class="k">for</span> <span class="n">poly_id</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">local_patch</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>             <span class="k">if</span> <span class="n">pt</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">RESOLUTION</span> <span class="o">*</span> <span class="mi">2</span><span class="p">}</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">interior_pts</span><span class="p">]</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>  <span class="n">dual_faces</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>  <span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="n">cycles</span><span class="p">:</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>    <span class="n">ids</span><span class="p">,</span> <span class="n">pts</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>    <span class="k">for</span> <span class="n">poly_id</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">:</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>      <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_patch</span><span class="o">.</span><span class="n">tile_id</span><span class="p">[</span><span class="n">poly_id</span><span class="p">])</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>      <span class="n">poly</span> <span class="o">=</span> <span class="n">local_patch</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="n">poly_id</span><span class="p">]</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>      <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_incentre</span><span class="p">(</span><span class="n">poly</span><span class="p">))</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>    <span class="c1"># sort them into CW order so they are well formed</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>    <span class="n">sorted_coords</span> <span class="o">=</span> <span class="n">_sort_cw</span><span class="p">([(</span><span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ID</span><span class="p">)</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>                              <span class="k">for</span> <span class="n">pt</span><span class="p">,</span> <span class="n">ID</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">strict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)])</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>    <span class="n">dual_faces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>      <span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">([(</span><span class="n">pt_id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt_id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">pt_id</span> <span class="ow">in</span> <span class="n">sorted_coords</span><span class="p">]),</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>       <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">pt_id</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">pt_id</span> <span class="ow">in</span> <span class="n">sorted_coords</span><span class="p">])))</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>  <span class="c1"># ensure the resulting face centroids are inside the original tile</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>  <span class="c1"># displaced a little to avoid uncertainties at corners/edges</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>  <span class="c1"># This is a guess at something that _could_ work, which turned out well!</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>  <span class="n">dual_faces</span> <span class="o">=</span> <span class="p">[(</span><span class="n">f</span><span class="p">,</span> <span class="n">ID</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">dual_faces</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>                <span class="k">if</span> <span class="n">affine</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>                  <span class="n">unit</span><span class="o">.</span><span class="n">get_prototile_from_vectors</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">],</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>                  <span class="n">RESOLUTION</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="n">RESOLUTION</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">centroid</span><span class="p">)]</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>  <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tile_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dual_faces</span><span class="p">]},</span> <span class="n">crs</span> <span class="o">=</span> <span class="n">unit</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>    <span class="n">geometry</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">([</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dual_faces</span><span class="p">]))</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>  <span class="c1"># ensure no duplicates</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>  <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="s2">&quot;tile_id&quot;</span><span class="p">,</span> <span class="n">as_index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>    <span class="n">index_parts</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>  <span class="n">gdf</span><span class="o">.</span><span class="n">tile_id</span> <span class="o">=</span> <span class="n">_relabel</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>  <span class="k">return</span> <span class="n">gdf</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_relabel</span><span class="p">(</span><span class="n">data</span><span class="p">:</span><span class="n">Iterable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return supplied data reassigned with unique values from ascii_letters.</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a><span class="sd">  Args:</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a><span class="sd">    data (Iterable): the data to relabel</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a><span class="sd">  Returns:</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a><span class="sd">    list: the reassigned data</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>  <span class="n">new_data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>  <span class="n">d_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>  <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>    <span class="k">if</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_data</span><span class="p">:</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>      <span class="n">new_data</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="p">[</span><span class="n">d_count</span><span class="p">]</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>      <span class="n">d_count</span> <span class="o">=</span> <span class="n">d_count</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>  <span class="k">return</span> <span class="p">[</span><span class="n">new_data</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_sort_cw</span><span class="p">(</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>  <span class="n">pts_ids</span><span class="p">:</span><span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Sort supplied x,y,ID tuple into CW order relative to their mean centre.</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a><span class="sd">  Args:</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a><span class="sd">    pts_ids (list[tuple[float, float, str]]): A tuple of a pair of</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a><span class="sd">      floats and a string.</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a><span class="sd">  Returns:</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a><span class="sd">    list: a list in the same format as supplied sorted into</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a><span class="sd">      clockwise order of the point locations.</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>  <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pts_ids</span><span class="p">]</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>  <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pts_ids</span><span class="p">]</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>  <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>  <span class="n">dx</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span> <span class="o">-</span> <span class="n">cx</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>  <span class="n">dy</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span> <span class="o">-</span> <span class="n">cy</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>  <span class="n">angles</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span> <span class="k">for</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">strict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)]</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>  <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">pts_ids</span><span class="p">,</span> <span class="n">strict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">))</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>  <span class="k">return</span> <span class="p">[</span><span class="n">pt_id</span> <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">pt_id</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)]</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a><span class="k">def</span><span class="w"> </span><span class="nf">write_map_to_layers</span><span class="p">(</span><span class="n">gdf</span><span class="p">:</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>                        <span class="n">fname</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;output.gpkg&quot;</span><span class="p">,</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>                        <span class="n">tile_var</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tile_id&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Write supplied GeoDataFrame to a GPKG file.</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a><span class="sd">  Geopackage file layers will be based on the `tile_var` attribute.</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a><span class="sd">  Args:</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a><span class="sd">    gdf (gpd.GeoDataFrame): the GeoDataFrame.</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a><span class="sd">    fname (str, optional): filename to write.</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a><span class="sd">    tile_var (str, optional): the attribute to use to separate</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a><span class="sd">      output file into layers. Defaults to &quot;tile_id&quot;.</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>  <span class="n">grouped</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">tile_var</span><span class="p">,</span> <span class="n">as_index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>  <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">gdf</span><span class="p">[</span><span class="n">tile_var</span><span class="p">]):</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>    <span class="n">grouped</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">e</span><span class="p">,</span> <span class="n">driver</span> <span class="o">=</span> <span class="s2">&quot;GPKG&quot;</span><span class="p">)</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_collapse_distance</span><span class="p">(</span><span class="n">geometry</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return distance under which polygon will disappear if negatively buffered.</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a><span class="sd">  Performs a binary search between an upper bound based on the radius of circle</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a><span class="sd">  of equal area to the polygon, and 0.</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a><span class="sd">  Args:</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a><span class="sd">    geometry (geom.Polygon): the polygon.</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a><span class="sd">  Returns:</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="sd">    float: its collapse distance.</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>  <span class="k">if</span> <span class="n">is_regular_polygon</span><span class="p">(</span><span class="n">geometry</span><span class="p">):</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>    <span class="k">return</span> <span class="n">get_apothem</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>  <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">area</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>  <span class="n">lower</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>  <span class="n">upper</span> <span class="o">=</span> <span class="n">radius</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>  <span class="n">delta</span> <span class="o">=</span> <span class="mf">1e12</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>  <span class="n">stop_delta</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">/</span> <span class="mi">1000</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>  <span class="k">while</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="n">stop_delta</span><span class="p">:</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>    <span class="n">new_r</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower</span> <span class="o">+</span> <span class="n">upper</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>    <span class="k">if</span> <span class="n">geometry</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="o">-</span><span class="n">new_r</span><span class="p">)</span><span class="o">.</span><span class="n">area</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>      <span class="n">lower</span> <span class="o">=</span> <span class="n">new_r</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>      <span class="n">delta</span> <span class="o">=</span> <span class="n">upper</span> <span class="o">-</span> <span class="n">new_r</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>      <span class="n">upper</span> <span class="o">=</span> <span class="n">new_r</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>      <span class="n">delta</span> <span class="o">=</span> <span class="n">new_r</span> <span class="o">-</span> <span class="n">lower</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>  <span class="k">return</span> <span class="n">new_r</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_largest_polygon</span><span class="p">(</span><span class="n">polygons</span><span class="p">:</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">:</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return largest polygon in a GeoSeries as a GeoSeries of one polygon.</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a><span class="sd">  NOT CURRENTLY USED ANYWHERE IN MODULE.</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a><span class="sd">  Args:</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a><span class="sd">    polygons (gpd.GeoSeries): the set of polygons to pick from.</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a><span class="sd">  Returns:</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a><span class="sd">    gpd.GeoSeries: the largest polygon.</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>  <span class="n">actual_polygons</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">polygons</span><span class="o">.</span><span class="n">geometry</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>                     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">,</span> <span class="n">geom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">))]</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>  <span class="n">areas</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">actual_polygons</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">area</span><span class="p">,</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>  <span class="k">return</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">areas</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a><span class="k">def</span><span class="w"> </span><span class="nf">touch_along_an_edge</span><span class="p">(</span><span class="n">p1</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Test if two polygons touch along an edge.</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a><span class="sd">  Checks that the intersection area of the two polygons buffered by</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a><span class="sd">  a small amount is large enough to indicate that they neighbour at more</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a><span class="sd">  than a corner.</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a><span class="sd">  Args:</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a><span class="sd">    p1 (geom.Polygon): First polygon</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a><span class="sd">    p2 (geom.Polygon): Second polygon</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a><span class="sd">  Returns:</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a><span class="sd">    bool: True if they neighbour along an edge</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>  <span class="k">return</span> <span class="p">(</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>    <span class="n">p1</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">RESOLUTION</span><span class="p">,</span> <span class="n">join_style</span> <span class="o">=</span> <span class="s2">&quot;mitre&quot;</span><span class="p">,</span> <span class="n">cap_style</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">)</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>      <span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">p2</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">RESOLUTION</span><span class="p">,</span> <span class="n">join_style</span> <span class="o">=</span> <span class="s2">&quot;mitre&quot;</span><span class="p">,</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>                                          <span class="n">cap_style</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">))</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>      <span class="o">.</span><span class="n">area</span> <span class="o">&gt;</span> <span class="mi">16</span> <span class="o">*</span> <span class="n">RESOLUTION</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_width_height_left_bottom</span><span class="p">(</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>    <span class="n">gs</span><span class="p">:</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">,</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>  <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return width, height, left and bottom limits of a GeoSeries.</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a><span class="sd">  Args:</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a><span class="sd">    gs (geopandas.GeoSeries): GeoSeries for which limits are required.</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a><span class="sd">  Returns:</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a><span class="sd">    tuple: four float values of width, height, left and bottom of gs.</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>  <span class="n">bb</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">total_bounds</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>  <span class="k">return</span> <span class="p">(</span><span class="n">bb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">bb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bb</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bb</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_bounding_ellipse</span><span class="p">(</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>    <span class="n">shapes</span><span class="p">:</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">,</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>    <span class="n">mag</span><span class="p">:</span><span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">:</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return an ellipse containing the supplied shapes.</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">  The method used is to calculate the size of square that would contain</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a><span class="sd">  the shapes, if they had an aspect ratio 1, then stretch the circle in</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a><span class="sd">  the x, y directions according to the actual aspect ratio of the shapes.</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a><span class="sd">  Args:</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a><span class="sd">    shapes (gpd.GeoSeries): the shapes to be contained.</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a><span class="sd">    mag (float, optional): optionally increase the size of the returned</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a><span class="sd">      ellipse by this scale factor. Defaults to 1.0.</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a><span class="sd">  Returns:</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a><span class="sd">    gpd.GeoSeries: the set of shapes.</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>  <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="n">get_width_height_left_bottom</span><span class="p">(</span><span class="n">shapes</span><span class="p">)</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>  <span class="n">c</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">+</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>  <span class="n">r</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>  <span class="n">circle</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">r</span><span class="p">)]</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>  <span class="k">return</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">circle</span><span class="p">,</span> <span class="n">crs</span> <span class="o">=</span> <span class="n">shapes</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>    <span class="n">width</span> <span class="o">/</span> <span class="n">r</span> <span class="o">*</span> <span class="n">mag</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">height</span> <span class="o">/</span> <span class="n">r</span> <span class="o">*</span> <span class="n">mag</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">origin</span> <span class="o">=</span> <span class="n">c</span><span class="p">)</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_tiling_edges</span><span class="p">(</span><span class="n">tiles</span><span class="p">:</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">:</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return linestring GeoSeries from supplied polygon GeoSeries.</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a><span class="sd">  This is used to allow display of edges of tiles in legend when they are</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a><span class="sd">  masked by an ellipse (if we instead clip polygons then the ellipse edge</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a><span class="sd">  will also show in the result.)</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a><span class="sd">  Args:</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a><span class="sd">    tiles (gpd.GeoSeries): Polygons to convert.</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a><span class="sd">  Returns:</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a><span class="sd">    gpd.GeoSeries: LineStrings from the supplied Polygons.</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>  <span class="n">tiles</span> <span class="o">=</span> <span class="n">tiles</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>  <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">tiles</span><span class="p">]</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>  <span class="k">return</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">crs</span> <span class="o">=</span> <span class="n">tiles</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_polygon_sector</span><span class="p">(</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>    <span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">,</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>    <span class="n">start</span><span class="p">:</span><span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>    <span class="n">end</span><span class="p">:</span><span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">:</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return a sector of the provided Polygon.</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a><span class="sd">  The returned sector is a section of the polygon boundary between the</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a><span class="sd">  normalized start and end positions, and including the polygon centroid.</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a><span class="sd">  Should (probably) only be applied to convex polygons.</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a><span class="sd">  Args:</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a><span class="sd">    shape (geom.Polygon): the Polygon.</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a><span class="sd">    start (float): normalized start position along the boundary. Defaults to</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a><span class="sd">      0.</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a><span class="sd">    end (float): normalized start position along the boundary. Defaults to</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a><span class="sd">      1.</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a><span class="sd">  Returns:</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a><span class="sd">    geom.Polygon: the requested polygon sector.</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>  <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>    <span class="c1"># must return a null polygon since the calling context</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>    <span class="c1"># expects to get something back... which most likely</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>    <span class="c1"># is needed to align with other data</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>    <span class="k">return</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">()</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>  <span class="k">if</span> <span class="n">start</span> <span class="o">*</span> <span class="n">end</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>    <span class="c1"># either side of 0/1 so assume required sector includes 0</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>    <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>    <span class="n">arc1</span> <span class="o">=</span> <span class="n">shapely</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">substring</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>                                 <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">normalized</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>    <span class="n">arc2</span> <span class="o">=</span> <span class="n">shapely</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">substring</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>                                 <span class="mi">0</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">normalized</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>    <span class="n">sector</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>      <span class="p">[</span><span class="n">shape</span><span class="o">.</span><span class="n">centroid</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">arc1</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">arc2</span><span class="o">.</span><span class="n">coords</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>    <span class="n">arc</span> <span class="o">=</span> <span class="n">shapely</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">substring</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>                                <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">normalized</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>    <span class="n">sector</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">([</span><span class="n">shape</span><span class="o">.</span><span class="n">centroid</span><span class="p">,</span> <span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="n">arc</span><span class="o">.</span><span class="n">coords</span><span class="p">)])</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>  <span class="k">return</span> <span class="n">sector</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a><span class="k">def</span><span class="w"> </span><span class="nf">repair_polygon</span><span class="p">(</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>    <span class="n">polygon</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="o">|</span><span class="n">geom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="o">|</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">,</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>    <span class="n">shrink_then_grow</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="o">|</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">:</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Repair a polyon or GeoSeries by double buffering.</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a><span class="sd">  This is method is often unofficially recommended (on stackexchange etc.)</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a><span class="sd">  even in the shapely docs, to resolve topology issues and extraneous</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="sd">  additional vertices appearing when spatial operations are repeatedly</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a><span class="sd">  applied.</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a><span class="sd">  Optionally the buffer may be applied in the opposite order (i.e. grow then</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="sd">  shrink). This operation may also convert a MultiPolygon that has some &#39;stray&#39;</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a><span class="sd">  parts to a Polygon.</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a><span class="sd">  Args:</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a><span class="sd">    polygon(geom.Polygon|gpd.GeoSeries): Polygon or GeoSeries to clean.</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a><span class="sd">    res (float, optional): buffer size to use. Defaults to 1e-3.</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a><span class="sd">    shrink_then_grow (bool, optional): if True the negative buffer is</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a><span class="sd">      applied first, otherwise the buffer operations are applied in</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a><span class="sd">      reverse. Defaults to True.</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a><span class="sd">  Returns:</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a><span class="sd">    geom.Polygon|gpd.GeoSeries: the cleaned Polygon or GeoSeries.</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>  <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span> <span class="ow">is</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">:</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>    <span class="k">return</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">([</span><span class="n">repair_polygon</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">shrink_then_grow</span><span class="p">)</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>                          <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">polygon</span><span class="p">])</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="n">polygon</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>  <span class="k">if</span> <span class="n">polygon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>    <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>  <span class="k">if</span> <span class="n">shrink_then_grow</span><span class="p">:</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>    <span class="k">return</span> <span class="n">polygon</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>      <span class="o">-</span><span class="n">RESOLUTION</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="n">join_style</span> <span class="o">=</span> <span class="s2">&quot;mitre&quot;</span><span class="p">,</span> <span class="n">cap_style</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>       <span class="n">RESOLUTION</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="n">join_style</span> <span class="o">=</span> <span class="s2">&quot;mitre&quot;</span><span class="p">,</span> <span class="n">cap_style</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">)</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>  <span class="k">return</span> <span class="n">polygon</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>     <span class="n">RESOLUTION</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="n">join_style</span> <span class="o">=</span> <span class="s2">&quot;mitre&quot;</span><span class="p">,</span> <span class="n">cap_style</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>    <span class="o">-</span><span class="n">RESOLUTION</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="n">join_style</span> <span class="o">=</span> <span class="s2">&quot;mitre&quot;</span><span class="p">,</span> <span class="n">cap_style</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">)</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a><span class="k">def</span><span class="w"> </span><span class="nf">safe_union</span><span class="p">(</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>    <span class="n">gs</span><span class="p">:</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">,</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>    <span class="n">as_polygon</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="o">|</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">:</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Union supplied GeoSeries buffering to avoid gaps and internal edges.</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a><span class="sd">  Optionally returns a Polygon or a GeoSeries.</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a><span class="sd">  NOTE: APPEARS NOT TO BE VERY SAFE... find workarounds for the few occasions</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a><span class="sd">  on which it is used.</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a><span class="sd">  Frequently when unioning polygons that are ostensibly adjacent &#39;rogue&#39;</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a><span class="sd">  internal boundaries remain in the result. We can avoid this by buffering the</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a><span class="sd">  polygons before unioning them, then reversing the buffer on the unioned</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a><span class="sd">  shape.</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a><span class="sd">  Args:</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a><span class="sd">    gs (gpd.GeoSeries): the Polygons to union.</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a><span class="sd">    res (float, optional): size of the buffer to use. Defaults to 1e-3.</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a><span class="sd">    as_polygon (bool, optional): if True returns a Polygon, otherwise</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a><span class="sd">      returns a one Polygon GeoSeries. Defaults to False.</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a><span class="sd">  Returns:</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a><span class="sd">    gpd.GeoSeries|geom.Polygon: the resulting union of supplied</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a><span class="sd">      polygons.</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>  <span class="n">r</span> <span class="o">=</span> <span class="n">RESOLUTION</span> <span class="o">*</span> <span class="mi">10</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>  <span class="n">union</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>    <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">join_style</span> <span class="o">=</span> <span class="s2">&quot;mitre&quot;</span><span class="p">,</span> <span class="n">cap_style</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">gs</span><span class="p">],</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>    <span class="n">crs</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span><span class="o">.</span><span class="n">union_all</span><span class="p">()</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">,</span> <span class="n">join_style</span> <span class="o">=</span> <span class="s2">&quot;mitre&quot;</span><span class="p">,</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>                                         <span class="n">cap_style</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">)</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>  <span class="k">if</span> <span class="n">as_polygon</span><span class="p">:</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>    <span class="k">return</span> <span class="n">union</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>  <span class="k">return</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">([</span><span class="n">union</span><span class="p">],</span> <span class="n">crs</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_translation_transform</span><span class="p">(</span><span class="n">dx</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span><span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">]:</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return shapely affine transform tuple for a translation.</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a><span class="sd">  Args:</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a><span class="sd">      dx (float): translation distance in x direction.</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a><span class="sd">      dy (float): translation distance in y direction.</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a><span class="sd">  Returns:</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a><span class="sd">    list[float]: a six item list of floats, per the shapely.affinity.</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a><span class="sd">    affine_transform method, see</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a><span class="sd">      https://shapely.readthedocs.io/en/stable/manual.html#affine-transformations</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>  <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_rotation_transform</span><span class="p">(</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>    <span class="n">angle</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">centre</span><span class="p">:</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">]</span><span class="o">|</span><span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">]:</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return the shapely affine transform tuple for a rotation.</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a><span class="sd">  Rotation is optionally about a supplied centre point.</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a><span class="sd">  Args:</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a><span class="sd">    angle (float): the angle of rotation (in degrees).</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a><span class="sd">    centre (tuple[float], optional): An option centre location. Defaults to</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a><span class="sd">    None, which will in turn be converted to (0, 0).</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a><span class="sd">  Returns:</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a><span class="sd">    list[float]: a six item list of floats, per the shapely.affinity.</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a><span class="sd">      affine_transform method, see</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a><span class="sd">        https://shapely.readthedocs.io/en/stable/manual.html#affine-transformations</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>  <span class="k">if</span> <span class="n">centre</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">centre</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">):</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>  <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">centre</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>  <span class="n">t1</span> <span class="o">=</span> <span class="n">get_translation_transform</span><span class="p">(</span><span class="o">-</span><span class="n">dx</span><span class="p">,</span> <span class="o">-</span><span class="n">dy</span><span class="p">)</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>  <span class="n">r</span> <span class="o">=</span> <span class="n">get_rotation_transform</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>  <span class="n">t2</span> <span class="o">=</span> <span class="n">get_translation_transform</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>  <span class="k">return</span> <span class="n">combine_transforms</span><span class="p">([</span><span class="n">t1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t2</span><span class="p">])</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_reflection_transform</span><span class="p">(</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>    <span class="n">angle</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">centre</span><span class="p">:</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">]</span><span class="o">|</span><span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">]:</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return a shapely affine reflection transform.</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a><span class="sd">  Reflection is in a line at the specified angle, optionally through a</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a><span class="sd">  specified centre point.</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a><span class="sd">  Args:</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a><span class="sd">    angle (float): angle to the x-axis of the line of reflection.</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a><span class="sd">    centre (tuple[float], optional): point through which the line of</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a><span class="sd">      reflection passes. Defaults to None, which</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a><span class="sd">      will in turn be converted to (0, 0).</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a><span class="sd">  Returns:</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a><span class="sd">    list[float]: a six item list of floats, per the shapely.affinity.</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a><span class="sd">      affine_transform method, see</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a><span class="sd">        https://shapely.readthedocs.io/en/stable/manual.html#affine-transformations</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>  <span class="k">if</span> <span class="n">centre</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">centre</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">):</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>    <span class="n">A</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>  <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">centre</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>  <span class="n">t1</span> <span class="o">=</span> <span class="n">get_translation_transform</span><span class="p">(</span><span class="o">-</span><span class="n">dx</span><span class="p">,</span> <span class="o">-</span><span class="n">dy</span><span class="p">)</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>  <span class="n">r</span> <span class="o">=</span> <span class="n">get_reflection_transform</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>  <span class="n">t2</span> <span class="o">=</span> <span class="n">get_translation_transform</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>  <span class="k">return</span> <span class="n">combine_transforms</span><span class="p">([</span><span class="n">t1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t2</span><span class="p">])</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a><span class="k">def</span><span class="w"> </span><span class="nf">combine_transforms</span><span class="p">(</span><span class="n">transforms</span><span class="p">:</span><span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">]:</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return shapely affine transform that combines supplied list of transforms.</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a><span class="sd">  Transforms are applied in the order of the supplied list</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a><span class="sd">  Args:</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a><span class="sd">    transforms (list[list[float]]): sequence of transforms to combine.</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a><span class="sd">  Returns:</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a><span class="sd">    list[float]: a transform tuple combining the supplied transforms applied</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a><span class="sd">      in order, see</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a><span class="sd">        https://shapely.readthedocs.io/en/stable/manual.html#affine-transformations</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>  <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>  <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">transforms</span><span class="p">:</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">as_numpy_matrix</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">@</span> <span class="n">result</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>  <span class="k">return</span> <span class="n">as_shapely_transform</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reverse_transform</span><span class="p">(</span><span class="n">transform</span><span class="p">:</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">]:</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return inverse shapely affine transform of the supplied transform.</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a><span class="sd">  Args:</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a><span class="sd">    transform (list[float]): the transform for which the inverse is desired.</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a><span class="sd">  Returns:</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a><span class="sd">    list[float]: shapely affine transform tuple that will invert the supplied</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a><span class="sd">      transform.</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>  <span class="k">return</span> <span class="n">as_shapely_transform</span><span class="p">(</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>    <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">as_numpy_matrix</span><span class="p">(</span><span class="n">transform</span><span class="p">)))</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a><span class="k">def</span><span class="w"> </span><span class="nf">as_shapely_transform</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">]:</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return shapely affine transform equivalent to supplied numpy matrix.</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a><span class="sd">  The numpy matrix is a conventional augmented (i.e. 3x3) affine transform</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a><span class="sd">  matrix.</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a><span class="sd">  Args:</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a><span class="sd">    arr (np.array): augmented affine transform matrix of the desired</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a><span class="sd">      transform.</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a><span class="sd">  Returns:</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a><span class="sd">    list[float]: desired shapely affine transform list of floats.</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>  <span class="k">return</span> <span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a><span class="k">def</span><span class="w"> </span><span class="nf">as_numpy_matrix</span><span class="p">(</span><span class="n">transform</span><span class="p">:</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Convert shapely affine transform to augmented affine transform matrix.</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a><span class="sd">  Args:</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a><span class="sd">    transform (list[float]): the transform in shapely format.</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a><span class="sd">  Returns:</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a><span class="sd">    np.array: the transform in numpy matrix format.</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">transform</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">transform</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">transform</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>                   <span class="p">[</span><span class="n">transform</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">transform</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">transform</span><span class="p">[</span><span class="mi">5</span><span class="p">]],</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>                   <span class="p">[</span>           <span class="mi">0</span><span class="p">,</span>            <span class="mi">0</span><span class="p">,</span>            <span class="mi">1</span><span class="p">]])</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a><span class="k">class</span><span class="w"> </span><span class="nc">StraightLine</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Straight line in canonical Ax+By+C=0 form.&quot;&quot;&quot;</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>  <span class="n">A</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>  <span class="n">B</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>  <span class="n">C</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_straight_line</span><span class="p">(</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>    <span class="n">p1</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">,</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>    <span class="n">perpendicular</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StraightLine</span><span class="p">:</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return StraightLine p1-p2, optionally perpendicular through the midpoint.</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a><span class="sd">  Args:</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a><span class="sd">    p1 (geom.Point): First point.</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a><span class="sd">    p2 (geom.Point): Second point</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a><span class="sd">    perpendicular (bool, optional): If True the perpendicular bisector is</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a><span class="sd">      returned. Defaults to False.</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a><span class="sd">  Returns:</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a><span class="sd">    StraightLine: _description_</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>  <span class="k">if</span> <span class="n">perpendicular</span><span class="p">:</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>    <span class="n">ls</span> <span class="o">=</span> <span class="n">affine</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">]),</span> <span class="mi">90</span><span class="p">)</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>    <span class="n">pts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ls</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">y</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>  <span class="k">return</span> <span class="n">StraightLine</span><span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">y1</span><span class="p">)</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_intersection</span><span class="p">(</span><span class="n">line1</span><span class="p">:</span><span class="n">StraightLine</span><span class="p">,</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>                     <span class="n">line2</span><span class="p">:</span><span class="n">StraightLine</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="o">|</span><span class="kc">None</span><span class="p">:</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return point of intersection of straight lines.</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a><span class="sd">  Args:</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a><span class="sd">    line1 (StraightLine): First straight line.</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a><span class="sd">    line2 (StraightLine): Second straight line.</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a><span class="sd">  Returns:</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a><span class="sd">    geom.Point|None: Point is returned if the lines intersect, otherwise None.</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>  <span class="n">x_set</span><span class="p">,</span> <span class="n">y_set</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>  <span class="n">denominator</span> <span class="o">=</span> <span class="n">line1</span><span class="o">.</span><span class="n">A</span> <span class="o">*</span> <span class="n">line2</span><span class="o">.</span><span class="n">B</span> <span class="o">-</span> <span class="n">line2</span><span class="o">.</span><span class="n">A</span> <span class="o">*</span> <span class="n">line1</span><span class="o">.</span><span class="n">B</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>  <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">line1</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">):</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>    <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">line1</span><span class="o">.</span><span class="n">C</span> <span class="o">/</span> <span class="n">line1</span><span class="o">.</span><span class="n">B</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>    <span class="n">y_set</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>  <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">line2</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">):</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>    <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">line2</span><span class="o">.</span><span class="n">C</span> <span class="o">/</span> <span class="n">line2</span><span class="o">.</span><span class="n">B</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>    <span class="n">y_set</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>  <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">line1</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">):</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">line1</span><span class="o">.</span><span class="n">C</span> <span class="o">/</span> <span class="n">line1</span><span class="o">.</span><span class="n">A</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>    <span class="n">x_set</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>  <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">line2</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">):</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">line2</span><span class="o">.</span><span class="n">C</span> <span class="o">/</span> <span class="n">line2</span><span class="o">.</span><span class="n">A</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>    <span class="n">x_set</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>  <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">denominator</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">):</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>    <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>  <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x_set</span> <span class="k">else</span> <span class="p">(</span><span class="n">line1</span><span class="o">.</span><span class="n">B</span> <span class="o">*</span> <span class="n">line2</span><span class="o">.</span><span class="n">C</span> <span class="o">-</span> <span class="n">line2</span><span class="o">.</span><span class="n">B</span> <span class="o">*</span> <span class="n">line1</span><span class="o">.</span><span class="n">C</span><span class="p">)</span> <span class="o">/</span> <span class="n">denominator</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>  <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="k">if</span> <span class="n">y_set</span> <span class="k">else</span> <span class="p">(</span><span class="n">line1</span><span class="o">.</span><span class="n">C</span> <span class="o">*</span> <span class="n">line2</span><span class="o">.</span><span class="n">A</span> <span class="o">-</span> <span class="n">line2</span><span class="o">.</span><span class="n">C</span> <span class="o">*</span> <span class="n">line1</span><span class="o">.</span><span class="n">A</span><span class="p">)</span> <span class="o">/</span> <span class="n">denominator</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>  <span class="k">return</span> <span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="PRECISION">
                    <div class="attr variable">
            <span class="name">PRECISION</span>        =
<span class="default_value">6</span>

        
    </div>
    <a class="headerlink" href="#PRECISION"></a>
    
    

                </section>
                <section id="RESOLUTION">
                    <div class="attr variable">
            <span class="name">RESOLUTION</span>        =
<span class="default_value">1e-06</span>

        
    </div>
    <a class="headerlink" href="#RESOLUTION"></a>
    
    

                </section>
                <section id="get_strand_ids">
                            <input id="get_strand_ids-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_strand_ids</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">strands_spec</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="get_strand_ids-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_strand_ids"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_strand_ids-60"><a href="#get_strand_ids-60"><span class="linenos">60</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_strand_ids</span><span class="p">(</span><span class="n">strands_spec</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="get_strand_ids-61"><a href="#get_strand_ids-61"><span class="linenos">61</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Convert strands specification string to list of lists of strand labels.</span>
</span><span id="get_strand_ids-62"><a href="#get_strand_ids-62"><span class="linenos">62</span></a>
</span><span id="get_strand_ids-63"><a href="#get_strand_ids-63"><span class="linenos">63</span></a><span class="sd">  String format is &quot;a|bc|(de)f&quot; where | separates strands in each</span>
</span><span id="get_strand_ids-64"><a href="#get_strand_ids-64"><span class="linenos">64</span></a><span class="sd">  direction and () designates combining labels into a single strand that</span>
</span><span id="get_strand_ids-65"><a href="#get_strand_ids-65"><span class="linenos">65</span></a><span class="sd">  will be sliced lengthwise. Example output:</span>
</span><span id="get_strand_ids-66"><a href="#get_strand_ids-66"><span class="linenos">66</span></a>
</span><span id="get_strand_ids-67"><a href="#get_strand_ids-67"><span class="linenos">67</span></a><span class="sd">        &quot;a|bc|(de)f&quot; -&gt; ([&quot;a&quot;], [&quot;b&quot;, &quot;c&quot;], [&quot;de&quot;, &quot;f&quot;])</span>
</span><span id="get_strand_ids-68"><a href="#get_strand_ids-68"><span class="linenos">68</span></a>
</span><span id="get_strand_ids-69"><a href="#get_strand_ids-69"><span class="linenos">69</span></a><span class="sd">  Superflous parentheses are removed, but no other error-checks are</span>
</span><span id="get_strand_ids-70"><a href="#get_strand_ids-70"><span class="linenos">70</span></a><span class="sd">  applied.</span>
</span><span id="get_strand_ids-71"><a href="#get_strand_ids-71"><span class="linenos">71</span></a>
</span><span id="get_strand_ids-72"><a href="#get_strand_ids-72"><span class="linenos">72</span></a><span class="sd">  Args:</span>
</span><span id="get_strand_ids-73"><a href="#get_strand_ids-73"><span class="linenos">73</span></a><span class="sd">    strands_spec (str): the strands specification to be parsed.</span>
</span><span id="get_strand_ids-74"><a href="#get_strand_ids-74"><span class="linenos">74</span></a>
</span><span id="get_strand_ids-75"><a href="#get_strand_ids-75"><span class="linenos">75</span></a><span class="sd">  Returns:</span>
</span><span id="get_strand_ids-76"><a href="#get_strand_ids-76"><span class="linenos">76</span></a><span class="sd">    tuple[str]: tuple of lists of labels for each set of strands.</span>
</span><span id="get_strand_ids-77"><a href="#get_strand_ids-77"><span class="linenos">77</span></a>
</span><span id="get_strand_ids-78"><a href="#get_strand_ids-78"><span class="linenos">78</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_strand_ids-79"><a href="#get_strand_ids-79"><span class="linenos">79</span></a>  <span class="n">strand_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">_parse_strand_label</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strands_spec</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)]</span>
</span><span id="get_strand_ids-80"><a href="#get_strand_ids-80"><span class="linenos">80</span></a>  <span class="n">strand_ids</span> <span class="o">=</span> <span class="n">strand_ids</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strand_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="p">[</span><span class="o">*</span><span class="n">strand_ids</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]]</span>
</span><span id="get_strand_ids-81"><a href="#get_strand_ids-81"><span class="linenos">81</span></a>  <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">strand_ids</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convert strands specification string to list of lists of strand labels.</p>

<p>String format is "a|bc|(de)f" where | separates strands in each
direction and () designates combining labels into a single strand that
will be sliced lengthwise. Example output:</p>

<pre><code>  "a|bc|(de)f" -&gt; (["a"], ["b", "c"], ["de", "f"])
</code></pre>

<p>Superflous parentheses are removed, but no other error-checks are
applied.</p>

<p>Args:
  strands_spec (str): the strands specification to be parsed.</p>

<p>Returns:
  tuple[str]: tuple of lists of labels for each set of strands.</p>
</div>


                </section>
                <section id="get_regular_polygon">
                            <input id="get_regular_polygon-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_regular_polygon</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">spacing</span><span class="p">:</span> <span class="nb">float</span>, </span><span class="param"><span class="n">n</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span>:</span></span>

                <label class="view-source-button" for="get_regular_polygon-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_regular_polygon"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_regular_polygon-84"><a href="#get_regular_polygon-84"><span class="linenos"> 84</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_regular_polygon</span><span class="p">(</span><span class="n">spacing</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">:</span>
</span><span id="get_regular_polygon-85"><a href="#get_regular_polygon-85"><span class="linenos"> 85</span></a><span class="w">  </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return regular n-gon centered on (0, 0) with height specified.</span>
</span><span id="get_regular_polygon-86"><a href="#get_regular_polygon-86"><span class="linenos"> 86</span></a>
</span><span id="get_regular_polygon-87"><a href="#get_regular_polygon-87"><span class="linenos"> 87</span></a><span class="sd">  n-gon has horizontal base and height given by spacing. Generation is based on</span>
</span><span id="get_regular_polygon-88"><a href="#get_regular_polygon-88"><span class="linenos"> 88</span></a><span class="sd">  equally spaced points around a circle with a radius calculated slightly</span>
</span><span id="get_regular_polygon-89"><a href="#get_regular_polygon-89"><span class="linenos"> 89</span></a><span class="sd">  differently, depending on whether the number of sides is even or odd.</span>
</span><span id="get_regular_polygon-90"><a href="#get_regular_polygon-90"><span class="linenos"> 90</span></a>
</span><span id="get_regular_polygon-91"><a href="#get_regular_polygon-91"><span class="linenos"> 91</span></a><span class="sd">            Even         Odd</span>
</span><span id="get_regular_polygon-92"><a href="#get_regular_polygon-92"><span class="linenos"> 92</span></a><span class="sd">        \  /    \  /      |</span>
</span><span id="get_regular_polygon-93"><a href="#get_regular_polygon-93"><span class="linenos"> 93</span></a><span class="sd">         \/   ___\/___    |</span>
</span><span id="get_regular_polygon-94"><a href="#get_regular_polygon-94"><span class="linenos"> 94</span></a><span class="sd">         /\      /\      / \</span>
</span><span id="get_regular_polygon-95"><a href="#get_regular_polygon-95"><span class="linenos"> 95</span></a><span class="sd">        /  \    /  \    /   \</span>
</span><span id="get_regular_polygon-96"><a href="#get_regular_polygon-96"><span class="linenos"> 96</span></a>
</span><span id="get_regular_polygon-97"><a href="#get_regular_polygon-97"><span class="linenos"> 97</span></a><span class="sd">  The returned polygon is gridified. Note also that shapely silently reorders</span>
</span><span id="get_regular_polygon-98"><a href="#get_regular_polygon-98"><span class="linenos"> 98</span></a><span class="sd">  the coordinates clockwise from the lower left corner, regardless of the CCW</span>
</span><span id="get_regular_polygon-99"><a href="#get_regular_polygon-99"><span class="linenos"> 99</span></a><span class="sd">  order in which we supply them.</span>
</span><span id="get_regular_polygon-100"><a href="#get_regular_polygon-100"><span class="linenos">100</span></a>
</span><span id="get_regular_polygon-101"><a href="#get_regular_polygon-101"><span class="linenos">101</span></a><span class="sd">  Args:</span>
</span><span id="get_regular_polygon-102"><a href="#get_regular_polygon-102"><span class="linenos">102</span></a><span class="sd">    spacing (_type_): required height.</span>
</span><span id="get_regular_polygon-103"><a href="#get_regular_polygon-103"><span class="linenos">103</span></a><span class="sd">    n (int): number of sides.</span>
</span><span id="get_regular_polygon-104"><a href="#get_regular_polygon-104"><span class="linenos">104</span></a>
</span><span id="get_regular_polygon-105"><a href="#get_regular_polygon-105"><span class="linenos">105</span></a><span class="sd">  Returns:</span>
</span><span id="get_regular_polygon-106"><a href="#get_regular_polygon-106"><span class="linenos">106</span></a><span class="sd">    geom.Polygon: required geom.Polygon.</span>
</span><span id="get_regular_polygon-107"><a href="#get_regular_polygon-107"><span class="linenos">107</span></a>
</span><span id="get_regular_polygon-108"><a href="#get_regular_polygon-108"><span class="linenos">108</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_regular_polygon-109"><a href="#get_regular_polygon-109"><span class="linenos">109</span></a>  <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="get_regular_polygon-110"><a href="#get_regular_polygon-110"><span class="linenos">110</span></a>    <span class="n">R</span> <span class="o">=</span> <span class="n">spacing</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="get_regular_polygon-111"><a href="#get_regular_polygon-111"><span class="linenos">111</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="get_regular_polygon-112"><a href="#get_regular_polygon-112"><span class="linenos">112</span></a>    <span class="n">R</span> <span class="o">=</span> <span class="n">spacing</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
</span><span id="get_regular_polygon-113"><a href="#get_regular_polygon-113"><span class="linenos">113</span></a>  <span class="n">angle_0</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">n</span>
</span><span id="get_regular_polygon-114"><a href="#get_regular_polygon-114"><span class="linenos">114</span></a>  <span class="n">a_diff</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">n</span>
</span><span id="get_regular_polygon-115"><a href="#get_regular_polygon-115"><span class="linenos">115</span></a>  <span class="n">angles</span> <span class="o">=</span> <span class="p">[</span><span class="n">angle_0</span> <span class="o">+</span> <span class="n">a_diff</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
</span><span id="get_regular_polygon-116"><a href="#get_regular_polygon-116"><span class="linenos">116</span></a>  <span class="n">corners</span> <span class="o">=</span> <span class="p">[(</span><span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span> <span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span> <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">]</span>
</span><span id="get_regular_polygon-117"><a href="#get_regular_polygon-117"><span class="linenos">117</span></a>  <span class="k">return</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return regular n-gon centered on (0, 0) with height specified.</p>

<p>n-gon has horizontal base and height given by spacing. Generation is based on
equally spaced points around a circle with a radius calculated slightly
differently, depending on whether the number of sides is even or odd.</p>

<pre><code>      Even         Odd
  \  /    \  /      |
   \/   ___\/___    |
   /\      /\      / \
  /  \    /  \    /   \
</code></pre>

<p>The returned polygon is gridified. Note also that shapely silently reorders
the coordinates clockwise from the lower left corner, regardless of the CCW
order in which we supply them.</p>

<p>Args:
  spacing (_type_): required height.
  n (int): number of sides.</p>

<p>Returns:
  geom.Polygon: required geom.Polygon.</p>
</div>


                </section>
                <section id="get_corners">
                            <input id="get_corners-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_corners</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">shape</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span>,</span><span class="param">	<span class="n">repeat_first</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">Point</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="get_corners-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_corners"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_corners-120"><a href="#get_corners-120"><span class="linenos">120</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_corners</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">,</span>
</span><span id="get_corners-121"><a href="#get_corners-121"><span class="linenos">121</span></a>                <span class="n">repeat_first</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">]:</span>
</span><span id="get_corners-122"><a href="#get_corners-122"><span class="linenos">122</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return list of geom.Points on boundary of a polygon.</span>
</span><span id="get_corners-123"><a href="#get_corners-123"><span class="linenos">123</span></a>
</span><span id="get_corners-124"><a href="#get_corners-124"><span class="linenos">124</span></a><span class="sd">  The first point is optionally repeated. No simplification is carried out</span>
</span><span id="get_corners-125"><a href="#get_corners-125"><span class="linenos">125</span></a><span class="sd">  (e.g. if a line segment has a &#39;corner&#39; along its length, it is NOT removed;</span>
</span><span id="get_corners-126"><a href="#get_corners-126"><span class="linenos">126</span></a><span class="sd">  see get_clean_polygon for that). Points have precision set to the</span>
</span><span id="get_corners-127"><a href="#get_corners-127"><span class="linenos">127</span></a><span class="sd">  packagedefault tiling_utils.RESOLUTION.</span>
</span><span id="get_corners-128"><a href="#get_corners-128"><span class="linenos">128</span></a>
</span><span id="get_corners-129"><a href="#get_corners-129"><span class="linenos">129</span></a><span class="sd">  Args:</span>
</span><span id="get_corners-130"><a href="#get_corners-130"><span class="linenos">130</span></a><span class="sd">    shape (geom.Polygon): polygon whose corners are required.</span>
</span><span id="get_corners-131"><a href="#get_corners-131"><span class="linenos">131</span></a><span class="sd">    repeat_first (bool, optional): if True the first corner is repeated in the</span>
</span><span id="get_corners-132"><a href="#get_corners-132"><span class="linenos">132</span></a><span class="sd">      returned list, if False it is omitted. Defaults to True.</span>
</span><span id="get_corners-133"><a href="#get_corners-133"><span class="linenos">133</span></a>
</span><span id="get_corners-134"><a href="#get_corners-134"><span class="linenos">134</span></a><span class="sd">  Returns:</span>
</span><span id="get_corners-135"><a href="#get_corners-135"><span class="linenos">135</span></a><span class="sd">    list[geom.Point]: list of geom.Point vertices of the polygon.</span>
</span><span id="get_corners-136"><a href="#get_corners-136"><span class="linenos">136</span></a>
</span><span id="get_corners-137"><a href="#get_corners-137"><span class="linenos">137</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_corners-138"><a href="#get_corners-138"><span class="linenos">138</span></a>  <span class="n">corners</span> <span class="o">=</span> <span class="p">[</span><span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">shape</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">]</span>
</span><span id="get_corners-139"><a href="#get_corners-139"><span class="linenos">139</span></a>  <span class="k">return</span> <span class="n">corners</span> <span class="k">if</span> <span class="n">repeat_first</span> <span class="k">else</span> <span class="n">corners</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Return list of geom.Points on boundary of a polygon.</p>

<p>The first point is optionally repeated. No simplification is carried out
(e.g. if a line segment has a 'corner' along its length, it is NOT removed;
see get_clean_polygon for that). Points have precision set to the
packagedefault tiling_utils.RESOLUTION.</p>

<p>Args:
  shape (geom.Polygon): polygon whose corners are required.
  repeat_first (bool, optional): if True the first corner is repeated in the
    returned list, if False it is omitted. Defaults to True.</p>

<p>Returns:
  list[geom.Point]: list of geom.Point vertices of the polygon.</p>
</div>


                </section>
                <section id="get_sides">
                            <input id="get_sides-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_sides</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">shape</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">linestring</span><span class="o">.</span><span class="n">LineString</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="get_sides-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_sides"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_sides-142"><a href="#get_sides-142"><span class="linenos">142</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_sides</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">]:</span>
</span><span id="get_sides-143"><a href="#get_sides-143"><span class="linenos">143</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return polygon sides as list of geom.LineStrings.</span>
</span><span id="get_sides-144"><a href="#get_sides-144"><span class="linenos">144</span></a>
</span><span id="get_sides-145"><a href="#get_sides-145"><span class="linenos">145</span></a><span class="sd">  Resolution is set to the package default tiling_utils.RESOLUTION. No</span>
</span><span id="get_sides-146"><a href="#get_sides-146"><span class="linenos">146</span></a><span class="sd">  simplification for successive colinear sides is carried out.</span>
</span><span id="get_sides-147"><a href="#get_sides-147"><span class="linenos">147</span></a>
</span><span id="get_sides-148"><a href="#get_sides-148"><span class="linenos">148</span></a><span class="sd">  Args:</span>
</span><span id="get_sides-149"><a href="#get_sides-149"><span class="linenos">149</span></a><span class="sd">    shape (geom.Polygon): polygon whose edges are required.</span>
</span><span id="get_sides-150"><a href="#get_sides-150"><span class="linenos">150</span></a>
</span><span id="get_sides-151"><a href="#get_sides-151"><span class="linenos">151</span></a><span class="sd">  Returns:</span>
</span><span id="get_sides-152"><a href="#get_sides-152"><span class="linenos">152</span></a><span class="sd">    list[geom.LineString]: list of geom.LineString sides of the polygon.</span>
</span><span id="get_sides-153"><a href="#get_sides-153"><span class="linenos">153</span></a>
</span><span id="get_sides-154"><a href="#get_sides-154"><span class="linenos">154</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_sides-155"><a href="#get_sides-155"><span class="linenos">155</span></a>  <span class="n">corners</span> <span class="o">=</span> <span class="n">get_corners</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="get_sides-156"><a href="#get_sides-156"><span class="linenos">156</span></a>  <span class="k">return</span> <span class="p">[</span><span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">])</span>
</span><span id="get_sides-157"><a href="#get_sides-157"><span class="linenos">157</span></a>          <span class="k">for</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">corners</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">corners</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">strict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)]</span>
</span></pre></div>


            <div class="docstring"><p>Return polygon sides as list of geom.LineStrings.</p>

<p>Resolution is set to the package default tiling_utils.RESOLUTION. No
simplification for successive colinear sides is carried out.</p>

<p>Args:
  shape (geom.Polygon): polygon whose edges are required.</p>

<p>Returns:
  list[geom.LineString]: list of geom.LineString sides of the polygon.</p>
</div>


                </section>
                <section id="get_side_lengths">
                            <input id="get_side_lengths-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_side_lengths</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">shape</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="get_side_lengths-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_side_lengths"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_side_lengths-160"><a href="#get_side_lengths-160"><span class="linenos">160</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_side_lengths</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="get_side_lengths-161"><a href="#get_side_lengths-161"><span class="linenos">161</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return list of lengths of polygon sides.</span>
</span><span id="get_side_lengths-162"><a href="#get_side_lengths-162"><span class="linenos">162</span></a>
</span><span id="get_side_lengths-163"><a href="#get_side_lengths-163"><span class="linenos">163</span></a><span class="sd">  No simplification for corners along sides is carried out.</span>
</span><span id="get_side_lengths-164"><a href="#get_side_lengths-164"><span class="linenos">164</span></a>
</span><span id="get_side_lengths-165"><a href="#get_side_lengths-165"><span class="linenos">165</span></a><span class="sd">  Args:</span>
</span><span id="get_side_lengths-166"><a href="#get_side_lengths-166"><span class="linenos">166</span></a><span class="sd">    shape (geom.Polygon): polygon whose edge lengths are required.</span>
</span><span id="get_side_lengths-167"><a href="#get_side_lengths-167"><span class="linenos">167</span></a>
</span><span id="get_side_lengths-168"><a href="#get_side_lengths-168"><span class="linenos">168</span></a><span class="sd">  Returns:</span>
</span><span id="get_side_lengths-169"><a href="#get_side_lengths-169"><span class="linenos">169</span></a><span class="sd">    list[float]: list of side lengths.</span>
</span><span id="get_side_lengths-170"><a href="#get_side_lengths-170"><span class="linenos">170</span></a>
</span><span id="get_side_lengths-171"><a href="#get_side_lengths-171"><span class="linenos">171</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_side_lengths-172"><a href="#get_side_lengths-172"><span class="linenos">172</span></a>  <span class="n">corners</span> <span class="o">=</span> <span class="n">get_corners</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="get_side_lengths-173"><a href="#get_side_lengths-173"><span class="linenos">173</span></a>  <span class="k">return</span> <span class="p">[</span>
</span><span id="get_side_lengths-174"><a href="#get_side_lengths-174"><span class="linenos">174</span></a>    <span class="n">p1</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span> <span class="k">for</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">corners</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">corners</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">strict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)]</span>
</span></pre></div>


            <div class="docstring"><p>Return list of lengths of polygon sides.</p>

<p>No simplification for corners along sides is carried out.</p>

<p>Args:
  shape (geom.Polygon): polygon whose edge lengths are required.</p>

<p>Returns:
  list[float]: list of side lengths.</p>
</div>


                </section>
                <section id="get_side_bearings">
                            <input id="get_side_bearings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_side_bearings</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">shape</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="get_side_bearings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_side_bearings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_side_bearings-177"><a href="#get_side_bearings-177"><span class="linenos">177</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_side_bearings</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">]:</span>
</span><span id="get_side_bearings-178"><a href="#get_side_bearings-178"><span class="linenos">178</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return list of angles between sides of polygon and the positive x-axis.</span>
</span><span id="get_side_bearings-179"><a href="#get_side_bearings-179"><span class="linenos">179</span></a>
</span><span id="get_side_bearings-180"><a href="#get_side_bearings-180"><span class="linenos">180</span></a><span class="sd">  Angle is in degrees and calculated when proceeding from the first point in</span>
</span><span id="get_side_bearings-181"><a href="#get_side_bearings-181"><span class="linenos">181</span></a><span class="sd">  each side to its end point. This should usually be CW around the polygon.</span>
</span><span id="get_side_bearings-182"><a href="#get_side_bearings-182"><span class="linenos">182</span></a>
</span><span id="get_side_bearings-183"><a href="#get_side_bearings-183"><span class="linenos">183</span></a><span class="sd">  Args:</span>
</span><span id="get_side_bearings-184"><a href="#get_side_bearings-184"><span class="linenos">184</span></a><span class="sd">    shape (geom.Polygon): polygon whose side bearings are required.</span>
</span><span id="get_side_bearings-185"><a href="#get_side_bearings-185"><span class="linenos">185</span></a>
</span><span id="get_side_bearings-186"><a href="#get_side_bearings-186"><span class="linenos">186</span></a><span class="sd">  Returns:</span>
</span><span id="get_side_bearings-187"><a href="#get_side_bearings-187"><span class="linenos">187</span></a><span class="sd">    tuple[float,...]: tuple of bearings of each edge.</span>
</span><span id="get_side_bearings-188"><a href="#get_side_bearings-188"><span class="linenos">188</span></a>
</span><span id="get_side_bearings-189"><a href="#get_side_bearings-189"><span class="linenos">189</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_side_bearings-190"><a href="#get_side_bearings-190"><span class="linenos">190</span></a>  <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span>
</span><span id="get_side_bearings-191"><a href="#get_side_bearings-191"><span class="linenos">191</span></a>    <span class="n">e</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">e</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">e</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">e</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="get_side_bearings-192"><a href="#get_side_bearings-192"><span class="linenos">192</span></a>    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">get_sides</span><span class="p">(</span><span class="n">shape</span><span class="p">)])</span>
</span></pre></div>


            <div class="docstring"><p>Return list of angles between sides of polygon and the positive x-axis.</p>

<p>Angle is in degrees and calculated when proceeding from the first point in
each side to its end point. This should usually be CW around the polygon.</p>

<p>Args:
  shape (geom.Polygon): polygon whose side bearings are required.</p>

<p>Returns:
  tuple[float,...]: tuple of bearings of each edge.</p>
</div>


                </section>
                <section id="get_interior_angles">
                            <input id="get_interior_angles-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_interior_angles</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">shape</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="get_interior_angles-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_interior_angles"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_interior_angles-195"><a href="#get_interior_angles-195"><span class="linenos">195</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_interior_angles</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="get_interior_angles-196"><a href="#get_interior_angles-196"><span class="linenos">196</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return angles (in degrees) between successive edges of a polygon.</span>
</span><span id="get_interior_angles-197"><a href="#get_interior_angles-197"><span class="linenos">197</span></a>
</span><span id="get_interior_angles-198"><a href="#get_interior_angles-198"><span class="linenos">198</span></a><span class="sd">  No polygon simplification is carried out so some angles may be 180 (i.e. a</span>
</span><span id="get_interior_angles-199"><a href="#get_interior_angles-199"><span class="linenos">199</span></a><span class="sd">  &#39;corner&#39; along a side, such that successive sides are colinear).</span>
</span><span id="get_interior_angles-200"><a href="#get_interior_angles-200"><span class="linenos">200</span></a>
</span><span id="get_interior_angles-201"><a href="#get_interior_angles-201"><span class="linenos">201</span></a><span class="sd">  Args:</span>
</span><span id="get_interior_angles-202"><a href="#get_interior_angles-202"><span class="linenos">202</span></a><span class="sd">    shape (geom.Polygon): polygon whose angles are required.</span>
</span><span id="get_interior_angles-203"><a href="#get_interior_angles-203"><span class="linenos">203</span></a>
</span><span id="get_interior_angles-204"><a href="#get_interior_angles-204"><span class="linenos">204</span></a><span class="sd">  Returns:</span>
</span><span id="get_interior_angles-205"><a href="#get_interior_angles-205"><span class="linenos">205</span></a><span class="sd">    list[float]: list of angles.</span>
</span><span id="get_interior_angles-206"><a href="#get_interior_angles-206"><span class="linenos">206</span></a>
</span><span id="get_interior_angles-207"><a href="#get_interior_angles-207"><span class="linenos">207</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_interior_angles-208"><a href="#get_interior_angles-208"><span class="linenos">208</span></a>  <span class="n">corners</span> <span class="o">=</span> <span class="n">get_corners</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">repeat_first</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="get_interior_angles-209"><a href="#get_interior_angles-209"><span class="linenos">209</span></a>  <span class="n">wrap_corners</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">corners</span> <span class="o">+</span> <span class="n">corners</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
</span><span id="get_interior_angles-210"><a href="#get_interior_angles-210"><span class="linenos">210</span></a>  <span class="n">triples</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wrap_corners</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span>
</span><span id="get_interior_angles-211"><a href="#get_interior_angles-211"><span class="linenos">211</span></a>                <span class="n">wrap_corners</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="get_interior_angles-212"><a href="#get_interior_angles-212"><span class="linenos">212</span></a>                <span class="n">wrap_corners</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">strict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="get_interior_angles-213"><a href="#get_interior_angles-213"><span class="linenos">213</span></a>  <span class="k">return</span> <span class="p">[</span><span class="n">get_inner_angle</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span> <span class="k">for</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span> <span class="ow">in</span> <span class="n">triples</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Return angles (in degrees) between successive edges of a polygon.</p>

<p>No polygon simplification is carried out so some angles may be 180 (i.e. a
'corner' along a side, such that successive sides are colinear).</p>

<p>Args:
  shape (geom.Polygon): polygon whose angles are required.</p>

<p>Returns:
  list[float]: list of angles.</p>
</div>


                </section>
                <section id="get_clean_polygon">
                            <input id="get_clean_polygon-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_clean_polygon</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">shape</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">multipolygon</span><span class="o">.</span><span class="n">MultiPolygon</span> <span class="o">|</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span> <span class="o">|</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geoseries</span><span class="o">.</span><span class="n">GeoSeries</span></span><span class="return-annotation">) -> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">multipolygon</span><span class="o">.</span><span class="n">MultiPolygon</span> <span class="o">|</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span> <span class="o">|</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geoseries</span><span class="o">.</span><span class="n">GeoSeries</span>:</span></span>

                <label class="view-source-button" for="get_clean_polygon-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_clean_polygon"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_clean_polygon-216"><a href="#get_clean_polygon-216"><span class="linenos">216</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_clean_polygon</span><span class="p">(</span>
</span><span id="get_clean_polygon-217"><a href="#get_clean_polygon-217"><span class="linenos">217</span></a>      <span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="o">|</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="o">|</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">,</span>
</span><span id="get_clean_polygon-218"><a href="#get_clean_polygon-218"><span class="linenos">218</span></a>    <span class="p">)</span> <span class="o">-&gt;</span>  <span class="n">geom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="o">|</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="o">|</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">:</span>
</span><span id="get_clean_polygon-219"><a href="#get_clean_polygon-219"><span class="linenos">219</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return polygon with successive co-linear or very close corners removed.</span>
</span><span id="get_clean_polygon-220"><a href="#get_clean_polygon-220"><span class="linenos">220</span></a>
</span><span id="get_clean_polygon-221"><a href="#get_clean_polygon-221"><span class="linenos">221</span></a><span class="sd">  Particularly useful for tidying polygons weave tilings that have been</span>
</span><span id="get_clean_polygon-222"><a href="#get_clean_polygon-222"><span class="linenos">222</span></a><span class="sd">  assembled from multiple &#39;cells&#39; in the weave grid.</span>
</span><span id="get_clean_polygon-223"><a href="#get_clean_polygon-223"><span class="linenos">223</span></a>
</span><span id="get_clean_polygon-224"><a href="#get_clean_polygon-224"><span class="linenos">224</span></a><span class="sd">  Args:</span>
</span><span id="get_clean_polygon-225"><a href="#get_clean_polygon-225"><span class="linenos">225</span></a><span class="sd">    shape (geom.MultiPolygon|geom.Polygon): polygon to clean.</span>
</span><span id="get_clean_polygon-226"><a href="#get_clean_polygon-226"><span class="linenos">226</span></a>
</span><span id="get_clean_polygon-227"><a href="#get_clean_polygon-227"><span class="linenos">227</span></a><span class="sd">  Returns:</span>
</span><span id="get_clean_polygon-228"><a href="#get_clean_polygon-228"><span class="linenos">228</span></a><span class="sd">    geom.Polygon: cleaned polygon.</span>
</span><span id="get_clean_polygon-229"><a href="#get_clean_polygon-229"><span class="linenos">229</span></a>
</span><span id="get_clean_polygon-230"><a href="#get_clean_polygon-230"><span class="linenos">230</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_clean_polygon-231"><a href="#get_clean_polygon-231"><span class="linenos">231</span></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">geom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">):</span>
</span><span id="get_clean_polygon-232"><a href="#get_clean_polygon-232"><span class="linenos">232</span></a>    <span class="k">return</span> <span class="n">geom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">([</span><span class="n">get_clean_polygon</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">shape</span><span class="o">.</span><span class="n">geoms</span><span class="p">])</span>
</span><span id="get_clean_polygon-233"><a href="#get_clean_polygon-233"><span class="linenos">233</span></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">geom</span><span class="o">.</span><span class="n">GeometryCollection</span><span class="p">):</span>
</span><span id="get_clean_polygon-234"><a href="#get_clean_polygon-234"><span class="linenos">234</span></a>    <span class="n">elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">shape</span><span class="o">.</span><span class="n">geoms</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)]</span>
</span><span id="get_clean_polygon-235"><a href="#get_clean_polygon-235"><span class="linenos">235</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="get_clean_polygon-236"><a href="#get_clean_polygon-236"><span class="linenos">236</span></a>      <span class="k">return</span> <span class="n">get_clean_polygon</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span>
</span><span id="get_clean_polygon-237"><a href="#get_clean_polygon-237"><span class="linenos">237</span></a>    <span class="k">return</span> <span class="n">get_clean_polygon</span><span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="get_clean_polygon-238"><a href="#get_clean_polygon-238"><span class="linenos">238</span></a>  <span class="n">corners</span> <span class="o">=</span> <span class="n">get_corners</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">repeat_first</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="get_clean_polygon-239"><a href="#get_clean_polygon-239"><span class="linenos">239</span></a>  <span class="c1"># first remove any &#39;near neighbour&#39; corners</span>
</span><span id="get_clean_polygon-240"><a href="#get_clean_polygon-240"><span class="linenos">240</span></a>  <span class="n">distances</span> <span class="o">=</span> <span class="n">get_side_lengths</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="get_clean_polygon-241"><a href="#get_clean_polygon-241"><span class="linenos">241</span></a>  <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">RESOLUTION</span><span class="p">)</span>
</span><span id="get_clean_polygon-242"><a href="#get_clean_polygon-242"><span class="linenos">242</span></a>                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">distances</span><span class="p">]</span>
</span><span id="get_clean_polygon-243"><a href="#get_clean_polygon-243"><span class="linenos">243</span></a>  <span class="n">corners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">to_remove</span><span class="p">,</span> <span class="n">strict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="p">]</span>
</span><span id="get_clean_polygon-244"><a href="#get_clean_polygon-244"><span class="linenos">244</span></a>  <span class="c1"># next remove any that are colinear</span>
</span><span id="get_clean_polygon-245"><a href="#get_clean_polygon-245"><span class="linenos">245</span></a>  <span class="n">p</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
</span><span id="get_clean_polygon-246"><a href="#get_clean_polygon-246"><span class="linenos">246</span></a>  <span class="n">corners</span> <span class="o">=</span> <span class="n">get_corners</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">repeat_first</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="get_clean_polygon-247"><a href="#get_clean_polygon-247"><span class="linenos">247</span></a>  <span class="n">angles</span> <span class="o">=</span> <span class="n">get_interior_angles</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="get_clean_polygon-248"><a href="#get_clean_polygon-248"><span class="linenos">248</span></a>  <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">a</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">)</span> <span class="ow">or</span>
</span><span id="get_clean_polygon-249"><a href="#get_clean_polygon-249"><span class="linenos">249</span></a>               <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">)</span>
</span><span id="get_clean_polygon-250"><a href="#get_clean_polygon-250"><span class="linenos">250</span></a>               <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">]</span>
</span><span id="get_clean_polygon-251"><a href="#get_clean_polygon-251"><span class="linenos">251</span></a>  <span class="n">corners</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">to_remove</span><span class="p">,</span> <span class="n">strict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="p">]</span>
</span><span id="get_clean_polygon-252"><a href="#get_clean_polygon-252"><span class="linenos">252</span></a>  <span class="k">return</span> <span class="n">gridify</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">corners</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Return polygon with successive co-linear or very close corners removed.</p>

<p>Particularly useful for tidying polygons weave tilings that have been
assembled from multiple 'cells' in the weave grid.</p>

<p>Args:
  shape (geom.MultiPolygon|geom.Polygon): polygon to clean.</p>

<p>Returns:
  geom.Polygon: cleaned polygon.</p>
</div>


                </section>
                <section id="rotate_preserving_order">
                            <input id="rotate_preserving_order-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rotate_preserving_order</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">polygon</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span>,</span><span class="param">	<span class="n">angle</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">centre</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">Point</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span>:</span></span>

                <label class="view-source-button" for="rotate_preserving_order-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#rotate_preserving_order"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="rotate_preserving_order-255"><a href="#rotate_preserving_order-255"><span class="linenos">255</span></a><span class="k">def</span><span class="w"> </span><span class="nf">rotate_preserving_order</span><span class="p">(</span>
</span><span id="rotate_preserving_order-256"><a href="#rotate_preserving_order-256"><span class="linenos">256</span></a>    <span class="n">polygon</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">,</span>
</span><span id="rotate_preserving_order-257"><a href="#rotate_preserving_order-257"><span class="linenos">257</span></a>    <span class="n">angle</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span>
</span><span id="rotate_preserving_order-258"><a href="#rotate_preserving_order-258"><span class="linenos">258</span></a>    <span class="n">centre</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Point</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="rotate_preserving_order-259"><a href="#rotate_preserving_order-259"><span class="linenos">259</span></a>  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">:</span>
</span><span id="rotate_preserving_order-260"><a href="#rotate_preserving_order-260"><span class="linenos">260</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return supplied polygon rotated with order of corners preserved.</span>
</span><span id="rotate_preserving_order-261"><a href="#rotate_preserving_order-261"><span class="linenos">261</span></a>
</span><span id="rotate_preserving_order-262"><a href="#rotate_preserving_order-262"><span class="linenos">262</span></a><span class="sd">  Order of polygon corners is not guaranteed to be preserved by shapely.</span>
</span><span id="rotate_preserving_order-263"><a href="#rotate_preserving_order-263"><span class="linenos">263</span></a><span class="sd">  affinity.rotate).</span>
</span><span id="rotate_preserving_order-264"><a href="#rotate_preserving_order-264"><span class="linenos">264</span></a>
</span><span id="rotate_preserving_order-265"><a href="#rotate_preserving_order-265"><span class="linenos">265</span></a><span class="sd">  Args:</span>
</span><span id="rotate_preserving_order-266"><a href="#rotate_preserving_order-266"><span class="linenos">266</span></a><span class="sd">    polygon (geom.Polygon): polygon to rotate.</span>
</span><span id="rotate_preserving_order-267"><a href="#rotate_preserving_order-267"><span class="linenos">267</span></a><span class="sd">    angle (float): desired angle of rotation (in degrees).</span>
</span><span id="rotate_preserving_order-268"><a href="#rotate_preserving_order-268"><span class="linenos">268</span></a><span class="sd">    centre (geom.Point): the rotation centre (passed on to shapely.affinity.</span>
</span><span id="rotate_preserving_order-269"><a href="#rotate_preserving_order-269"><span class="linenos">269</span></a><span class="sd">      rotate).</span>
</span><span id="rotate_preserving_order-270"><a href="#rotate_preserving_order-270"><span class="linenos">270</span></a>
</span><span id="rotate_preserving_order-271"><a href="#rotate_preserving_order-271"><span class="linenos">271</span></a><span class="sd">  Returns:</span>
</span><span id="rotate_preserving_order-272"><a href="#rotate_preserving_order-272"><span class="linenos">272</span></a><span class="sd">    geom.Polygon: rotated polygon.</span>
</span><span id="rotate_preserving_order-273"><a href="#rotate_preserving_order-273"><span class="linenos">273</span></a>
</span><span id="rotate_preserving_order-274"><a href="#rotate_preserving_order-274"><span class="linenos">274</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="rotate_preserving_order-275"><a href="#rotate_preserving_order-275"><span class="linenos">275</span></a>  <span class="n">ctr</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span> <span class="k">if</span> <span class="n">centre</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">centre</span>
</span><span id="rotate_preserving_order-276"><a href="#rotate_preserving_order-276"><span class="linenos">276</span></a>  <span class="n">corners</span> <span class="o">=</span> <span class="n">get_corners</span><span class="p">(</span><span class="n">polygon</span><span class="p">,</span> <span class="n">repeat_first</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="rotate_preserving_order-277"><a href="#rotate_preserving_order-277"><span class="linenos">277</span></a>  <span class="k">return</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">([</span><span class="n">affine</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">ctr</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">corners</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Return supplied polygon rotated with order of corners preserved.</p>

<p>Order of polygon corners is not guaranteed to be preserved by shapely.
affinity.rotate).</p>

<p>Args:
  polygon (geom.Polygon): polygon to rotate.
  angle (float): desired angle of rotation (in degrees).
  centre (geom.Point): the rotation centre (passed on to shapely.affinity.
    rotate).</p>

<p>Returns:
  geom.Polygon: rotated polygon.</p>
</div>


                </section>
                <section id="ensure_cw">
                            <input id="ensure_cw-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ensure_cw</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">shape</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span></span><span class="return-annotation">) -> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span>:</span></span>

                <label class="view-source-button" for="ensure_cw-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ensure_cw"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ensure_cw-280"><a href="#ensure_cw-280"><span class="linenos">280</span></a><span class="k">def</span><span class="w"> </span><span class="nf">ensure_cw</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">:</span>
</span><span id="ensure_cw-281"><a href="#ensure_cw-281"><span class="linenos">281</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return the polygon with its outer boundary vertices in clockwise order.</span>
</span><span id="ensure_cw-282"><a href="#ensure_cw-282"><span class="linenos">282</span></a>
</span><span id="ensure_cw-283"><a href="#ensure_cw-283"><span class="linenos">283</span></a><span class="sd">  It is important to note that shapely.set_precision() imposes clockwise order</span>
</span><span id="ensure_cw-284"><a href="#ensure_cw-284"><span class="linenos">284</span></a><span class="sd">  on polygons, and since it is used widely throughout theses modules, it makes</span>
</span><span id="ensure_cw-285"><a href="#ensure_cw-285"><span class="linenos">285</span></a><span class="sd">  sense to impose this order.</span>
</span><span id="ensure_cw-286"><a href="#ensure_cw-286"><span class="linenos">286</span></a>
</span><span id="ensure_cw-287"><a href="#ensure_cw-287"><span class="linenos">287</span></a><span class="sd">  Args:</span>
</span><span id="ensure_cw-288"><a href="#ensure_cw-288"><span class="linenos">288</span></a><span class="sd">    shape (geom.Polygon): the polygon.</span>
</span><span id="ensure_cw-289"><a href="#ensure_cw-289"><span class="linenos">289</span></a>
</span><span id="ensure_cw-290"><a href="#ensure_cw-290"><span class="linenos">290</span></a><span class="sd">  Returns:</span>
</span><span id="ensure_cw-291"><a href="#ensure_cw-291"><span class="linenos">291</span></a><span class="sd">    geom.Polygon: the polygon in clockwise order.</span>
</span><span id="ensure_cw-292"><a href="#ensure_cw-292"><span class="linenos">292</span></a>
</span><span id="ensure_cw-293"><a href="#ensure_cw-293"><span class="linenos">293</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="ensure_cw-294"><a href="#ensure_cw-294"><span class="linenos">294</span></a>  <span class="k">if</span> <span class="n">geom</span><span class="o">.</span><span class="n">LinearRing</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span><span class="o">.</span><span class="n">is_ccw</span><span class="p">:</span>
</span><span id="ensure_cw-295"><a href="#ensure_cw-295"><span class="linenos">295</span></a>    <span class="k">return</span> <span class="n">shape</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
</span><span id="ensure_cw-296"><a href="#ensure_cw-296"><span class="linenos">296</span></a>  <span class="k">return</span> <span class="n">shape</span>
</span></pre></div>


            <div class="docstring"><p>Return the polygon with its outer boundary vertices in clockwise order.</p>

<p>It is important to note that shapely.set_precision() imposes clockwise order
on polygons, and since it is used widely throughout theses modules, it makes
sense to impose this order.</p>

<p>Args:
  shape (geom.Polygon): the polygon.</p>

<p>Returns:
  geom.Polygon: the polygon in clockwise order.</p>
</div>


                </section>
                <section id="get_inner_angle">
                            <input id="get_inner_angle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_inner_angle</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">p1</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">Point</span>,</span><span class="param">	<span class="n">p2</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">Point</span>,</span><span class="param">	<span class="n">p3</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">Point</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="get_inner_angle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_inner_angle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_inner_angle-299"><a href="#get_inner_angle-299"><span class="linenos">299</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_inner_angle</span><span class="p">(</span><span class="n">p1</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">,</span> <span class="n">p3</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="get_inner_angle-300"><a href="#get_inner_angle-300"><span class="linenos">300</span></a><span class="w">  </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return angle between line p1-p2 and p2-p3, i.e., the angle A below.</span>
</span><span id="get_inner_angle-301"><a href="#get_inner_angle-301"><span class="linenos">301</span></a>
</span><span id="get_inner_angle-302"><a href="#get_inner_angle-302"><span class="linenos">302</span></a><span class="sd">            p2</span>
</span><span id="get_inner_angle-303"><a href="#get_inner_angle-303"><span class="linenos">303</span></a><span class="sd">           / \</span>
</span><span id="get_inner_angle-304"><a href="#get_inner_angle-304"><span class="linenos">304</span></a><span class="sd">          / A \</span>
</span><span id="get_inner_angle-305"><a href="#get_inner_angle-305"><span class="linenos">305</span></a><span class="sd">        p1     p3</span>
</span><span id="get_inner_angle-306"><a href="#get_inner_angle-306"><span class="linenos">306</span></a>
</span><span id="get_inner_angle-307"><a href="#get_inner_angle-307"><span class="linenos">307</span></a><span class="sd">  Args:</span>
</span><span id="get_inner_angle-308"><a href="#get_inner_angle-308"><span class="linenos">308</span></a><span class="sd">    p1 (geom.Point): first point.</span>
</span><span id="get_inner_angle-309"><a href="#get_inner_angle-309"><span class="linenos">309</span></a><span class="sd">    p2 (geom.Point): second &#39;corner&#39; point.</span>
</span><span id="get_inner_angle-310"><a href="#get_inner_angle-310"><span class="linenos">310</span></a><span class="sd">    p3 (geom.Point): third point.</span>
</span><span id="get_inner_angle-311"><a href="#get_inner_angle-311"><span class="linenos">311</span></a>
</span><span id="get_inner_angle-312"><a href="#get_inner_angle-312"><span class="linenos">312</span></a><span class="sd">  Returns:</span>
</span><span id="get_inner_angle-313"><a href="#get_inner_angle-313"><span class="linenos">313</span></a><span class="sd">    float: angle in degrees.</span>
</span><span id="get_inner_angle-314"><a href="#get_inner_angle-314"><span class="linenos">314</span></a>
</span><span id="get_inner_angle-315"><a href="#get_inner_angle-315"><span class="linenos">315</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_inner_angle-316"><a href="#get_inner_angle-316"><span class="linenos">316</span></a>  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">p3</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p3</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">p2</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span>
</span><span id="get_inner_angle-317"><a href="#get_inner_angle-317"><span class="linenos">317</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">p2</span><span class="o">.</span><span class="n">x</span><span class="p">))</span> <span class="o">%</span> <span class="mi">360</span>
</span></pre></div>


            <div class="docstring"><p>Return angle between line p1-p2 and p2-p3, i.e., the angle A below.</p>

<pre><code>      p2
     / \
    / A \
  p1     p3
</code></pre>

<p>Args:
  p1 (geom.Point): first point.
  p2 (geom.Point): second 'corner' point.
  p3 (geom.Point): third point.</p>

<p>Returns:
  float: angle in degrees.</p>
</div>


                </section>
                <section id="is_regular_polygon">
                            <input id="is_regular_polygon-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_regular_polygon</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">shape</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="is_regular_polygon-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#is_regular_polygon"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="is_regular_polygon-320"><a href="#is_regular_polygon-320"><span class="linenos">320</span></a><span class="k">def</span><span class="w"> </span><span class="nf">is_regular_polygon</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="is_regular_polygon-321"><a href="#is_regular_polygon-321"><span class="linenos">321</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Test if supplied polygon is regular (i.e. equal sides and angles).</span>
</span><span id="is_regular_polygon-322"><a href="#is_regular_polygon-322"><span class="linenos">322</span></a>
</span><span id="is_regular_polygon-323"><a href="#is_regular_polygon-323"><span class="linenos">323</span></a><span class="sd">  Args:</span>
</span><span id="is_regular_polygon-324"><a href="#is_regular_polygon-324"><span class="linenos">324</span></a><span class="sd">    shape (geom.Polygon): polygon to test.</span>
</span><span id="is_regular_polygon-325"><a href="#is_regular_polygon-325"><span class="linenos">325</span></a>
</span><span id="is_regular_polygon-326"><a href="#is_regular_polygon-326"><span class="linenos">326</span></a><span class="sd">  Returns:</span>
</span><span id="is_regular_polygon-327"><a href="#is_regular_polygon-327"><span class="linenos">327</span></a><span class="sd">    bool: True if polygon is regular, False if not.</span>
</span><span id="is_regular_polygon-328"><a href="#is_regular_polygon-328"><span class="linenos">328</span></a>
</span><span id="is_regular_polygon-329"><a href="#is_regular_polygon-329"><span class="linenos">329</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="is_regular_polygon-330"><a href="#is_regular_polygon-330"><span class="linenos">330</span></a>  <span class="n">side_lengths</span> <span class="o">=</span> <span class="n">get_side_lengths</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="is_regular_polygon-331"><a href="#is_regular_polygon-331"><span class="linenos">331</span></a>  <span class="n">angles</span> <span class="o">=</span> <span class="n">get_interior_angles</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="is_regular_polygon-332"><a href="#is_regular_polygon-332"><span class="linenos">332</span></a>  <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">side_lengths</span><span class="p">,</span> <span class="n">side_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> \
</span><span id="is_regular_polygon-333"><a href="#is_regular_polygon-333"><span class="linenos">333</span></a>     <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">angles</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span></pre></div>


            <div class="docstring"><p>Test if supplied polygon is regular (i.e. equal sides and angles).</p>

<p>Args:
  shape (geom.Polygon): polygon to test.</p>

<p>Returns:
  bool: True if polygon is regular, False if not.</p>
</div>


                </section>
                <section id="is_tangential">
                            <input id="is_tangential-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_tangential</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">shape</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="is_tangential-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#is_tangential"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="is_tangential-336"><a href="#is_tangential-336"><span class="linenos">336</span></a><span class="k">def</span><span class="w"> </span><span class="nf">is_tangential</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="is_tangential-337"><a href="#is_tangential-337"><span class="linenos">337</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Determine if supplied polygon is tangential.</span>
</span><span id="is_tangential-338"><a href="#is_tangential-338"><span class="linenos">338</span></a>
</span><span id="is_tangential-339"><a href="#is_tangential-339"><span class="linenos">339</span></a><span class="sd">  A tangential polygon can have a circle inscribed tangential to all its sides.</span>
</span><span id="is_tangential-340"><a href="#is_tangential-340"><span class="linenos">340</span></a>
</span><span id="is_tangential-341"><a href="#is_tangential-341"><span class="linenos">341</span></a><span class="sd">  NOTE: not currently used but retained in case incentre is restored to use</span>
</span><span id="is_tangential-342"><a href="#is_tangential-342"><span class="linenos">342</span></a><span class="sd">  &#39;home made&#39; code rather than polylabel.polylabel.</span>
</span><span id="is_tangential-343"><a href="#is_tangential-343"><span class="linenos">343</span></a>
</span><span id="is_tangential-344"><a href="#is_tangential-344"><span class="linenos">344</span></a><span class="sd">  Note that this will fail for polygons with successive colinear sides, meaning</span>
</span><span id="is_tangential-345"><a href="#is_tangential-345"><span class="linenos">345</span></a><span class="sd">  that polygons should be fully simplified...</span>
</span><span id="is_tangential-346"><a href="#is_tangential-346"><span class="linenos">346</span></a>
</span><span id="is_tangential-347"><a href="#is_tangential-347"><span class="linenos">347</span></a><span class="sd">  Args:</span>
</span><span id="is_tangential-348"><a href="#is_tangential-348"><span class="linenos">348</span></a><span class="sd">    shape (geom.Polygon): polygon to test.</span>
</span><span id="is_tangential-349"><a href="#is_tangential-349"><span class="linenos">349</span></a>
</span><span id="is_tangential-350"><a href="#is_tangential-350"><span class="linenos">350</span></a><span class="sd">  Returns:</span>
</span><span id="is_tangential-351"><a href="#is_tangential-351"><span class="linenos">351</span></a><span class="sd">    bool: True if polygon is tangential, False if not.</span>
</span><span id="is_tangential-352"><a href="#is_tangential-352"><span class="linenos">352</span></a>
</span><span id="is_tangential-353"><a href="#is_tangential-353"><span class="linenos">353</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="is_tangential-354"><a href="#is_tangential-354"><span class="linenos">354</span></a>  <span class="k">if</span> <span class="n">is_regular_polygon</span><span class="p">(</span><span class="n">shape</span><span class="p">):</span>
</span><span id="is_tangential-355"><a href="#is_tangential-355"><span class="linenos">355</span></a>    <span class="k">return</span> <span class="kc">True</span>
</span><span id="is_tangential-356"><a href="#is_tangential-356"><span class="linenos">356</span></a>  <span class="n">side_lengths</span> <span class="o">=</span> <span class="n">get_side_lengths</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="is_tangential-357"><a href="#is_tangential-357"><span class="linenos">357</span></a>  <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">side_lengths</span><span class="p">)</span>
</span><span id="is_tangential-358"><a href="#is_tangential-358"><span class="linenos">358</span></a>  <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="is_tangential-359"><a href="#is_tangential-359"><span class="linenos">359</span></a>    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="c1">#triangles are easy!</span>
</span><span id="is_tangential-360"><a href="#is_tangential-360"><span class="linenos">360</span></a>      <span class="k">return</span> <span class="kc">True</span>
</span><span id="is_tangential-361"><a href="#is_tangential-361"><span class="linenos">361</span></a>    <span class="c1"># odd number of sides there is a nice solvable system  of equations see</span>
</span><span id="is_tangential-362"><a href="#is_tangential-362"><span class="linenos">362</span></a>    <span class="c1"># https://math.stackexchange.com/questions/4065370/tangential-polygons-conditions-on-edge-lengths</span>
</span><span id="is_tangential-363"><a href="#is_tangential-363"><span class="linenos">363</span></a>    <span class="c1">#</span>
</span><span id="is_tangential-364"><a href="#is_tangential-364"><span class="linenos">364</span></a>    <span class="c1"># TODO: this is not reliable for reasons I don&#39;t fully understand. There is</span>
</span><span id="is_tangential-365"><a href="#is_tangential-365"><span class="linenos">365</span></a>    <span class="c1"># a corresponding crude catch exception in incentre... but this needs a</span>
</span><span id="is_tangential-366"><a href="#is_tangential-366"><span class="linenos">366</span></a>    <span class="c1"># more complete investigation</span>
</span><span id="is_tangential-367"><a href="#is_tangential-367"><span class="linenos">367</span></a>    <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="is_tangential-368"><a href="#is_tangential-368"><span class="linenos">368</span></a>    <span class="n">fractions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span> <span class="o">@</span> <span class="n">side_lengths</span> <span class="o">/</span> <span class="n">side_lengths</span>
</span><span id="is_tangential-369"><a href="#is_tangential-369"><span class="linenos">369</span></a>    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fractions</span><span class="p">),</span>
</span><span id="is_tangential-370"><a href="#is_tangential-370"><span class="linenos">370</span></a>                      <span class="mf">0.5</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">)):</span>
</span><span id="is_tangential-371"><a href="#is_tangential-371"><span class="linenos">371</span></a>      <span class="k">return</span> <span class="kc">False</span>
</span><span id="is_tangential-372"><a href="#is_tangential-372"><span class="linenos">372</span></a>    <span class="n">ones</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">)</span>
</span><span id="is_tangential-373"><a href="#is_tangential-373"><span class="linenos">373</span></a>            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fractions</span><span class="p">]</span>
</span><span id="is_tangential-374"><a href="#is_tangential-374"><span class="linenos">374</span></a>    <span class="n">zeros</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">)</span>
</span><span id="is_tangential-375"><a href="#is_tangential-375"><span class="linenos">375</span></a>             <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fractions</span><span class="p">]</span>
</span><span id="is_tangential-376"><a href="#is_tangential-376"><span class="linenos">376</span></a>    <span class="n">negatives</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fractions</span><span class="p">]</span>
</span><span id="is_tangential-377"><a href="#is_tangential-377"><span class="linenos">377</span></a>    <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">ones</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">zeros</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">negatives</span><span class="p">))</span>
</span><span id="is_tangential-378"><a href="#is_tangential-378"><span class="linenos">378</span></a>  <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="is_tangential-379"><a href="#is_tangential-379"><span class="linenos">379</span></a>    <span class="c1"># for quadrilaterals odd and even side lengths are equal</span>
</span><span id="is_tangential-380"><a href="#is_tangential-380"><span class="linenos">380</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">side_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]),</span>
</span><span id="is_tangential-381"><a href="#is_tangential-381"><span class="linenos">381</span></a>                      <span class="nb">sum</span><span class="p">(</span><span class="n">side_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]),</span> <span class="n">rtol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">)</span>
</span><span id="is_tangential-382"><a href="#is_tangential-382"><span class="linenos">382</span></a>  <span class="c1"># other even numbers of sides... hard to avoid brute force</span>
</span><span id="is_tangential-383"><a href="#is_tangential-383"><span class="linenos">383</span></a>  <span class="n">bisectors</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_angle_bisector</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
</span><span id="is_tangential-384"><a href="#is_tangential-384"><span class="linenos">384</span></a>  <span class="n">intersects</span> <span class="o">=</span> <span class="p">[</span><span class="n">b1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">b2</span><span class="p">)</span> <span class="k">for</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span> <span class="ow">in</span>
</span><span id="is_tangential-385"><a href="#is_tangential-385"><span class="linenos">385</span></a>                <span class="nb">zip</span><span class="p">(</span><span class="n">bisectors</span><span class="p">,</span> <span class="n">bisectors</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">bisectors</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">strict</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="is_tangential-386"><a href="#is_tangential-386"><span class="linenos">386</span></a>                <span class="k">if</span> <span class="n">b1</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">b2</span><span class="p">)]</span>
</span><span id="is_tangential-387"><a href="#is_tangential-387"><span class="linenos">387</span></a>  <span class="n">distances</span> <span class="o">=</span> <span class="p">[</span><span class="n">i1</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">i2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="ow">in</span>
</span><span id="is_tangential-388"><a href="#is_tangential-388"><span class="linenos">388</span></a>               <span class="nb">zip</span><span class="p">(</span><span class="n">intersects</span><span class="p">,</span> <span class="n">intersects</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">intersects</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span>
</span><span id="is_tangential-389"><a href="#is_tangential-389"><span class="linenos">389</span></a>                   <span class="n">strict</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)]</span>
</span><span id="is_tangential-390"><a href="#is_tangential-390"><span class="linenos">390</span></a>  <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="n">d</span> <span class="o">&lt;=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">RESOLUTION</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">distances</span><span class="p">])</span>  <span class="c1"># noqa: C419</span>
</span></pre></div>


            <div class="docstring"><p>Determine if supplied polygon is tangential.</p>

<p>A tangential polygon can have a circle inscribed tangential to all its sides.</p>

<p>NOTE: not currently used but retained in case incentre is restored to use
'home made' code rather than polylabel.polylabel.</p>

<p>Note that this will fail for polygons with successive colinear sides, meaning
that polygons should be fully simplified...</p>

<p>Args:
  shape (geom.Polygon): polygon to test.</p>

<p>Returns:
  bool: True if polygon is tangential, False if not.</p>
</div>


                </section>
                <section id="get_incentre">
                            <input id="get_incentre-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_incentre</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">shape</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span></span><span class="return-annotation">) -> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">Point</span>:</span></span>

                <label class="view-source-button" for="get_incentre-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_incentre"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_incentre-393"><a href="#get_incentre-393"><span class="linenos">393</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_incentre</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">:</span>
</span><span id="get_incentre-394"><a href="#get_incentre-394"><span class="linenos">394</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Get a polygon incentre.</span>
</span><span id="get_incentre-395"><a href="#get_incentre-395"><span class="linenos">395</span></a>
</span><span id="get_incentre-396"><a href="#get_incentre-396"><span class="linenos">396</span></a><span class="sd">  See https://en.wikipedia.org/wiki/Incenter.</span>
</span><span id="get_incentre-397"><a href="#get_incentre-397"><span class="linenos">397</span></a>
</span><span id="get_incentre-398"><a href="#get_incentre-398"><span class="linenos">398</span></a><span class="sd">  This method relies on the polygon being tangential, i.e. there is an</span>
</span><span id="get_incentre-399"><a href="#get_incentre-399"><span class="linenos">399</span></a><span class="sd">  inscribed circle to which all sides of the polygon are tangent. It will work</span>
</span><span id="get_incentre-400"><a href="#get_incentre-400"><span class="linenos">400</span></a><span class="sd">  on all the polygons encountered in the Laves tilings, but is not guaranteed</span>
</span><span id="get_incentre-401"><a href="#get_incentre-401"><span class="linenos">401</span></a><span class="sd">  to work on all polygons.</span>
</span><span id="get_incentre-402"><a href="#get_incentre-402"><span class="linenos">402</span></a>
</span><span id="get_incentre-403"><a href="#get_incentre-403"><span class="linenos">403</span></a><span class="sd">  Given that the polygon is tangential, the radius of the inscribed circle is</span>
</span><span id="get_incentre-404"><a href="#get_incentre-404"><span class="linenos">404</span></a><span class="sd">  the [apothem of the polygon](https://en.wikipedia.org/wiki/Apothem) given by</span>
</span><span id="get_incentre-405"><a href="#get_incentre-405"><span class="linenos">405</span></a><span class="sd">  2 x Area / Perimeter. We apply a parallel offset of this size to two sides of</span>
</span><span id="get_incentre-406"><a href="#get_incentre-406"><span class="linenos">406</span></a><span class="sd">  the polygon and find their intersection to determine the centre of the circle</span>
</span><span id="get_incentre-407"><a href="#get_incentre-407"><span class="linenos">407</span></a><span class="sd">  givng the incentre of the polygon.</span>
</span><span id="get_incentre-408"><a href="#get_incentre-408"><span class="linenos">408</span></a>
</span><span id="get_incentre-409"><a href="#get_incentre-409"><span class="linenos">409</span></a><span class="sd">  Args:</span>
</span><span id="get_incentre-410"><a href="#get_incentre-410"><span class="linenos">410</span></a><span class="sd">    shape (geom.Polygon): the polygon.</span>
</span><span id="get_incentre-411"><a href="#get_incentre-411"><span class="linenos">411</span></a>
</span><span id="get_incentre-412"><a href="#get_incentre-412"><span class="linenos">412</span></a><span class="sd">  Returns:</span>
</span><span id="get_incentre-413"><a href="#get_incentre-413"><span class="linenos">413</span></a><span class="sd">    geom.Point: the incentre of the polygon.</span>
</span><span id="get_incentre-414"><a href="#get_incentre-414"><span class="linenos">414</span></a>
</span><span id="get_incentre-415"><a href="#get_incentre-415"><span class="linenos">415</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_incentre-416"><a href="#get_incentre-416"><span class="linenos">416</span></a>  <span class="k">if</span> <span class="n">is_regular_polygon</span><span class="p">(</span><span class="n">shape</span><span class="p">):</span>
</span><span id="get_incentre-417"><a href="#get_incentre-417"><span class="linenos">417</span></a>    <span class="k">return</span> <span class="n">shape</span><span class="o">.</span><span class="n">centroid</span>
</span><span id="get_incentre-418"><a href="#get_incentre-418"><span class="linenos">418</span></a>  <span class="k">return</span> <span class="n">polylabel</span><span class="o">.</span><span class="n">polylabel</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get a polygon incentre.</p>

<p>See <a href="https://en.wikipedia.org/wiki/Incenter">https://en.wikipedia.org/wiki/Incenter</a>.</p>

<p>This method relies on the polygon being tangential, i.e. there is an
inscribed circle to which all sides of the polygon are tangent. It will work
on all the polygons encountered in the Laves tilings, but is not guaranteed
to work on all polygons.</p>

<p>Given that the polygon is tangential, the radius of the inscribed circle is
the <a href="https://en.wikipedia.org/wiki/Apothem">apothem of the polygon</a> given by
2 x Area / Perimeter. We apply a parallel offset of this size to two sides of
the polygon and find their intersection to determine the centre of the circle
givng the incentre of the polygon.</p>

<p>Args:
  shape (geom.Polygon): the polygon.</p>

<p>Returns:
  geom.Point: the incentre of the polygon.</p>
</div>


                </section>
                <section id="get_incircle">
                            <input id="get_incircle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_incircle</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">shape</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span></span><span class="return-annotation">) -> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span>:</span></span>

                <label class="view-source-button" for="get_incircle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_incircle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_incircle-421"><a href="#get_incircle-421"><span class="linenos">421</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_incircle</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">:</span>
</span><span id="get_incircle-422"><a href="#get_incircle-422"><span class="linenos">422</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return incircle of supplied polygon.</span>
</span><span id="get_incircle-423"><a href="#get_incircle-423"><span class="linenos">423</span></a>
</span><span id="get_incircle-424"><a href="#get_incircle-424"><span class="linenos">424</span></a><span class="sd">  Args:</span>
</span><span id="get_incircle-425"><a href="#get_incircle-425"><span class="linenos">425</span></a><span class="sd">    shape(geom.Polygon): polygon for which incircle is required.</span>
</span><span id="get_incircle-426"><a href="#get_incircle-426"><span class="linenos">426</span></a>
</span><span id="get_incircle-427"><a href="#get_incircle-427"><span class="linenos">427</span></a><span class="sd">  Returns:</span>
</span><span id="get_incircle-428"><a href="#get_incircle-428"><span class="linenos">428</span></a><span class="sd">    geom.Polygon: a polygon representation of the incircle</span>
</span><span id="get_incircle-429"><a href="#get_incircle-429"><span class="linenos">429</span></a>
</span><span id="get_incircle-430"><a href="#get_incircle-430"><span class="linenos">430</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_incircle-431"><a href="#get_incircle-431"><span class="linenos">431</span></a>  <span class="n">c</span> <span class="o">=</span> <span class="n">get_incentre</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="get_incircle-432"><a href="#get_incircle-432"><span class="linenos">432</span></a>  <span class="n">r</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">get_sides</span><span class="p">(</span><span class="n">shape</span><span class="p">)])</span>
</span><span id="get_incircle-433"><a href="#get_incircle-433"><span class="linenos">433</span></a>  <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return incircle of supplied polygon.</p>

<p>Args:
  shape(geom.Polygon): polygon for which incircle is required.</p>

<p>Returns:
  geom.Polygon: a polygon representation of the incircle</p>
</div>


                </section>
                <section id="get_apothem">
                            <input id="get_apothem-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_apothem</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">shape</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="get_apothem-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_apothem"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_apothem-436"><a href="#get_apothem-436"><span class="linenos">436</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_apothem</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="get_apothem-437"><a href="#get_apothem-437"><span class="linenos">437</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return length of the apothem of supplied polygon.</span>
</span><span id="get_apothem-438"><a href="#get_apothem-438"><span class="linenos">438</span></a>
</span><span id="get_apothem-439"><a href="#get_apothem-439"><span class="linenos">439</span></a><span class="sd">  Args:</span>
</span><span id="get_apothem-440"><a href="#get_apothem-440"><span class="linenos">440</span></a><span class="sd">    shape(geom.Polygon): polygon for which apothem length is required.</span>
</span><span id="get_apothem-441"><a href="#get_apothem-441"><span class="linenos">441</span></a>
</span><span id="get_apothem-442"><a href="#get_apothem-442"><span class="linenos">442</span></a><span class="sd">  Returns:</span>
</span><span id="get_apothem-443"><a href="#get_apothem-443"><span class="linenos">443</span></a><span class="sd">    float: an estimate of the apothem length.</span>
</span><span id="get_apothem-444"><a href="#get_apothem-444"><span class="linenos">444</span></a>
</span><span id="get_apothem-445"><a href="#get_apothem-445"><span class="linenos">445</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_apothem-446"><a href="#get_apothem-446"><span class="linenos">446</span></a>  <span class="k">if</span> <span class="n">is_regular_polygon</span><span class="p">(</span><span class="n">shape</span><span class="p">):</span>
</span><span id="get_apothem-447"><a href="#get_apothem-447"><span class="linenos">447</span></a>    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">shape</span><span class="o">.</span><span class="n">area</span> <span class="o">/</span> <span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span><span class="o">.</span><span class="n">length</span>
</span><span id="get_apothem-448"><a href="#get_apothem-448"><span class="linenos">448</span></a>  <span class="n">c</span> <span class="o">=</span> <span class="n">polylabel</span><span class="o">.</span><span class="n">polylabel</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="get_apothem-449"><a href="#get_apothem-449"><span class="linenos">449</span></a>  <span class="k">return</span> <span class="nb">min</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">get_sides</span><span class="p">(</span><span class="n">shape</span><span class="p">)])</span>
</span></pre></div>


            <div class="docstring"><p>Return length of the apothem of supplied polygon.</p>

<p>Args:
  shape(geom.Polygon): polygon for which apothem length is required.</p>

<p>Returns:
  float: an estimate of the apothem length.</p>
</div>


                </section>
                <section id="get_angle_bisector">
                            <input id="get_angle_bisector-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_angle_bisector</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">shape</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span>,</span><span class="param">	<span class="n">v</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">) -> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">linestring</span><span class="o">.</span><span class="n">LineString</span>:</span></span>

                <label class="view-source-button" for="get_angle_bisector-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_angle_bisector"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_angle_bisector-452"><a href="#get_angle_bisector-452"><span class="linenos">452</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_angle_bisector</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">:</span>
</span><span id="get_angle_bisector-453"><a href="#get_angle_bisector-453"><span class="linenos">453</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return angle bisector of specified corner of supplied polygon.</span>
</span><span id="get_angle_bisector-454"><a href="#get_angle_bisector-454"><span class="linenos">454</span></a>
</span><span id="get_angle_bisector-455"><a href="#get_angle_bisector-455"><span class="linenos">455</span></a><span class="sd">  Args:</span>
</span><span id="get_angle_bisector-456"><a href="#get_angle_bisector-456"><span class="linenos">456</span></a><span class="sd">    shape (geom.Polygon): the polygon</span>
</span><span id="get_angle_bisector-457"><a href="#get_angle_bisector-457"><span class="linenos">457</span></a><span class="sd">    v (int, optional): index of the corner whose bisector is required.</span>
</span><span id="get_angle_bisector-458"><a href="#get_angle_bisector-458"><span class="linenos">458</span></a><span class="sd">    Defaults to 0.</span>
</span><span id="get_angle_bisector-459"><a href="#get_angle_bisector-459"><span class="linenos">459</span></a>
</span><span id="get_angle_bisector-460"><a href="#get_angle_bisector-460"><span class="linenos">460</span></a><span class="sd">  Returns:</span>
</span><span id="get_angle_bisector-461"><a href="#get_angle_bisector-461"><span class="linenos">461</span></a><span class="sd">    geom.LineString: line which bisects the specified corner.</span>
</span><span id="get_angle_bisector-462"><a href="#get_angle_bisector-462"><span class="linenos">462</span></a>
</span><span id="get_angle_bisector-463"><a href="#get_angle_bisector-463"><span class="linenos">463</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_angle_bisector-464"><a href="#get_angle_bisector-464"><span class="linenos">464</span></a>  <span class="n">pts</span> <span class="o">=</span> <span class="n">get_corners</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">repeat_first</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="get_angle_bisector-465"><a href="#get_angle_bisector-465"><span class="linenos">465</span></a>  <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span>
</span><span id="get_angle_bisector-466"><a href="#get_angle_bisector-466"><span class="linenos">466</span></a>  <span class="n">p0</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">v</span> <span class="o">%</span> <span class="n">n</span><span class="p">]</span>
</span><span id="get_angle_bisector-467"><a href="#get_angle_bisector-467"><span class="linenos">467</span></a>  <span class="n">p1</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[(</span><span class="n">v</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">]</span>
</span><span id="get_angle_bisector-468"><a href="#get_angle_bisector-468"><span class="linenos">468</span></a>  <span class="n">p2</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[(</span><span class="n">v</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">]</span>
</span><span id="get_angle_bisector-469"><a href="#get_angle_bisector-469"><span class="linenos">469</span></a>  <span class="n">d01</span> <span class="o">=</span> <span class="n">p0</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
</span><span id="get_angle_bisector-470"><a href="#get_angle_bisector-470"><span class="linenos">470</span></a>  <span class="n">d02</span> <span class="o">=</span> <span class="n">p0</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
</span><span id="get_angle_bisector-471"><a href="#get_angle_bisector-471"><span class="linenos">471</span></a>  <span class="k">if</span> <span class="n">d01</span> <span class="o">&lt;</span> <span class="n">d02</span><span class="p">:</span>
</span><span id="get_angle_bisector-472"><a href="#get_angle_bisector-472"><span class="linenos">472</span></a>    <span class="n">p2</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([</span><span class="n">p0</span><span class="p">,</span> <span class="n">p2</span><span class="p">])</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">d01</span><span class="p">)</span>
</span><span id="get_angle_bisector-473"><a href="#get_angle_bisector-473"><span class="linenos">473</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="get_angle_bisector-474"><a href="#get_angle_bisector-474"><span class="linenos">474</span></a>    <span class="n">p1</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">])</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">d02</span><span class="p">)</span>
</span><span id="get_angle_bisector-475"><a href="#get_angle_bisector-475"><span class="linenos">475</span></a>  <span class="n">m</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">((</span><span class="n">p1</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">p2</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="get_angle_bisector-476"><a href="#get_angle_bisector-476"><span class="linenos">476</span></a>  <span class="c1"># we have to scale this to much larger in case of an angle near 180</span>
</span><span id="get_angle_bisector-477"><a href="#get_angle_bisector-477"><span class="linenos">477</span></a>  <span class="k">return</span> <span class="n">affine</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([</span><span class="n">p0</span><span class="p">,</span> <span class="n">m</span><span class="p">]),</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">origin</span> <span class="o">=</span> <span class="n">p0</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return angle bisector of specified corner of supplied polygon.</p>

<p>Args:
  shape (geom.Polygon): the polygon
  v (int, optional): index of the corner whose bisector is required.
  Defaults to 0.</p>

<p>Returns:
  geom.LineString: line which bisects the specified corner.</p>
</div>


                </section>
                <section id="gridify">
                            <input id="gridify-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">gridify</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">gs</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geoseries</span><span class="o">.</span><span class="n">GeoSeries</span> <span class="o">|</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span> <span class="o">|</span> <span class="n">shapely</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">Geometry</span></span><span class="return-annotation">) -> <span class="n">geopandas</span><span class="o">.</span><span class="n">geoseries</span><span class="o">.</span><span class="n">GeoSeries</span> <span class="o">|</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span> <span class="o">|</span> <span class="n">shapely</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">Geometry</span>:</span></span>

                <label class="view-source-button" for="gridify-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#gridify"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="gridify-500"><a href="#gridify-500"><span class="linenos">500</span></a><span class="k">def</span><span class="w"> </span><span class="nf">gridify</span><span class="p">(</span>
</span><span id="gridify-501"><a href="#gridify-501"><span class="linenos">501</span></a>    <span class="n">gs</span><span class="p">:</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span> <span class="o">|</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span> <span class="o">|</span> <span class="n">shapely</span><span class="o">.</span><span class="n">Geometry</span><span class="p">,</span>
</span><span id="gridify-502"><a href="#gridify-502"><span class="linenos">502</span></a>  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span> <span class="o">|</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span> <span class="o">|</span> <span class="n">shapely</span><span class="o">.</span><span class="n">Geometry</span><span class="p">:</span>
</span><span id="gridify-503"><a href="#gridify-503"><span class="linenos">503</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return supplied GeoSeries rounded to tiling_utils.RESOLUTION.</span>
</span><span id="gridify-504"><a href="#gridify-504"><span class="linenos">504</span></a>
</span><span id="gridify-505"><a href="#gridify-505"><span class="linenos">505</span></a><span class="sd">  Args:</span>
</span><span id="gridify-506"><a href="#gridify-506"><span class="linenos">506</span></a><span class="sd">    gs (gpd.GeoSeries): geometries to gridify.</span>
</span><span id="gridify-507"><a href="#gridify-507"><span class="linenos">507</span></a><span class="sd">    precision (int, optional): digits of precision. Defaults to 6.</span>
</span><span id="gridify-508"><a href="#gridify-508"><span class="linenos">508</span></a>
</span><span id="gridify-509"><a href="#gridify-509"><span class="linenos">509</span></a><span class="sd">  Returns:</span>
</span><span id="gridify-510"><a href="#gridify-510"><span class="linenos">510</span></a><span class="sd">    gpd.GeoSeries: the rounded geometries.</span>
</span><span id="gridify-511"><a href="#gridify-511"><span class="linenos">511</span></a>
</span><span id="gridify-512"><a href="#gridify-512"><span class="linenos">512</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="gridify-513"><a href="#gridify-513"><span class="linenos">513</span></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">shapely</span><span class="o">.</span><span class="n">Geometry</span><span class="p">)</span> <span class="p">:</span>
</span><span id="gridify-514"><a href="#gridify-514"><span class="linenos">514</span></a>    <span class="k">return</span> <span class="n">shapely</span><span class="o">.</span><span class="n">set_precision</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">grid_size</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">)</span>
</span><span id="gridify-515"><a href="#gridify-515"><span class="linenos">515</span></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">):</span>
</span><span id="gridify-516"><a href="#gridify-516"><span class="linenos">516</span></a>    <span class="k">return</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span>
</span><span id="gridify-517"><a href="#gridify-517"><span class="linenos">517</span></a>      <span class="p">[</span><span class="n">shapely</span><span class="o">.</span><span class="n">set_precision</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">grid_size</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">gs</span><span class="p">)],</span>
</span><span id="gridify-518"><a href="#gridify-518"><span class="linenos">518</span></a>      <span class="n">crs</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</span><span id="gridify-519"><a href="#gridify-519"><span class="linenos">519</span></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gs</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
</span><span id="gridify-520"><a href="#gridify-520"><span class="linenos">520</span></a>    <span class="n">gs</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span>
</span><span id="gridify-521"><a href="#gridify-521"><span class="linenos">521</span></a>      <span class="p">[</span><span class="n">shapely</span><span class="o">.</span><span class="n">set_precision</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">grid_size</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">)</span>
</span><span id="gridify-522"><a href="#gridify-522"><span class="linenos">522</span></a>       <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">geometry</span><span class="p">)],</span> <span class="n">crs</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</span><span id="gridify-523"><a href="#gridify-523"><span class="linenos">523</span></a>    <span class="k">return</span> <span class="n">gs</span>
</span><span id="gridify-524"><a href="#gridify-524"><span class="linenos">524</span></a>  <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Return supplied GeoSeries rounded to tiling_utils.RESOLUTION.</p>

<p>Args:
  gs (gpd.GeoSeries): geometries to gridify.
  precision (int, optional): digits of precision. Defaults to 6.</p>

<p>Returns:
  gpd.GeoSeries: the rounded geometries.</p>
</div>


                </section>
                <section id="get_dual_tile_unit">
                            <input id="get_dual_tile_unit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_dual_tile_unit</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unit</span></span><span class="return-annotation">) -> <span class="n">geopandas</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span>:</span></span>

                <label class="view-source-button" for="get_dual_tile_unit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_dual_tile_unit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_dual_tile_unit-527"><a href="#get_dual_tile_unit-527"><span class="linenos">527</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_dual_tile_unit</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
</span><span id="get_dual_tile_unit-528"><a href="#get_dual_tile_unit-528"><span class="linenos">528</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Convert supplied TileUnit to candidate GeoDataFrame of its dual TileUnit.</span>
</span><span id="get_dual_tile_unit-529"><a href="#get_dual_tile_unit-529"><span class="linenos">529</span></a>
</span><span id="get_dual_tile_unit-530"><a href="#get_dual_tile_unit-530"><span class="linenos">530</span></a><span class="sd">  NOTE: this is complicated and not remotely guaranteed to work!</span>
</span><span id="get_dual_tile_unit-531"><a href="#get_dual_tile_unit-531"><span class="linenos">531</span></a><span class="sd">  a particular issue is that where to place the vertices of the faces</span>
</span><span id="get_dual_tile_unit-532"><a href="#get_dual_tile_unit-532"><span class="linenos">532</span></a><span class="sd">  of the dual with respect to the tiles in the original is ill-defined.</span>
</span><span id="get_dual_tile_unit-533"><a href="#get_dual_tile_unit-533"><span class="linenos">533</span></a><span class="sd">  This is because the dual process is topologically not metrically defined,</span>
</span><span id="get_dual_tile_unit-534"><a href="#get_dual_tile_unit-534"><span class="linenos">534</span></a><span class="sd">  so that exact vertex locations are ambiguous. Tiling duality is defined in</span>
</span><span id="get_dual_tile_unit-535"><a href="#get_dual_tile_unit-535"><span class="linenos">535</span></a><span class="sd">  Section 4.2 of Grunbaum B, Shephard G C, 1987 _Tilings and Patterns_ (W. H.</span>
</span><span id="get_dual_tile_unit-536"><a href="#get_dual_tile_unit-536"><span class="linenos">536</span></a><span class="sd">  Freeman and Company, New York)</span>
</span><span id="get_dual_tile_unit-537"><a href="#get_dual_tile_unit-537"><span class="linenos">537</span></a>
</span><span id="get_dual_tile_unit-538"><a href="#get_dual_tile_unit-538"><span class="linenos">538</span></a><span class="sd">  NOTE: In general, this method will work only if all supplied tiles are</span>
</span><span id="get_dual_tile_unit-539"><a href="#get_dual_tile_unit-539"><span class="linenos">539</span></a><span class="sd">  regular polygons. A known exception is if the only non-regular polygons are</span>
</span><span id="get_dual_tile_unit-540"><a href="#get_dual_tile_unit-540"><span class="linenos">540</span></a><span class="sd">  triangles.</span>
</span><span id="get_dual_tile_unit-541"><a href="#get_dual_tile_unit-541"><span class="linenos">541</span></a>
</span><span id="get_dual_tile_unit-542"><a href="#get_dual_tile_unit-542"><span class="linenos">542</span></a><span class="sd">  NOTE: &#39;clean&#39; polygons are required. If supplied polygons have messy</span>
</span><span id="get_dual_tile_unit-543"><a href="#get_dual_tile_unit-543"><span class="linenos">543</span></a><span class="sd">  vertices with multiple points where there is only one proper point, bad</span>
</span><span id="get_dual_tile_unit-544"><a href="#get_dual_tile_unit-544"><span class="linenos">544</span></a><span class="sd">  things are likely to happen! Consider using `clean_polygon()` on the</span>
</span><span id="get_dual_tile_unit-545"><a href="#get_dual_tile_unit-545"><span class="linenos">545</span></a><span class="sd">  tile geometries.</span>
</span><span id="get_dual_tile_unit-546"><a href="#get_dual_tile_unit-546"><span class="linenos">546</span></a>
</span><span id="get_dual_tile_unit-547"><a href="#get_dual_tile_unit-547"><span class="linenos">547</span></a><span class="sd">  Because of the above limitations, we only return a GeoDataFrame</span>
</span><span id="get_dual_tile_unit-548"><a href="#get_dual_tile_unit-548"><span class="linenos">548</span></a><span class="sd">  for inspection. However some `weavingspace.tile_unit.TileUnit` setup</span>
</span><span id="get_dual_tile_unit-549"><a href="#get_dual_tile_unit-549"><span class="linenos">549</span></a><span class="sd">  methods in `weavingspace.tiling_geometries` use this method, where we are</span>
</span><span id="get_dual_tile_unit-550"><a href="#get_dual_tile_unit-550"><span class="linenos">550</span></a><span class="sd">  confident the returned dual is valid.</span>
</span><span id="get_dual_tile_unit-551"><a href="#get_dual_tile_unit-551"><span class="linenos">551</span></a>
</span><span id="get_dual_tile_unit-552"><a href="#get_dual_tile_unit-552"><span class="linenos">552</span></a><span class="sd">  Args:</span>
</span><span id="get_dual_tile_unit-553"><a href="#get_dual_tile_unit-553"><span class="linenos">553</span></a><span class="sd">    unit (TileUnit): the tiling for which the dual is required.</span>
</span><span id="get_dual_tile_unit-554"><a href="#get_dual_tile_unit-554"><span class="linenos">554</span></a>
</span><span id="get_dual_tile_unit-555"><a href="#get_dual_tile_unit-555"><span class="linenos">555</span></a><span class="sd">  Returns:</span>
</span><span id="get_dual_tile_unit-556"><a href="#get_dual_tile_unit-556"><span class="linenos">556</span></a><span class="sd">    gpd.GeoDataFrame: GeoDataFrame that could be the tiles attribute for</span>
</span><span id="get_dual_tile_unit-557"><a href="#get_dual_tile_unit-557"><span class="linenos">557</span></a><span class="sd">      a TileUnit of the dual tiling.</span>
</span><span id="get_dual_tile_unit-558"><a href="#get_dual_tile_unit-558"><span class="linenos">558</span></a>
</span><span id="get_dual_tile_unit-559"><a href="#get_dual_tile_unit-559"><span class="linenos">559</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_dual_tile_unit-560"><a href="#get_dual_tile_unit-560"><span class="linenos">560</span></a>  <span class="c1"># get a local patch of this Tiling</span>
</span><span id="get_dual_tile_unit-561"><a href="#get_dual_tile_unit-561"><span class="linenos">561</span></a>  <span class="n">local_patch</span><span class="p">:</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span> <span class="o">=</span> <span class="n">unit</span><span class="o">.</span><span class="n">get_local_patch</span><span class="p">(</span><span class="n">r</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">include_0</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="get_dual_tile_unit-562"><a href="#get_dual_tile_unit-562"><span class="linenos">562</span></a>  <span class="c1"># Find the interior points of these tiles - these will be guaranteed</span>
</span><span id="get_dual_tile_unit-563"><a href="#get_dual_tile_unit-563"><span class="linenos">563</span></a>  <span class="c1"># to have a sequence of surrounding tiles incident on them</span>
</span><span id="get_dual_tile_unit-564"><a href="#get_dual_tile_unit-564"><span class="linenos">564</span></a>  <span class="n">interior_pts</span> <span class="o">=</span> <span class="n">_get_interior_vertices</span><span class="p">(</span><span class="n">local_patch</span><span class="p">)</span>
</span><span id="get_dual_tile_unit-565"><a href="#get_dual_tile_unit-565"><span class="linenos">565</span></a>  <span class="c1"># Compile a list of the polygons incident on the interior points</span>
</span><span id="get_dual_tile_unit-566"><a href="#get_dual_tile_unit-566"><span class="linenos">566</span></a>  <span class="n">cycles</span> <span class="o">=</span> <span class="p">[{</span><span class="n">poly_id</span> <span class="k">for</span> <span class="n">poly_id</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">local_patch</span><span class="o">.</span><span class="n">geometry</span><span class="p">)</span>
</span><span id="get_dual_tile_unit-567"><a href="#get_dual_tile_unit-567"><span class="linenos">567</span></a>             <span class="k">if</span> <span class="n">pt</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">RESOLUTION</span> <span class="o">*</span> <span class="mi">2</span><span class="p">}</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">interior_pts</span><span class="p">]</span>
</span><span id="get_dual_tile_unit-568"><a href="#get_dual_tile_unit-568"><span class="linenos">568</span></a>  <span class="n">dual_faces</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="get_dual_tile_unit-569"><a href="#get_dual_tile_unit-569"><span class="linenos">569</span></a>  <span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="n">cycles</span><span class="p">:</span>
</span><span id="get_dual_tile_unit-570"><a href="#get_dual_tile_unit-570"><span class="linenos">570</span></a>    <span class="n">ids</span><span class="p">,</span> <span class="n">pts</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
</span><span id="get_dual_tile_unit-571"><a href="#get_dual_tile_unit-571"><span class="linenos">571</span></a>    <span class="k">for</span> <span class="n">poly_id</span> <span class="ow">in</span> <span class="n">cycle</span><span class="p">:</span>
</span><span id="get_dual_tile_unit-572"><a href="#get_dual_tile_unit-572"><span class="linenos">572</span></a>      <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_patch</span><span class="o">.</span><span class="n">tile_id</span><span class="p">[</span><span class="n">poly_id</span><span class="p">])</span>
</span><span id="get_dual_tile_unit-573"><a href="#get_dual_tile_unit-573"><span class="linenos">573</span></a>      <span class="n">poly</span> <span class="o">=</span> <span class="n">local_patch</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="n">poly_id</span><span class="p">]</span>
</span><span id="get_dual_tile_unit-574"><a href="#get_dual_tile_unit-574"><span class="linenos">574</span></a>      <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_incentre</span><span class="p">(</span><span class="n">poly</span><span class="p">))</span>
</span><span id="get_dual_tile_unit-575"><a href="#get_dual_tile_unit-575"><span class="linenos">575</span></a>    <span class="c1"># sort them into CW order so they are well formed</span>
</span><span id="get_dual_tile_unit-576"><a href="#get_dual_tile_unit-576"><span class="linenos">576</span></a>    <span class="n">sorted_coords</span> <span class="o">=</span> <span class="n">_sort_cw</span><span class="p">([(</span><span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ID</span><span class="p">)</span>
</span><span id="get_dual_tile_unit-577"><a href="#get_dual_tile_unit-577"><span class="linenos">577</span></a>                              <span class="k">for</span> <span class="n">pt</span><span class="p">,</span> <span class="n">ID</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">strict</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)])</span>
</span><span id="get_dual_tile_unit-578"><a href="#get_dual_tile_unit-578"><span class="linenos">578</span></a>    <span class="n">dual_faces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="get_dual_tile_unit-579"><a href="#get_dual_tile_unit-579"><span class="linenos">579</span></a>      <span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">([(</span><span class="n">pt_id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt_id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">pt_id</span> <span class="ow">in</span> <span class="n">sorted_coords</span><span class="p">]),</span>
</span><span id="get_dual_tile_unit-580"><a href="#get_dual_tile_unit-580"><span class="linenos">580</span></a>       <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">pt_id</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">pt_id</span> <span class="ow">in</span> <span class="n">sorted_coords</span><span class="p">])))</span>
</span><span id="get_dual_tile_unit-581"><a href="#get_dual_tile_unit-581"><span class="linenos">581</span></a>  <span class="c1"># ensure the resulting face centroids are inside the original tile</span>
</span><span id="get_dual_tile_unit-582"><a href="#get_dual_tile_unit-582"><span class="linenos">582</span></a>  <span class="c1"># displaced a little to avoid uncertainties at corners/edges</span>
</span><span id="get_dual_tile_unit-583"><a href="#get_dual_tile_unit-583"><span class="linenos">583</span></a>  <span class="c1"># This is a guess at something that _could_ work, which turned out well!</span>
</span><span id="get_dual_tile_unit-584"><a href="#get_dual_tile_unit-584"><span class="linenos">584</span></a>  <span class="n">dual_faces</span> <span class="o">=</span> <span class="p">[(</span><span class="n">f</span><span class="p">,</span> <span class="n">ID</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">dual_faces</span>
</span><span id="get_dual_tile_unit-585"><a href="#get_dual_tile_unit-585"><span class="linenos">585</span></a>                <span class="k">if</span> <span class="n">affine</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span>
</span><span id="get_dual_tile_unit-586"><a href="#get_dual_tile_unit-586"><span class="linenos">586</span></a>                  <span class="n">unit</span><span class="o">.</span><span class="n">get_prototile_from_vectors</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">],</span>
</span><span id="get_dual_tile_unit-587"><a href="#get_dual_tile_unit-587"><span class="linenos">587</span></a>                  <span class="n">RESOLUTION</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="n">RESOLUTION</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">centroid</span><span class="p">)]</span>
</span><span id="get_dual_tile_unit-588"><a href="#get_dual_tile_unit-588"><span class="linenos">588</span></a>  <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
</span><span id="get_dual_tile_unit-589"><a href="#get_dual_tile_unit-589"><span class="linenos">589</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tile_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dual_faces</span><span class="p">]},</span> <span class="n">crs</span> <span class="o">=</span> <span class="n">unit</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
</span><span id="get_dual_tile_unit-590"><a href="#get_dual_tile_unit-590"><span class="linenos">590</span></a>    <span class="n">geometry</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">([</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dual_faces</span><span class="p">]))</span>
</span><span id="get_dual_tile_unit-591"><a href="#get_dual_tile_unit-591"><span class="linenos">591</span></a>  <span class="c1"># ensure no duplicates</span>
</span><span id="get_dual_tile_unit-592"><a href="#get_dual_tile_unit-592"><span class="linenos">592</span></a>  <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="s2">&quot;tile_id&quot;</span><span class="p">,</span> <span class="n">as_index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span>
</span><span id="get_dual_tile_unit-593"><a href="#get_dual_tile_unit-593"><span class="linenos">593</span></a>    <span class="n">index_parts</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="get_dual_tile_unit-594"><a href="#get_dual_tile_unit-594"><span class="linenos">594</span></a>  <span class="n">gdf</span><span class="o">.</span><span class="n">tile_id</span> <span class="o">=</span> <span class="n">_relabel</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="get_dual_tile_unit-595"><a href="#get_dual_tile_unit-595"><span class="linenos">595</span></a>  <span class="k">return</span> <span class="n">gdf</span>
</span></pre></div>


            <div class="docstring"><p>Convert supplied TileUnit to candidate GeoDataFrame of its dual TileUnit.</p>

<p>NOTE: this is complicated and not remotely guaranteed to work!
a particular issue is that where to place the vertices of the faces
of the dual with respect to the tiles in the original is ill-defined.
This is because the dual process is topologically not metrically defined,
so that exact vertex locations are ambiguous. Tiling duality is defined in
Section 4.2 of Grunbaum B, Shephard G C, 1987 _Tilings and Patterns_ (W. H.
Freeman and Company, New York)</p>

<p>NOTE: In general, this method will work only if all supplied tiles are
regular polygons. A known exception is if the only non-regular polygons are
triangles.</p>

<p>NOTE: 'clean' polygons are required. If supplied polygons have messy
vertices with multiple points where there is only one proper point, bad
things are likely to happen! Consider using <code>clean_polygon()</code> on the
tile geometries.</p>

<p>Because of the above limitations, we only return a GeoDataFrame
for inspection. However some <code><a href="tile_unit.html#TileUnit">weavingspace.tile_unit.TileUnit</a></code> setup
methods in <code>weavingspace.tiling_geometries</code> use this method, where we are
confident the returned dual is valid.</p>

<p>Args:
  unit (TileUnit): the tiling for which the dual is required.</p>

<p>Returns:
  gpd.GeoDataFrame: GeoDataFrame that could be the tiles attribute for
    a TileUnit of the dual tiling.</p>
</div>


                </section>
                <section id="write_map_to_layers">
                            <input id="write_map_to_layers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_map_to_layers</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">gdf</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span>,</span><span class="param">	<span class="n">fname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;output.gpkg&#39;</span>,</span><span class="param">	<span class="n">tile_var</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tile_id&#39;</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="write_map_to_layers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#write_map_to_layers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="write_map_to_layers-640"><a href="#write_map_to_layers-640"><span class="linenos">640</span></a><span class="k">def</span><span class="w"> </span><span class="nf">write_map_to_layers</span><span class="p">(</span><span class="n">gdf</span><span class="p">:</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
</span><span id="write_map_to_layers-641"><a href="#write_map_to_layers-641"><span class="linenos">641</span></a>                        <span class="n">fname</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;output.gpkg&quot;</span><span class="p">,</span>
</span><span id="write_map_to_layers-642"><a href="#write_map_to_layers-642"><span class="linenos">642</span></a>                        <span class="n">tile_var</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tile_id&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="write_map_to_layers-643"><a href="#write_map_to_layers-643"><span class="linenos">643</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Write supplied GeoDataFrame to a GPKG file.</span>
</span><span id="write_map_to_layers-644"><a href="#write_map_to_layers-644"><span class="linenos">644</span></a>
</span><span id="write_map_to_layers-645"><a href="#write_map_to_layers-645"><span class="linenos">645</span></a><span class="sd">  Geopackage file layers will be based on the `tile_var` attribute.</span>
</span><span id="write_map_to_layers-646"><a href="#write_map_to_layers-646"><span class="linenos">646</span></a>
</span><span id="write_map_to_layers-647"><a href="#write_map_to_layers-647"><span class="linenos">647</span></a><span class="sd">  Args:</span>
</span><span id="write_map_to_layers-648"><a href="#write_map_to_layers-648"><span class="linenos">648</span></a><span class="sd">    gdf (gpd.GeoDataFrame): the GeoDataFrame.</span>
</span><span id="write_map_to_layers-649"><a href="#write_map_to_layers-649"><span class="linenos">649</span></a><span class="sd">    fname (str, optional): filename to write.</span>
</span><span id="write_map_to_layers-650"><a href="#write_map_to_layers-650"><span class="linenos">650</span></a><span class="sd">    tile_var (str, optional): the attribute to use to separate</span>
</span><span id="write_map_to_layers-651"><a href="#write_map_to_layers-651"><span class="linenos">651</span></a><span class="sd">      output file into layers. Defaults to &quot;tile_id&quot;.</span>
</span><span id="write_map_to_layers-652"><a href="#write_map_to_layers-652"><span class="linenos">652</span></a>
</span><span id="write_map_to_layers-653"><a href="#write_map_to_layers-653"><span class="linenos">653</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="write_map_to_layers-654"><a href="#write_map_to_layers-654"><span class="linenos">654</span></a>  <span class="n">grouped</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">tile_var</span><span class="p">,</span> <span class="n">as_index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="write_map_to_layers-655"><a href="#write_map_to_layers-655"><span class="linenos">655</span></a>  <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">gdf</span><span class="p">[</span><span class="n">tile_var</span><span class="p">]):</span>
</span><span id="write_map_to_layers-656"><a href="#write_map_to_layers-656"><span class="linenos">656</span></a>    <span class="n">grouped</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">layer</span> <span class="o">=</span> <span class="n">e</span><span class="p">,</span> <span class="n">driver</span> <span class="o">=</span> <span class="s2">&quot;GPKG&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Write supplied GeoDataFrame to a GPKG file.</p>

<p>Geopackage file layers will be based on the <code>tile_var</code> attribute.</p>

<p>Args:
  gdf (gpd.GeoDataFrame): the GeoDataFrame.
  fname (str, optional): filename to write.
  tile_var (str, optional): the attribute to use to separate
    output file into layers. Defaults to "tile_id".</p>
</div>


                </section>
                <section id="get_collapse_distance">
                            <input id="get_collapse_distance-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_collapse_distance</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">geometry</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="get_collapse_distance-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_collapse_distance"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_collapse_distance-659"><a href="#get_collapse_distance-659"><span class="linenos">659</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_collapse_distance</span><span class="p">(</span><span class="n">geometry</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="get_collapse_distance-660"><a href="#get_collapse_distance-660"><span class="linenos">660</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return distance under which polygon will disappear if negatively buffered.</span>
</span><span id="get_collapse_distance-661"><a href="#get_collapse_distance-661"><span class="linenos">661</span></a>
</span><span id="get_collapse_distance-662"><a href="#get_collapse_distance-662"><span class="linenos">662</span></a><span class="sd">  Performs a binary search between an upper bound based on the radius of circle</span>
</span><span id="get_collapse_distance-663"><a href="#get_collapse_distance-663"><span class="linenos">663</span></a><span class="sd">  of equal area to the polygon, and 0.</span>
</span><span id="get_collapse_distance-664"><a href="#get_collapse_distance-664"><span class="linenos">664</span></a>
</span><span id="get_collapse_distance-665"><a href="#get_collapse_distance-665"><span class="linenos">665</span></a><span class="sd">  Args:</span>
</span><span id="get_collapse_distance-666"><a href="#get_collapse_distance-666"><span class="linenos">666</span></a><span class="sd">    geometry (geom.Polygon): the polygon.</span>
</span><span id="get_collapse_distance-667"><a href="#get_collapse_distance-667"><span class="linenos">667</span></a>
</span><span id="get_collapse_distance-668"><a href="#get_collapse_distance-668"><span class="linenos">668</span></a><span class="sd">  Returns:</span>
</span><span id="get_collapse_distance-669"><a href="#get_collapse_distance-669"><span class="linenos">669</span></a><span class="sd">    float: its collapse distance.</span>
</span><span id="get_collapse_distance-670"><a href="#get_collapse_distance-670"><span class="linenos">670</span></a>
</span><span id="get_collapse_distance-671"><a href="#get_collapse_distance-671"><span class="linenos">671</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_collapse_distance-672"><a href="#get_collapse_distance-672"><span class="linenos">672</span></a>  <span class="k">if</span> <span class="n">is_regular_polygon</span><span class="p">(</span><span class="n">geometry</span><span class="p">):</span>
</span><span id="get_collapse_distance-673"><a href="#get_collapse_distance-673"><span class="linenos">673</span></a>    <span class="k">return</span> <span class="n">get_apothem</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>
</span><span id="get_collapse_distance-674"><a href="#get_collapse_distance-674"><span class="linenos">674</span></a>  <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">area</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="get_collapse_distance-675"><a href="#get_collapse_distance-675"><span class="linenos">675</span></a>  <span class="n">lower</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="get_collapse_distance-676"><a href="#get_collapse_distance-676"><span class="linenos">676</span></a>  <span class="n">upper</span> <span class="o">=</span> <span class="n">radius</span>
</span><span id="get_collapse_distance-677"><a href="#get_collapse_distance-677"><span class="linenos">677</span></a>  <span class="n">delta</span> <span class="o">=</span> <span class="mf">1e12</span>
</span><span id="get_collapse_distance-678"><a href="#get_collapse_distance-678"><span class="linenos">678</span></a>  <span class="n">stop_delta</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">/</span> <span class="mi">1000</span>
</span><span id="get_collapse_distance-679"><a href="#get_collapse_distance-679"><span class="linenos">679</span></a>  <span class="k">while</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="n">stop_delta</span><span class="p">:</span>
</span><span id="get_collapse_distance-680"><a href="#get_collapse_distance-680"><span class="linenos">680</span></a>    <span class="n">new_r</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower</span> <span class="o">+</span> <span class="n">upper</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="get_collapse_distance-681"><a href="#get_collapse_distance-681"><span class="linenos">681</span></a>    <span class="k">if</span> <span class="n">geometry</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="o">-</span><span class="n">new_r</span><span class="p">)</span><span class="o">.</span><span class="n">area</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="get_collapse_distance-682"><a href="#get_collapse_distance-682"><span class="linenos">682</span></a>      <span class="n">lower</span> <span class="o">=</span> <span class="n">new_r</span>
</span><span id="get_collapse_distance-683"><a href="#get_collapse_distance-683"><span class="linenos">683</span></a>      <span class="n">delta</span> <span class="o">=</span> <span class="n">upper</span> <span class="o">-</span> <span class="n">new_r</span>
</span><span id="get_collapse_distance-684"><a href="#get_collapse_distance-684"><span class="linenos">684</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="get_collapse_distance-685"><a href="#get_collapse_distance-685"><span class="linenos">685</span></a>      <span class="n">upper</span> <span class="o">=</span> <span class="n">new_r</span>
</span><span id="get_collapse_distance-686"><a href="#get_collapse_distance-686"><span class="linenos">686</span></a>      <span class="n">delta</span> <span class="o">=</span> <span class="n">new_r</span> <span class="o">-</span> <span class="n">lower</span>
</span><span id="get_collapse_distance-687"><a href="#get_collapse_distance-687"><span class="linenos">687</span></a>  <span class="k">return</span> <span class="n">new_r</span>
</span></pre></div>


            <div class="docstring"><p>Return distance under which polygon will disappear if negatively buffered.</p>

<p>Performs a binary search between an upper bound based on the radius of circle
of equal area to the polygon, and 0.</p>

<p>Args:
  geometry (geom.Polygon): the polygon.</p>

<p>Returns:
  float: its collapse distance.</p>
</div>


                </section>
                <section id="get_largest_polygon">
                            <input id="get_largest_polygon-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_largest_polygon</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">polygons</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geoseries</span><span class="o">.</span><span class="n">GeoSeries</span></span><span class="return-annotation">) -> <span class="n">geopandas</span><span class="o">.</span><span class="n">geoseries</span><span class="o">.</span><span class="n">GeoSeries</span>:</span></span>

                <label class="view-source-button" for="get_largest_polygon-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_largest_polygon"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_largest_polygon-690"><a href="#get_largest_polygon-690"><span class="linenos">690</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_largest_polygon</span><span class="p">(</span><span class="n">polygons</span><span class="p">:</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">:</span>
</span><span id="get_largest_polygon-691"><a href="#get_largest_polygon-691"><span class="linenos">691</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return largest polygon in a GeoSeries as a GeoSeries of one polygon.</span>
</span><span id="get_largest_polygon-692"><a href="#get_largest_polygon-692"><span class="linenos">692</span></a>
</span><span id="get_largest_polygon-693"><a href="#get_largest_polygon-693"><span class="linenos">693</span></a><span class="sd">  NOT CURRENTLY USED ANYWHERE IN MODULE.</span>
</span><span id="get_largest_polygon-694"><a href="#get_largest_polygon-694"><span class="linenos">694</span></a>
</span><span id="get_largest_polygon-695"><a href="#get_largest_polygon-695"><span class="linenos">695</span></a><span class="sd">  Args:</span>
</span><span id="get_largest_polygon-696"><a href="#get_largest_polygon-696"><span class="linenos">696</span></a><span class="sd">    polygons (gpd.GeoSeries): the set of polygons to pick from.</span>
</span><span id="get_largest_polygon-697"><a href="#get_largest_polygon-697"><span class="linenos">697</span></a>
</span><span id="get_largest_polygon-698"><a href="#get_largest_polygon-698"><span class="linenos">698</span></a><span class="sd">  Returns:</span>
</span><span id="get_largest_polygon-699"><a href="#get_largest_polygon-699"><span class="linenos">699</span></a><span class="sd">    gpd.GeoSeries: the largest polygon.</span>
</span><span id="get_largest_polygon-700"><a href="#get_largest_polygon-700"><span class="linenos">700</span></a>
</span><span id="get_largest_polygon-701"><a href="#get_largest_polygon-701"><span class="linenos">701</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_largest_polygon-702"><a href="#get_largest_polygon-702"><span class="linenos">702</span></a>  <span class="n">actual_polygons</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">polygons</span><span class="o">.</span><span class="n">geometry</span>
</span><span id="get_largest_polygon-703"><a href="#get_largest_polygon-703"><span class="linenos">703</span></a>                     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">,</span> <span class="n">geom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">))]</span>
</span><span id="get_largest_polygon-704"><a href="#get_largest_polygon-704"><span class="linenos">704</span></a>  <span class="n">areas</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">actual_polygons</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">area</span><span class="p">,</span> <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="get_largest_polygon-705"><a href="#get_largest_polygon-705"><span class="linenos">705</span></a>  <span class="k">return</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">areas</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Return largest polygon in a GeoSeries as a GeoSeries of one polygon.</p>

<p>NOT CURRENTLY USED ANYWHERE IN MODULE.</p>

<p>Args:
  polygons (gpd.GeoSeries): the set of polygons to pick from.</p>

<p>Returns:
  gpd.GeoSeries: the largest polygon.</p>
</div>


                </section>
                <section id="touch_along_an_edge">
                            <input id="touch_along_an_edge-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">touch_along_an_edge</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">p1</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span>,</span><span class="param">	<span class="n">p2</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="touch_along_an_edge-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#touch_along_an_edge"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="touch_along_an_edge-708"><a href="#touch_along_an_edge-708"><span class="linenos">708</span></a><span class="k">def</span><span class="w"> </span><span class="nf">touch_along_an_edge</span><span class="p">(</span><span class="n">p1</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="touch_along_an_edge-709"><a href="#touch_along_an_edge-709"><span class="linenos">709</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Test if two polygons touch along an edge.</span>
</span><span id="touch_along_an_edge-710"><a href="#touch_along_an_edge-710"><span class="linenos">710</span></a>
</span><span id="touch_along_an_edge-711"><a href="#touch_along_an_edge-711"><span class="linenos">711</span></a><span class="sd">  Checks that the intersection area of the two polygons buffered by</span>
</span><span id="touch_along_an_edge-712"><a href="#touch_along_an_edge-712"><span class="linenos">712</span></a><span class="sd">  a small amount is large enough to indicate that they neighbour at more</span>
</span><span id="touch_along_an_edge-713"><a href="#touch_along_an_edge-713"><span class="linenos">713</span></a><span class="sd">  than a corner.</span>
</span><span id="touch_along_an_edge-714"><a href="#touch_along_an_edge-714"><span class="linenos">714</span></a>
</span><span id="touch_along_an_edge-715"><a href="#touch_along_an_edge-715"><span class="linenos">715</span></a><span class="sd">  Args:</span>
</span><span id="touch_along_an_edge-716"><a href="#touch_along_an_edge-716"><span class="linenos">716</span></a><span class="sd">    p1 (geom.Polygon): First polygon</span>
</span><span id="touch_along_an_edge-717"><a href="#touch_along_an_edge-717"><span class="linenos">717</span></a><span class="sd">    p2 (geom.Polygon): Second polygon</span>
</span><span id="touch_along_an_edge-718"><a href="#touch_along_an_edge-718"><span class="linenos">718</span></a>
</span><span id="touch_along_an_edge-719"><a href="#touch_along_an_edge-719"><span class="linenos">719</span></a><span class="sd">  Returns:</span>
</span><span id="touch_along_an_edge-720"><a href="#touch_along_an_edge-720"><span class="linenos">720</span></a><span class="sd">    bool: True if they neighbour along an edge</span>
</span><span id="touch_along_an_edge-721"><a href="#touch_along_an_edge-721"><span class="linenos">721</span></a>
</span><span id="touch_along_an_edge-722"><a href="#touch_along_an_edge-722"><span class="linenos">722</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="touch_along_an_edge-723"><a href="#touch_along_an_edge-723"><span class="linenos">723</span></a>  <span class="k">return</span> <span class="p">(</span>
</span><span id="touch_along_an_edge-724"><a href="#touch_along_an_edge-724"><span class="linenos">724</span></a>    <span class="n">p1</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">RESOLUTION</span><span class="p">,</span> <span class="n">join_style</span> <span class="o">=</span> <span class="s2">&quot;mitre&quot;</span><span class="p">,</span> <span class="n">cap_style</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">)</span>
</span><span id="touch_along_an_edge-725"><a href="#touch_along_an_edge-725"><span class="linenos">725</span></a>      <span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">p2</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">RESOLUTION</span><span class="p">,</span> <span class="n">join_style</span> <span class="o">=</span> <span class="s2">&quot;mitre&quot;</span><span class="p">,</span>
</span><span id="touch_along_an_edge-726"><a href="#touch_along_an_edge-726"><span class="linenos">726</span></a>                                          <span class="n">cap_style</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">))</span>
</span><span id="touch_along_an_edge-727"><a href="#touch_along_an_edge-727"><span class="linenos">727</span></a>      <span class="o">.</span><span class="n">area</span> <span class="o">&gt;</span> <span class="mi">16</span> <span class="o">*</span> <span class="n">RESOLUTION</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Test if two polygons touch along an edge.</p>

<p>Checks that the intersection area of the two polygons buffered by
a small amount is large enough to indicate that they neighbour at more
than a corner.</p>

<p>Args:
  p1 (geom.Polygon): First polygon
  p2 (geom.Polygon): Second polygon</p>

<p>Returns:
  bool: True if they neighbour along an edge</p>
</div>


                </section>
                <section id="get_width_height_left_bottom">
                            <input id="get_width_height_left_bottom-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_width_height_left_bottom</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">gs</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geoseries</span><span class="o">.</span><span class="n">GeoSeries</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="get_width_height_left_bottom-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_width_height_left_bottom"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_width_height_left_bottom-730"><a href="#get_width_height_left_bottom-730"><span class="linenos">730</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_width_height_left_bottom</span><span class="p">(</span>
</span><span id="get_width_height_left_bottom-731"><a href="#get_width_height_left_bottom-731"><span class="linenos">731</span></a>    <span class="n">gs</span><span class="p">:</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">,</span>
</span><span id="get_width_height_left_bottom-732"><a href="#get_width_height_left_bottom-732"><span class="linenos">732</span></a>  <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="get_width_height_left_bottom-733"><a href="#get_width_height_left_bottom-733"><span class="linenos">733</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return width, height, left and bottom limits of a GeoSeries.</span>
</span><span id="get_width_height_left_bottom-734"><a href="#get_width_height_left_bottom-734"><span class="linenos">734</span></a>
</span><span id="get_width_height_left_bottom-735"><a href="#get_width_height_left_bottom-735"><span class="linenos">735</span></a><span class="sd">  Args:</span>
</span><span id="get_width_height_left_bottom-736"><a href="#get_width_height_left_bottom-736"><span class="linenos">736</span></a><span class="sd">    gs (geopandas.GeoSeries): GeoSeries for which limits are required.</span>
</span><span id="get_width_height_left_bottom-737"><a href="#get_width_height_left_bottom-737"><span class="linenos">737</span></a>
</span><span id="get_width_height_left_bottom-738"><a href="#get_width_height_left_bottom-738"><span class="linenos">738</span></a><span class="sd">  Returns:</span>
</span><span id="get_width_height_left_bottom-739"><a href="#get_width_height_left_bottom-739"><span class="linenos">739</span></a><span class="sd">    tuple: four float values of width, height, left and bottom of gs.</span>
</span><span id="get_width_height_left_bottom-740"><a href="#get_width_height_left_bottom-740"><span class="linenos">740</span></a>
</span><span id="get_width_height_left_bottom-741"><a href="#get_width_height_left_bottom-741"><span class="linenos">741</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_width_height_left_bottom-742"><a href="#get_width_height_left_bottom-742"><span class="linenos">742</span></a>  <span class="n">bb</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">total_bounds</span>
</span><span id="get_width_height_left_bottom-743"><a href="#get_width_height_left_bottom-743"><span class="linenos">743</span></a>  <span class="k">return</span> <span class="p">(</span><span class="n">bb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">bb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bb</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bb</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Return width, height, left and bottom limits of a GeoSeries.</p>

<p>Args:
  gs (geopandas.GeoSeries): GeoSeries for which limits are required.</p>

<p>Returns:
  tuple: four float values of width, height, left and bottom of gs.</p>
</div>


                </section>
                <section id="get_bounding_ellipse">
                            <input id="get_bounding_ellipse-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_bounding_ellipse</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">shapes</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geoseries</span><span class="o">.</span><span class="n">GeoSeries</span>,</span><span class="param">	<span class="n">mag</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span></span><span class="return-annotation">) -> <span class="n">geopandas</span><span class="o">.</span><span class="n">geoseries</span><span class="o">.</span><span class="n">GeoSeries</span>:</span></span>

                <label class="view-source-button" for="get_bounding_ellipse-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_bounding_ellipse"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_bounding_ellipse-746"><a href="#get_bounding_ellipse-746"><span class="linenos">746</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_bounding_ellipse</span><span class="p">(</span>
</span><span id="get_bounding_ellipse-747"><a href="#get_bounding_ellipse-747"><span class="linenos">747</span></a>    <span class="n">shapes</span><span class="p">:</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">,</span>
</span><span id="get_bounding_ellipse-748"><a href="#get_bounding_ellipse-748"><span class="linenos">748</span></a>    <span class="n">mag</span><span class="p">:</span><span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="get_bounding_ellipse-749"><a href="#get_bounding_ellipse-749"><span class="linenos">749</span></a>  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">:</span>
</span><span id="get_bounding_ellipse-750"><a href="#get_bounding_ellipse-750"><span class="linenos">750</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return an ellipse containing the supplied shapes.</span>
</span><span id="get_bounding_ellipse-751"><a href="#get_bounding_ellipse-751"><span class="linenos">751</span></a>
</span><span id="get_bounding_ellipse-752"><a href="#get_bounding_ellipse-752"><span class="linenos">752</span></a><span class="sd">  The method used is to calculate the size of square that would contain</span>
</span><span id="get_bounding_ellipse-753"><a href="#get_bounding_ellipse-753"><span class="linenos">753</span></a><span class="sd">  the shapes, if they had an aspect ratio 1, then stretch the circle in</span>
</span><span id="get_bounding_ellipse-754"><a href="#get_bounding_ellipse-754"><span class="linenos">754</span></a><span class="sd">  the x, y directions according to the actual aspect ratio of the shapes.</span>
</span><span id="get_bounding_ellipse-755"><a href="#get_bounding_ellipse-755"><span class="linenos">755</span></a>
</span><span id="get_bounding_ellipse-756"><a href="#get_bounding_ellipse-756"><span class="linenos">756</span></a><span class="sd">  Args:</span>
</span><span id="get_bounding_ellipse-757"><a href="#get_bounding_ellipse-757"><span class="linenos">757</span></a><span class="sd">    shapes (gpd.GeoSeries): the shapes to be contained.</span>
</span><span id="get_bounding_ellipse-758"><a href="#get_bounding_ellipse-758"><span class="linenos">758</span></a><span class="sd">    mag (float, optional): optionally increase the size of the returned</span>
</span><span id="get_bounding_ellipse-759"><a href="#get_bounding_ellipse-759"><span class="linenos">759</span></a><span class="sd">      ellipse by this scale factor. Defaults to 1.0.</span>
</span><span id="get_bounding_ellipse-760"><a href="#get_bounding_ellipse-760"><span class="linenos">760</span></a>
</span><span id="get_bounding_ellipse-761"><a href="#get_bounding_ellipse-761"><span class="linenos">761</span></a><span class="sd">  Returns:</span>
</span><span id="get_bounding_ellipse-762"><a href="#get_bounding_ellipse-762"><span class="linenos">762</span></a><span class="sd">    gpd.GeoSeries: the set of shapes.</span>
</span><span id="get_bounding_ellipse-763"><a href="#get_bounding_ellipse-763"><span class="linenos">763</span></a>
</span><span id="get_bounding_ellipse-764"><a href="#get_bounding_ellipse-764"><span class="linenos">764</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_bounding_ellipse-765"><a href="#get_bounding_ellipse-765"><span class="linenos">765</span></a>  <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="n">get_width_height_left_bottom</span><span class="p">(</span><span class="n">shapes</span><span class="p">)</span>
</span><span id="get_bounding_ellipse-766"><a href="#get_bounding_ellipse-766"><span class="linenos">766</span></a>  <span class="n">c</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">+</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="get_bounding_ellipse-767"><a href="#get_bounding_ellipse-767"><span class="linenos">767</span></a>  <span class="n">r</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="get_bounding_ellipse-768"><a href="#get_bounding_ellipse-768"><span class="linenos">768</span></a>  <span class="n">circle</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">r</span><span class="p">)]</span>
</span><span id="get_bounding_ellipse-769"><a href="#get_bounding_ellipse-769"><span class="linenos">769</span></a>  <span class="k">return</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">circle</span><span class="p">,</span> <span class="n">crs</span> <span class="o">=</span> <span class="n">shapes</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
</span><span id="get_bounding_ellipse-770"><a href="#get_bounding_ellipse-770"><span class="linenos">770</span></a>    <span class="n">width</span> <span class="o">/</span> <span class="n">r</span> <span class="o">*</span> <span class="n">mag</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">height</span> <span class="o">/</span> <span class="n">r</span> <span class="o">*</span> <span class="n">mag</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">origin</span> <span class="o">=</span> <span class="n">c</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return an ellipse containing the supplied shapes.</p>

<p>The method used is to calculate the size of square that would contain
the shapes, if they had an aspect ratio 1, then stretch the circle in
the x, y directions according to the actual aspect ratio of the shapes.</p>

<p>Args:
  shapes (gpd.GeoSeries): the shapes to be contained.
  mag (float, optional): optionally increase the size of the returned
    ellipse by this scale factor. Defaults to 1.0.</p>

<p>Returns:
  gpd.GeoSeries: the set of shapes.</p>
</div>


                </section>
                <section id="get_tiling_edges">
                            <input id="get_tiling_edges-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_tiling_edges</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">tiles</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geoseries</span><span class="o">.</span><span class="n">GeoSeries</span></span><span class="return-annotation">) -> <span class="n">geopandas</span><span class="o">.</span><span class="n">geoseries</span><span class="o">.</span><span class="n">GeoSeries</span>:</span></span>

                <label class="view-source-button" for="get_tiling_edges-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_tiling_edges"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_tiling_edges-773"><a href="#get_tiling_edges-773"><span class="linenos">773</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_tiling_edges</span><span class="p">(</span><span class="n">tiles</span><span class="p">:</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">:</span>
</span><span id="get_tiling_edges-774"><a href="#get_tiling_edges-774"><span class="linenos">774</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return linestring GeoSeries from supplied polygon GeoSeries.</span>
</span><span id="get_tiling_edges-775"><a href="#get_tiling_edges-775"><span class="linenos">775</span></a>
</span><span id="get_tiling_edges-776"><a href="#get_tiling_edges-776"><span class="linenos">776</span></a><span class="sd">  This is used to allow display of edges of tiles in legend when they are</span>
</span><span id="get_tiling_edges-777"><a href="#get_tiling_edges-777"><span class="linenos">777</span></a><span class="sd">  masked by an ellipse (if we instead clip polygons then the ellipse edge</span>
</span><span id="get_tiling_edges-778"><a href="#get_tiling_edges-778"><span class="linenos">778</span></a><span class="sd">  will also show in the result.)</span>
</span><span id="get_tiling_edges-779"><a href="#get_tiling_edges-779"><span class="linenos">779</span></a>
</span><span id="get_tiling_edges-780"><a href="#get_tiling_edges-780"><span class="linenos">780</span></a><span class="sd">  Args:</span>
</span><span id="get_tiling_edges-781"><a href="#get_tiling_edges-781"><span class="linenos">781</span></a><span class="sd">    tiles (gpd.GeoSeries): Polygons to convert.</span>
</span><span id="get_tiling_edges-782"><a href="#get_tiling_edges-782"><span class="linenos">782</span></a>
</span><span id="get_tiling_edges-783"><a href="#get_tiling_edges-783"><span class="linenos">783</span></a><span class="sd">  Returns:</span>
</span><span id="get_tiling_edges-784"><a href="#get_tiling_edges-784"><span class="linenos">784</span></a><span class="sd">    gpd.GeoSeries: LineStrings from the supplied Polygons.</span>
</span><span id="get_tiling_edges-785"><a href="#get_tiling_edges-785"><span class="linenos">785</span></a>
</span><span id="get_tiling_edges-786"><a href="#get_tiling_edges-786"><span class="linenos">786</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_tiling_edges-787"><a href="#get_tiling_edges-787"><span class="linenos">787</span></a>  <span class="n">tiles</span> <span class="o">=</span> <span class="n">tiles</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="get_tiling_edges-788"><a href="#get_tiling_edges-788"><span class="linenos">788</span></a>  <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">tiles</span><span class="p">]</span>
</span><span id="get_tiling_edges-789"><a href="#get_tiling_edges-789"><span class="linenos">789</span></a>  <span class="k">return</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">crs</span> <span class="o">=</span> <span class="n">tiles</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return linestring GeoSeries from supplied polygon GeoSeries.</p>

<p>This is used to allow display of edges of tiles in legend when they are
masked by an ellipse (if we instead clip polygons then the ellipse edge
will also show in the result.)</p>

<p>Args:
  tiles (gpd.GeoSeries): Polygons to convert.</p>

<p>Returns:
  gpd.GeoSeries: LineStrings from the supplied Polygons.</p>
</div>


                </section>
                <section id="get_polygon_sector">
                            <input id="get_polygon_sector-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_polygon_sector</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">shape</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span>,</span><span class="param">	<span class="n">start</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">end</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span></span><span class="return-annotation">) -> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span>:</span></span>

                <label class="view-source-button" for="get_polygon_sector-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_polygon_sector"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_polygon_sector-792"><a href="#get_polygon_sector-792"><span class="linenos">792</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_polygon_sector</span><span class="p">(</span>
</span><span id="get_polygon_sector-793"><a href="#get_polygon_sector-793"><span class="linenos">793</span></a>    <span class="n">shape</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">,</span>
</span><span id="get_polygon_sector-794"><a href="#get_polygon_sector-794"><span class="linenos">794</span></a>    <span class="n">start</span><span class="p">:</span><span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="get_polygon_sector-795"><a href="#get_polygon_sector-795"><span class="linenos">795</span></a>    <span class="n">end</span><span class="p">:</span><span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="get_polygon_sector-796"><a href="#get_polygon_sector-796"><span class="linenos">796</span></a>  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">:</span>
</span><span id="get_polygon_sector-797"><a href="#get_polygon_sector-797"><span class="linenos">797</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return a sector of the provided Polygon.</span>
</span><span id="get_polygon_sector-798"><a href="#get_polygon_sector-798"><span class="linenos">798</span></a>
</span><span id="get_polygon_sector-799"><a href="#get_polygon_sector-799"><span class="linenos">799</span></a><span class="sd">  The returned sector is a section of the polygon boundary between the</span>
</span><span id="get_polygon_sector-800"><a href="#get_polygon_sector-800"><span class="linenos">800</span></a><span class="sd">  normalized start and end positions, and including the polygon centroid.</span>
</span><span id="get_polygon_sector-801"><a href="#get_polygon_sector-801"><span class="linenos">801</span></a><span class="sd">  Should (probably) only be applied to convex polygons.</span>
</span><span id="get_polygon_sector-802"><a href="#get_polygon_sector-802"><span class="linenos">802</span></a>
</span><span id="get_polygon_sector-803"><a href="#get_polygon_sector-803"><span class="linenos">803</span></a><span class="sd">  Args:</span>
</span><span id="get_polygon_sector-804"><a href="#get_polygon_sector-804"><span class="linenos">804</span></a><span class="sd">    shape (geom.Polygon): the Polygon.</span>
</span><span id="get_polygon_sector-805"><a href="#get_polygon_sector-805"><span class="linenos">805</span></a><span class="sd">    start (float): normalized start position along the boundary. Defaults to</span>
</span><span id="get_polygon_sector-806"><a href="#get_polygon_sector-806"><span class="linenos">806</span></a><span class="sd">      0.</span>
</span><span id="get_polygon_sector-807"><a href="#get_polygon_sector-807"><span class="linenos">807</span></a><span class="sd">    end (float): normalized start position along the boundary. Defaults to</span>
</span><span id="get_polygon_sector-808"><a href="#get_polygon_sector-808"><span class="linenos">808</span></a><span class="sd">      1.</span>
</span><span id="get_polygon_sector-809"><a href="#get_polygon_sector-809"><span class="linenos">809</span></a>
</span><span id="get_polygon_sector-810"><a href="#get_polygon_sector-810"><span class="linenos">810</span></a><span class="sd">  Returns:</span>
</span><span id="get_polygon_sector-811"><a href="#get_polygon_sector-811"><span class="linenos">811</span></a><span class="sd">    geom.Polygon: the requested polygon sector.</span>
</span><span id="get_polygon_sector-812"><a href="#get_polygon_sector-812"><span class="linenos">812</span></a>
</span><span id="get_polygon_sector-813"><a href="#get_polygon_sector-813"><span class="linenos">813</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_polygon_sector-814"><a href="#get_polygon_sector-814"><span class="linenos">814</span></a>  <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
</span><span id="get_polygon_sector-815"><a href="#get_polygon_sector-815"><span class="linenos">815</span></a>    <span class="c1"># must return a null polygon since the calling context</span>
</span><span id="get_polygon_sector-816"><a href="#get_polygon_sector-816"><span class="linenos">816</span></a>    <span class="c1"># expects to get something back... which most likely</span>
</span><span id="get_polygon_sector-817"><a href="#get_polygon_sector-817"><span class="linenos">817</span></a>    <span class="c1"># is needed to align with other data</span>
</span><span id="get_polygon_sector-818"><a href="#get_polygon_sector-818"><span class="linenos">818</span></a>    <span class="k">return</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">()</span>
</span><span id="get_polygon_sector-819"><a href="#get_polygon_sector-819"><span class="linenos">819</span></a>  <span class="k">if</span> <span class="n">start</span> <span class="o">*</span> <span class="n">end</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="get_polygon_sector-820"><a href="#get_polygon_sector-820"><span class="linenos">820</span></a>    <span class="c1"># either side of 0/1 so assume required sector includes 0</span>
</span><span id="get_polygon_sector-821"><a href="#get_polygon_sector-821"><span class="linenos">821</span></a>    <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span><span id="get_polygon_sector-822"><a href="#get_polygon_sector-822"><span class="linenos">822</span></a>    <span class="n">arc1</span> <span class="o">=</span> <span class="n">shapely</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">substring</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span>
</span><span id="get_polygon_sector-823"><a href="#get_polygon_sector-823"><span class="linenos">823</span></a>                                 <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">normalized</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="get_polygon_sector-824"><a href="#get_polygon_sector-824"><span class="linenos">824</span></a>    <span class="n">arc2</span> <span class="o">=</span> <span class="n">shapely</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">substring</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span>
</span><span id="get_polygon_sector-825"><a href="#get_polygon_sector-825"><span class="linenos">825</span></a>                                 <span class="mi">0</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">normalized</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="get_polygon_sector-826"><a href="#get_polygon_sector-826"><span class="linenos">826</span></a>    <span class="n">sector</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span>
</span><span id="get_polygon_sector-827"><a href="#get_polygon_sector-827"><span class="linenos">827</span></a>      <span class="p">[</span><span class="n">shape</span><span class="o">.</span><span class="n">centroid</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">arc1</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">arc2</span><span class="o">.</span><span class="n">coords</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="get_polygon_sector-828"><a href="#get_polygon_sector-828"><span class="linenos">828</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="get_polygon_sector-829"><a href="#get_polygon_sector-829"><span class="linenos">829</span></a>    <span class="n">arc</span> <span class="o">=</span> <span class="n">shapely</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">substring</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span>
</span><span id="get_polygon_sector-830"><a href="#get_polygon_sector-830"><span class="linenos">830</span></a>                                <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">normalized</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="get_polygon_sector-831"><a href="#get_polygon_sector-831"><span class="linenos">831</span></a>    <span class="n">sector</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">([</span><span class="n">shape</span><span class="o">.</span><span class="n">centroid</span><span class="p">,</span> <span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="n">arc</span><span class="o">.</span><span class="n">coords</span><span class="p">)])</span>
</span><span id="get_polygon_sector-832"><a href="#get_polygon_sector-832"><span class="linenos">832</span></a>  <span class="k">return</span> <span class="n">sector</span>
</span></pre></div>


            <div class="docstring"><p>Return a sector of the provided Polygon.</p>

<p>The returned sector is a section of the polygon boundary between the
normalized start and end positions, and including the polygon centroid.
Should (probably) only be applied to convex polygons.</p>

<p>Args:
  shape (geom.Polygon): the Polygon.
  start (float): normalized start position along the boundary. Defaults to
    0.
  end (float): normalized start position along the boundary. Defaults to
    1.</p>

<p>Returns:
  geom.Polygon: the requested polygon sector.</p>
</div>


                </section>
                <section id="repair_polygon">
                            <input id="repair_polygon-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">repair_polygon</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">polygon</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span> <span class="o">|</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">multipolygon</span><span class="o">.</span><span class="n">MultiPolygon</span> <span class="o">|</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geoseries</span><span class="o">.</span><span class="n">GeoSeries</span>,</span><span class="param">	<span class="n">shrink_then_grow</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span> <span class="o">|</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geoseries</span><span class="o">.</span><span class="n">GeoSeries</span>:</span></span>

                <label class="view-source-button" for="repair_polygon-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#repair_polygon"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="repair_polygon-835"><a href="#repair_polygon-835"><span class="linenos">835</span></a><span class="k">def</span><span class="w"> </span><span class="nf">repair_polygon</span><span class="p">(</span>
</span><span id="repair_polygon-836"><a href="#repair_polygon-836"><span class="linenos">836</span></a>    <span class="n">polygon</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="o">|</span><span class="n">geom</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="o">|</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">,</span>
</span><span id="repair_polygon-837"><a href="#repair_polygon-837"><span class="linenos">837</span></a>    <span class="n">shrink_then_grow</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="repair_polygon-838"><a href="#repair_polygon-838"><span class="linenos">838</span></a>  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="o">|</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">:</span>
</span><span id="repair_polygon-839"><a href="#repair_polygon-839"><span class="linenos">839</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Repair a polyon or GeoSeries by double buffering.</span>
</span><span id="repair_polygon-840"><a href="#repair_polygon-840"><span class="linenos">840</span></a>
</span><span id="repair_polygon-841"><a href="#repair_polygon-841"><span class="linenos">841</span></a><span class="sd">  This is method is often unofficially recommended (on stackexchange etc.)</span>
</span><span id="repair_polygon-842"><a href="#repair_polygon-842"><span class="linenos">842</span></a><span class="sd">  even in the shapely docs, to resolve topology issues and extraneous</span>
</span><span id="repair_polygon-843"><a href="#repair_polygon-843"><span class="linenos">843</span></a><span class="sd">  additional vertices appearing when spatial operations are repeatedly</span>
</span><span id="repair_polygon-844"><a href="#repair_polygon-844"><span class="linenos">844</span></a><span class="sd">  applied.</span>
</span><span id="repair_polygon-845"><a href="#repair_polygon-845"><span class="linenos">845</span></a>
</span><span id="repair_polygon-846"><a href="#repair_polygon-846"><span class="linenos">846</span></a><span class="sd">  Optionally the buffer may be applied in the opposite order (i.e. grow then</span>
</span><span id="repair_polygon-847"><a href="#repair_polygon-847"><span class="linenos">847</span></a><span class="sd">  shrink). This operation may also convert a MultiPolygon that has some &#39;stray&#39;</span>
</span><span id="repair_polygon-848"><a href="#repair_polygon-848"><span class="linenos">848</span></a><span class="sd">  parts to a Polygon.</span>
</span><span id="repair_polygon-849"><a href="#repair_polygon-849"><span class="linenos">849</span></a>
</span><span id="repair_polygon-850"><a href="#repair_polygon-850"><span class="linenos">850</span></a><span class="sd">  Args:</span>
</span><span id="repair_polygon-851"><a href="#repair_polygon-851"><span class="linenos">851</span></a><span class="sd">    polygon(geom.Polygon|gpd.GeoSeries): Polygon or GeoSeries to clean.</span>
</span><span id="repair_polygon-852"><a href="#repair_polygon-852"><span class="linenos">852</span></a><span class="sd">    res (float, optional): buffer size to use. Defaults to 1e-3.</span>
</span><span id="repair_polygon-853"><a href="#repair_polygon-853"><span class="linenos">853</span></a><span class="sd">    shrink_then_grow (bool, optional): if True the negative buffer is</span>
</span><span id="repair_polygon-854"><a href="#repair_polygon-854"><span class="linenos">854</span></a><span class="sd">      applied first, otherwise the buffer operations are applied in</span>
</span><span id="repair_polygon-855"><a href="#repair_polygon-855"><span class="linenos">855</span></a><span class="sd">      reverse. Defaults to True.</span>
</span><span id="repair_polygon-856"><a href="#repair_polygon-856"><span class="linenos">856</span></a>
</span><span id="repair_polygon-857"><a href="#repair_polygon-857"><span class="linenos">857</span></a><span class="sd">  Returns:</span>
</span><span id="repair_polygon-858"><a href="#repair_polygon-858"><span class="linenos">858</span></a><span class="sd">    geom.Polygon|gpd.GeoSeries: the cleaned Polygon or GeoSeries.</span>
</span><span id="repair_polygon-859"><a href="#repair_polygon-859"><span class="linenos">859</span></a>
</span><span id="repair_polygon-860"><a href="#repair_polygon-860"><span class="linenos">860</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="repair_polygon-861"><a href="#repair_polygon-861"><span class="linenos">861</span></a>  <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span> <span class="ow">is</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">:</span>
</span><span id="repair_polygon-862"><a href="#repair_polygon-862"><span class="linenos">862</span></a>    <span class="k">return</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">([</span><span class="n">repair_polygon</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">shrink_then_grow</span><span class="p">)</span>
</span><span id="repair_polygon-863"><a href="#repair_polygon-863"><span class="linenos">863</span></a>                          <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">polygon</span><span class="p">])</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="n">polygon</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</span><span id="repair_polygon-864"><a href="#repair_polygon-864"><span class="linenos">864</span></a>  <span class="k">if</span> <span class="n">polygon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="repair_polygon-865"><a href="#repair_polygon-865"><span class="linenos">865</span></a>    <span class="k">return</span> <span class="kc">None</span>
</span><span id="repair_polygon-866"><a href="#repair_polygon-866"><span class="linenos">866</span></a>  <span class="k">if</span> <span class="n">shrink_then_grow</span><span class="p">:</span>
</span><span id="repair_polygon-867"><a href="#repair_polygon-867"><span class="linenos">867</span></a>    <span class="k">return</span> <span class="n">polygon</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span>
</span><span id="repair_polygon-868"><a href="#repair_polygon-868"><span class="linenos">868</span></a>      <span class="o">-</span><span class="n">RESOLUTION</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="n">join_style</span> <span class="o">=</span> <span class="s2">&quot;mitre&quot;</span><span class="p">,</span> <span class="n">cap_style</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span>
</span><span id="repair_polygon-869"><a href="#repair_polygon-869"><span class="linenos">869</span></a>       <span class="n">RESOLUTION</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="n">join_style</span> <span class="o">=</span> <span class="s2">&quot;mitre&quot;</span><span class="p">,</span> <span class="n">cap_style</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">)</span>
</span><span id="repair_polygon-870"><a href="#repair_polygon-870"><span class="linenos">870</span></a>  <span class="k">return</span> <span class="n">polygon</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span>
</span><span id="repair_polygon-871"><a href="#repair_polygon-871"><span class="linenos">871</span></a>     <span class="n">RESOLUTION</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="n">join_style</span> <span class="o">=</span> <span class="s2">&quot;mitre&quot;</span><span class="p">,</span> <span class="n">cap_style</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span>
</span><span id="repair_polygon-872"><a href="#repair_polygon-872"><span class="linenos">872</span></a>    <span class="o">-</span><span class="n">RESOLUTION</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="n">join_style</span> <span class="o">=</span> <span class="s2">&quot;mitre&quot;</span><span class="p">,</span> <span class="n">cap_style</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Repair a polyon or GeoSeries by double buffering.</p>

<p>This is method is often unofficially recommended (on stackexchange etc.)
even in the shapely docs, to resolve topology issues and extraneous
additional vertices appearing when spatial operations are repeatedly
applied.</p>

<p>Optionally the buffer may be applied in the opposite order (i.e. grow then
shrink). This operation may also convert a MultiPolygon that has some 'stray'
parts to a Polygon.</p>

<p>Args:
  polygon(geom.Polygon|gpd.GeoSeries): Polygon or GeoSeries to clean.
  res (float, optional): buffer size to use. Defaults to 1e-3.
  shrink_then_grow (bool, optional): if True the negative buffer is
    applied first, otherwise the buffer operations are applied in
    reverse. Defaults to True.</p>

<p>Returns:
  geom.Polygon|gpd.GeoSeries: the cleaned Polygon or GeoSeries.</p>
</div>


                </section>
                <section id="safe_union">
                            <input id="safe_union-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">safe_union</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">gs</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geoseries</span><span class="o">.</span><span class="n">GeoSeries</span>,</span><span class="param">	<span class="n">as_polygon</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">geopandas</span><span class="o">.</span><span class="n">geoseries</span><span class="o">.</span><span class="n">GeoSeries</span> <span class="o">|</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span>:</span></span>

                <label class="view-source-button" for="safe_union-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#safe_union"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="safe_union-875"><a href="#safe_union-875"><span class="linenos">875</span></a><span class="k">def</span><span class="w"> </span><span class="nf">safe_union</span><span class="p">(</span>
</span><span id="safe_union-876"><a href="#safe_union-876"><span class="linenos">876</span></a>    <span class="n">gs</span><span class="p">:</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">,</span>
</span><span id="safe_union-877"><a href="#safe_union-877"><span class="linenos">877</span></a>    <span class="n">as_polygon</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="safe_union-878"><a href="#safe_union-878"><span class="linenos">878</span></a>  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="o">|</span><span class="n">geom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">:</span>
</span><span id="safe_union-879"><a href="#safe_union-879"><span class="linenos">879</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Union supplied GeoSeries buffering to avoid gaps and internal edges.</span>
</span><span id="safe_union-880"><a href="#safe_union-880"><span class="linenos">880</span></a>
</span><span id="safe_union-881"><a href="#safe_union-881"><span class="linenos">881</span></a><span class="sd">  Optionally returns a Polygon or a GeoSeries.</span>
</span><span id="safe_union-882"><a href="#safe_union-882"><span class="linenos">882</span></a>
</span><span id="safe_union-883"><a href="#safe_union-883"><span class="linenos">883</span></a><span class="sd">  NOTE: APPEARS NOT TO BE VERY SAFE... find workarounds for the few occasions</span>
</span><span id="safe_union-884"><a href="#safe_union-884"><span class="linenos">884</span></a><span class="sd">  on which it is used.</span>
</span><span id="safe_union-885"><a href="#safe_union-885"><span class="linenos">885</span></a>
</span><span id="safe_union-886"><a href="#safe_union-886"><span class="linenos">886</span></a><span class="sd">  Frequently when unioning polygons that are ostensibly adjacent &#39;rogue&#39;</span>
</span><span id="safe_union-887"><a href="#safe_union-887"><span class="linenos">887</span></a><span class="sd">  internal boundaries remain in the result. We can avoid this by buffering the</span>
</span><span id="safe_union-888"><a href="#safe_union-888"><span class="linenos">888</span></a><span class="sd">  polygons before unioning them, then reversing the buffer on the unioned</span>
</span><span id="safe_union-889"><a href="#safe_union-889"><span class="linenos">889</span></a><span class="sd">  shape.</span>
</span><span id="safe_union-890"><a href="#safe_union-890"><span class="linenos">890</span></a>
</span><span id="safe_union-891"><a href="#safe_union-891"><span class="linenos">891</span></a><span class="sd">  Args:</span>
</span><span id="safe_union-892"><a href="#safe_union-892"><span class="linenos">892</span></a><span class="sd">    gs (gpd.GeoSeries): the Polygons to union.</span>
</span><span id="safe_union-893"><a href="#safe_union-893"><span class="linenos">893</span></a><span class="sd">    res (float, optional): size of the buffer to use. Defaults to 1e-3.</span>
</span><span id="safe_union-894"><a href="#safe_union-894"><span class="linenos">894</span></a><span class="sd">    as_polygon (bool, optional): if True returns a Polygon, otherwise</span>
</span><span id="safe_union-895"><a href="#safe_union-895"><span class="linenos">895</span></a><span class="sd">      returns a one Polygon GeoSeries. Defaults to False.</span>
</span><span id="safe_union-896"><a href="#safe_union-896"><span class="linenos">896</span></a>
</span><span id="safe_union-897"><a href="#safe_union-897"><span class="linenos">897</span></a><span class="sd">  Returns:</span>
</span><span id="safe_union-898"><a href="#safe_union-898"><span class="linenos">898</span></a><span class="sd">    gpd.GeoSeries|geom.Polygon: the resulting union of supplied</span>
</span><span id="safe_union-899"><a href="#safe_union-899"><span class="linenos">899</span></a><span class="sd">      polygons.</span>
</span><span id="safe_union-900"><a href="#safe_union-900"><span class="linenos">900</span></a>
</span><span id="safe_union-901"><a href="#safe_union-901"><span class="linenos">901</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="safe_union-902"><a href="#safe_union-902"><span class="linenos">902</span></a>  <span class="n">r</span> <span class="o">=</span> <span class="n">RESOLUTION</span> <span class="o">*</span> <span class="mi">10</span>
</span><span id="safe_union-903"><a href="#safe_union-903"><span class="linenos">903</span></a>  <span class="n">union</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span>
</span><span id="safe_union-904"><a href="#safe_union-904"><span class="linenos">904</span></a>    <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">join_style</span> <span class="o">=</span> <span class="s2">&quot;mitre&quot;</span><span class="p">,</span> <span class="n">cap_style</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">gs</span><span class="p">],</span>
</span><span id="safe_union-905"><a href="#safe_union-905"><span class="linenos">905</span></a>    <span class="n">crs</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span><span class="o">.</span><span class="n">union_all</span><span class="p">()</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">,</span> <span class="n">join_style</span> <span class="o">=</span> <span class="s2">&quot;mitre&quot;</span><span class="p">,</span>
</span><span id="safe_union-906"><a href="#safe_union-906"><span class="linenos">906</span></a>                                         <span class="n">cap_style</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">)</span>
</span><span id="safe_union-907"><a href="#safe_union-907"><span class="linenos">907</span></a>  <span class="k">if</span> <span class="n">as_polygon</span><span class="p">:</span>
</span><span id="safe_union-908"><a href="#safe_union-908"><span class="linenos">908</span></a>    <span class="k">return</span> <span class="n">union</span>
</span><span id="safe_union-909"><a href="#safe_union-909"><span class="linenos">909</span></a>  <span class="k">return</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">([</span><span class="n">union</span><span class="p">],</span> <span class="n">crs</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Union supplied GeoSeries buffering to avoid gaps and internal edges.</p>

<p>Optionally returns a Polygon or a GeoSeries.</p>

<p>NOTE: APPEARS NOT TO BE VERY SAFE... find workarounds for the few occasions
on which it is used.</p>

<p>Frequently when unioning polygons that are ostensibly adjacent 'rogue'
internal boundaries remain in the result. We can avoid this by buffering the
polygons before unioning them, then reversing the buffer on the unioned
shape.</p>

<p>Args:
  gs (gpd.GeoSeries): the Polygons to union.
  res (float, optional): size of the buffer to use. Defaults to 1e-3.
  as_polygon (bool, optional): if True returns a Polygon, otherwise
    returns a one Polygon GeoSeries. Defaults to False.</p>

<p>Returns:
  gpd.GeoSeries|geom.Polygon: the resulting union of supplied
    polygons.</p>
</div>


                </section>
                <section id="get_translation_transform">
                            <input id="get_translation_transform-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_translation_transform</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">dx</span><span class="p">:</span> <span class="nb">float</span>, </span><span class="param"><span class="n">dy</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="get_translation_transform-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_translation_transform"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_translation_transform-912"><a href="#get_translation_transform-912"><span class="linenos">912</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_translation_transform</span><span class="p">(</span><span class="n">dx</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span><span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">]:</span>
</span><span id="get_translation_transform-913"><a href="#get_translation_transform-913"><span class="linenos">913</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return shapely affine transform tuple for a translation.</span>
</span><span id="get_translation_transform-914"><a href="#get_translation_transform-914"><span class="linenos">914</span></a>
</span><span id="get_translation_transform-915"><a href="#get_translation_transform-915"><span class="linenos">915</span></a><span class="sd">  Args:</span>
</span><span id="get_translation_transform-916"><a href="#get_translation_transform-916"><span class="linenos">916</span></a><span class="sd">      dx (float): translation distance in x direction.</span>
</span><span id="get_translation_transform-917"><a href="#get_translation_transform-917"><span class="linenos">917</span></a><span class="sd">      dy (float): translation distance in y direction.</span>
</span><span id="get_translation_transform-918"><a href="#get_translation_transform-918"><span class="linenos">918</span></a>
</span><span id="get_translation_transform-919"><a href="#get_translation_transform-919"><span class="linenos">919</span></a><span class="sd">  Returns:</span>
</span><span id="get_translation_transform-920"><a href="#get_translation_transform-920"><span class="linenos">920</span></a><span class="sd">    list[float]: a six item list of floats, per the shapely.affinity.</span>
</span><span id="get_translation_transform-921"><a href="#get_translation_transform-921"><span class="linenos">921</span></a><span class="sd">    affine_transform method, see</span>
</span><span id="get_translation_transform-922"><a href="#get_translation_transform-922"><span class="linenos">922</span></a><span class="sd">      https://shapely.readthedocs.io/en/stable/manual.html#affine-transformations</span>
</span><span id="get_translation_transform-923"><a href="#get_translation_transform-923"><span class="linenos">923</span></a>
</span><span id="get_translation_transform-924"><a href="#get_translation_transform-924"><span class="linenos">924</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_translation_transform-925"><a href="#get_translation_transform-925"><span class="linenos">925</span></a>  <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return shapely affine transform tuple for a translation.</p>

<p>Args:
    dx (float): translation distance in x direction.
    dy (float): translation distance in y direction.</p>

<p>Returns:
  list[float]: a six item list of floats, per the shapely.affinity.
  affine_transform method, see
    <a href="https://shapely.readthedocs.io/en/stable/manual.html#affine-transformations">https://shapely.readthedocs.io/en/stable/manual.html#affine-transformations</a></p>
</div>


                </section>
                <section id="get_rotation_transform">
                            <input id="get_rotation_transform-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_rotation_transform</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">angle</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">centre</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="get_rotation_transform-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_rotation_transform"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_rotation_transform-928"><a href="#get_rotation_transform-928"><span class="linenos">928</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_rotation_transform</span><span class="p">(</span>
</span><span id="get_rotation_transform-929"><a href="#get_rotation_transform-929"><span class="linenos">929</span></a>    <span class="n">angle</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">centre</span><span class="p">:</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">]</span><span class="o">|</span><span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">]:</span>
</span><span id="get_rotation_transform-930"><a href="#get_rotation_transform-930"><span class="linenos">930</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return the shapely affine transform tuple for a rotation.</span>
</span><span id="get_rotation_transform-931"><a href="#get_rotation_transform-931"><span class="linenos">931</span></a>
</span><span id="get_rotation_transform-932"><a href="#get_rotation_transform-932"><span class="linenos">932</span></a><span class="sd">  Rotation is optionally about a supplied centre point.</span>
</span><span id="get_rotation_transform-933"><a href="#get_rotation_transform-933"><span class="linenos">933</span></a>
</span><span id="get_rotation_transform-934"><a href="#get_rotation_transform-934"><span class="linenos">934</span></a><span class="sd">  Args:</span>
</span><span id="get_rotation_transform-935"><a href="#get_rotation_transform-935"><span class="linenos">935</span></a><span class="sd">    angle (float): the angle of rotation (in degrees).</span>
</span><span id="get_rotation_transform-936"><a href="#get_rotation_transform-936"><span class="linenos">936</span></a><span class="sd">    centre (tuple[float], optional): An option centre location. Defaults to</span>
</span><span id="get_rotation_transform-937"><a href="#get_rotation_transform-937"><span class="linenos">937</span></a><span class="sd">    None, which will in turn be converted to (0, 0).</span>
</span><span id="get_rotation_transform-938"><a href="#get_rotation_transform-938"><span class="linenos">938</span></a>
</span><span id="get_rotation_transform-939"><a href="#get_rotation_transform-939"><span class="linenos">939</span></a><span class="sd">  Returns:</span>
</span><span id="get_rotation_transform-940"><a href="#get_rotation_transform-940"><span class="linenos">940</span></a><span class="sd">    list[float]: a six item list of floats, per the shapely.affinity.</span>
</span><span id="get_rotation_transform-941"><a href="#get_rotation_transform-941"><span class="linenos">941</span></a><span class="sd">      affine_transform method, see</span>
</span><span id="get_rotation_transform-942"><a href="#get_rotation_transform-942"><span class="linenos">942</span></a><span class="sd">        https://shapely.readthedocs.io/en/stable/manual.html#affine-transformations</span>
</span><span id="get_rotation_transform-943"><a href="#get_rotation_transform-943"><span class="linenos">943</span></a>
</span><span id="get_rotation_transform-944"><a href="#get_rotation_transform-944"><span class="linenos">944</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_rotation_transform-945"><a href="#get_rotation_transform-945"><span class="linenos">945</span></a>  <span class="k">if</span> <span class="n">centre</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">centre</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">):</span>
</span><span id="get_rotation_transform-946"><a href="#get_rotation_transform-946"><span class="linenos">946</span></a>    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
</span><span id="get_rotation_transform-947"><a href="#get_rotation_transform-947"><span class="linenos">947</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="get_rotation_transform-948"><a href="#get_rotation_transform-948"><span class="linenos">948</span></a>  <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">centre</span>
</span><span id="get_rotation_transform-949"><a href="#get_rotation_transform-949"><span class="linenos">949</span></a>  <span class="n">t1</span> <span class="o">=</span> <span class="n">get_translation_transform</span><span class="p">(</span><span class="o">-</span><span class="n">dx</span><span class="p">,</span> <span class="o">-</span><span class="n">dy</span><span class="p">)</span>
</span><span id="get_rotation_transform-950"><a href="#get_rotation_transform-950"><span class="linenos">950</span></a>  <span class="n">r</span> <span class="o">=</span> <span class="n">get_rotation_transform</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
</span><span id="get_rotation_transform-951"><a href="#get_rotation_transform-951"><span class="linenos">951</span></a>  <span class="n">t2</span> <span class="o">=</span> <span class="n">get_translation_transform</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
</span><span id="get_rotation_transform-952"><a href="#get_rotation_transform-952"><span class="linenos">952</span></a>  <span class="k">return</span> <span class="n">combine_transforms</span><span class="p">([</span><span class="n">t1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t2</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Return the shapely affine transform tuple for a rotation.</p>

<p>Rotation is optionally about a supplied centre point.</p>

<p>Args:
  angle (float): the angle of rotation (in degrees).
  centre (tuple[float], optional): An option centre location. Defaults to
  None, which will in turn be converted to (0, 0).</p>

<p>Returns:
  list[float]: a six item list of floats, per the shapely.affinity.
    affine_transform method, see
      <a href="https://shapely.readthedocs.io/en/stable/manual.html#affine-transformations">https://shapely.readthedocs.io/en/stable/manual.html#affine-transformations</a></p>
</div>


                </section>
                <section id="get_reflection_transform">
                            <input id="get_reflection_transform-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_reflection_transform</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">angle</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">centre</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="get_reflection_transform-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_reflection_transform"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_reflection_transform-955"><a href="#get_reflection_transform-955"><span class="linenos">955</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_reflection_transform</span><span class="p">(</span>
</span><span id="get_reflection_transform-956"><a href="#get_reflection_transform-956"><span class="linenos">956</span></a>    <span class="n">angle</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">centre</span><span class="p">:</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">]</span><span class="o">|</span><span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">]:</span>
</span><span id="get_reflection_transform-957"><a href="#get_reflection_transform-957"><span class="linenos">957</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return a shapely affine reflection transform.</span>
</span><span id="get_reflection_transform-958"><a href="#get_reflection_transform-958"><span class="linenos">958</span></a>
</span><span id="get_reflection_transform-959"><a href="#get_reflection_transform-959"><span class="linenos">959</span></a><span class="sd">  Reflection is in a line at the specified angle, optionally through a</span>
</span><span id="get_reflection_transform-960"><a href="#get_reflection_transform-960"><span class="linenos">960</span></a><span class="sd">  specified centre point.</span>
</span><span id="get_reflection_transform-961"><a href="#get_reflection_transform-961"><span class="linenos">961</span></a>
</span><span id="get_reflection_transform-962"><a href="#get_reflection_transform-962"><span class="linenos">962</span></a><span class="sd">  Args:</span>
</span><span id="get_reflection_transform-963"><a href="#get_reflection_transform-963"><span class="linenos">963</span></a><span class="sd">    angle (float): angle to the x-axis of the line of reflection.</span>
</span><span id="get_reflection_transform-964"><a href="#get_reflection_transform-964"><span class="linenos">964</span></a><span class="sd">    centre (tuple[float], optional): point through which the line of</span>
</span><span id="get_reflection_transform-965"><a href="#get_reflection_transform-965"><span class="linenos">965</span></a><span class="sd">      reflection passes. Defaults to None, which</span>
</span><span id="get_reflection_transform-966"><a href="#get_reflection_transform-966"><span class="linenos">966</span></a><span class="sd">      will in turn be converted to (0, 0).</span>
</span><span id="get_reflection_transform-967"><a href="#get_reflection_transform-967"><span class="linenos">967</span></a>
</span><span id="get_reflection_transform-968"><a href="#get_reflection_transform-968"><span class="linenos">968</span></a><span class="sd">  Returns:</span>
</span><span id="get_reflection_transform-969"><a href="#get_reflection_transform-969"><span class="linenos">969</span></a><span class="sd">    list[float]: a six item list of floats, per the shapely.affinity.</span>
</span><span id="get_reflection_transform-970"><a href="#get_reflection_transform-970"><span class="linenos">970</span></a><span class="sd">      affine_transform method, see</span>
</span><span id="get_reflection_transform-971"><a href="#get_reflection_transform-971"><span class="linenos">971</span></a><span class="sd">        https://shapely.readthedocs.io/en/stable/manual.html#affine-transformations</span>
</span><span id="get_reflection_transform-972"><a href="#get_reflection_transform-972"><span class="linenos">972</span></a>
</span><span id="get_reflection_transform-973"><a href="#get_reflection_transform-973"><span class="linenos">973</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_reflection_transform-974"><a href="#get_reflection_transform-974"><span class="linenos">974</span></a>  <span class="k">if</span> <span class="n">centre</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">centre</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">RESOLUTION</span><span class="p">):</span>
</span><span id="get_reflection_transform-975"><a href="#get_reflection_transform-975"><span class="linenos">975</span></a>    <span class="n">A</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
</span><span id="get_reflection_transform-976"><a href="#get_reflection_transform-976"><span class="linenos">976</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="get_reflection_transform-977"><a href="#get_reflection_transform-977"><span class="linenos">977</span></a>  <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">centre</span>
</span><span id="get_reflection_transform-978"><a href="#get_reflection_transform-978"><span class="linenos">978</span></a>  <span class="n">t1</span> <span class="o">=</span> <span class="n">get_translation_transform</span><span class="p">(</span><span class="o">-</span><span class="n">dx</span><span class="p">,</span> <span class="o">-</span><span class="n">dy</span><span class="p">)</span>
</span><span id="get_reflection_transform-979"><a href="#get_reflection_transform-979"><span class="linenos">979</span></a>  <span class="n">r</span> <span class="o">=</span> <span class="n">get_reflection_transform</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
</span><span id="get_reflection_transform-980"><a href="#get_reflection_transform-980"><span class="linenos">980</span></a>  <span class="n">t2</span> <span class="o">=</span> <span class="n">get_translation_transform</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
</span><span id="get_reflection_transform-981"><a href="#get_reflection_transform-981"><span class="linenos">981</span></a>  <span class="k">return</span> <span class="n">combine_transforms</span><span class="p">([</span><span class="n">t1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t2</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Return a shapely affine reflection transform.</p>

<p>Reflection is in a line at the specified angle, optionally through a
specified centre point.</p>

<p>Args:
  angle (float): angle to the x-axis of the line of reflection.
  centre (tuple[float], optional): point through which the line of
    reflection passes. Defaults to None, which
    will in turn be converted to (0, 0).</p>

<p>Returns:
  list[float]: a six item list of floats, per the shapely.affinity.
    affine_transform method, see
      <a href="https://shapely.readthedocs.io/en/stable/manual.html#affine-transformations">https://shapely.readthedocs.io/en/stable/manual.html#affine-transformations</a></p>
</div>


                </section>
                <section id="combine_transforms">
                            <input id="combine_transforms-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">combine_transforms</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">transforms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="combine_transforms-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#combine_transforms"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="combine_transforms-984"><a href="#combine_transforms-984"><span class="linenos"> 984</span></a><span class="k">def</span><span class="w"> </span><span class="nf">combine_transforms</span><span class="p">(</span><span class="n">transforms</span><span class="p">:</span><span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">]:</span>
</span><span id="combine_transforms-985"><a href="#combine_transforms-985"><span class="linenos"> 985</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return shapely affine transform that combines supplied list of transforms.</span>
</span><span id="combine_transforms-986"><a href="#combine_transforms-986"><span class="linenos"> 986</span></a>
</span><span id="combine_transforms-987"><a href="#combine_transforms-987"><span class="linenos"> 987</span></a><span class="sd">  Transforms are applied in the order of the supplied list</span>
</span><span id="combine_transforms-988"><a href="#combine_transforms-988"><span class="linenos"> 988</span></a>
</span><span id="combine_transforms-989"><a href="#combine_transforms-989"><span class="linenos"> 989</span></a><span class="sd">  Args:</span>
</span><span id="combine_transforms-990"><a href="#combine_transforms-990"><span class="linenos"> 990</span></a><span class="sd">    transforms (list[list[float]]): sequence of transforms to combine.</span>
</span><span id="combine_transforms-991"><a href="#combine_transforms-991"><span class="linenos"> 991</span></a>
</span><span id="combine_transforms-992"><a href="#combine_transforms-992"><span class="linenos"> 992</span></a><span class="sd">  Returns:</span>
</span><span id="combine_transforms-993"><a href="#combine_transforms-993"><span class="linenos"> 993</span></a><span class="sd">    list[float]: a transform tuple combining the supplied transforms applied</span>
</span><span id="combine_transforms-994"><a href="#combine_transforms-994"><span class="linenos"> 994</span></a><span class="sd">      in order, see</span>
</span><span id="combine_transforms-995"><a href="#combine_transforms-995"><span class="linenos"> 995</span></a><span class="sd">        https://shapely.readthedocs.io/en/stable/manual.html#affine-transformations</span>
</span><span id="combine_transforms-996"><a href="#combine_transforms-996"><span class="linenos"> 996</span></a>
</span><span id="combine_transforms-997"><a href="#combine_transforms-997"><span class="linenos"> 997</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="combine_transforms-998"><a href="#combine_transforms-998"><span class="linenos"> 998</span></a>  <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="combine_transforms-999"><a href="#combine_transforms-999"><span class="linenos"> 999</span></a>  <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">transforms</span><span class="p">:</span>
</span><span id="combine_transforms-1000"><a href="#combine_transforms-1000"><span class="linenos">1000</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">as_numpy_matrix</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">@</span> <span class="n">result</span>
</span><span id="combine_transforms-1001"><a href="#combine_transforms-1001"><span class="linenos">1001</span></a>  <span class="k">return</span> <span class="n">as_shapely_transform</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return shapely affine transform that combines supplied list of transforms.</p>

<p>Transforms are applied in the order of the supplied list</p>

<p>Args:
  transforms (list[list[float]]): sequence of transforms to combine.</p>

<p>Returns:
  list[float]: a transform tuple combining the supplied transforms applied
    in order, see
      <a href="https://shapely.readthedocs.io/en/stable/manual.html#affine-transformations">https://shapely.readthedocs.io/en/stable/manual.html#affine-transformations</a></p>
</div>


                </section>
                <section id="reverse_transform">
                            <input id="reverse_transform-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reverse_transform</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">transform</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="reverse_transform-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#reverse_transform"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="reverse_transform-1004"><a href="#reverse_transform-1004"><span class="linenos">1004</span></a><span class="k">def</span><span class="w"> </span><span class="nf">reverse_transform</span><span class="p">(</span><span class="n">transform</span><span class="p">:</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">]:</span>
</span><span id="reverse_transform-1005"><a href="#reverse_transform-1005"><span class="linenos">1005</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return inverse shapely affine transform of the supplied transform.</span>
</span><span id="reverse_transform-1006"><a href="#reverse_transform-1006"><span class="linenos">1006</span></a>
</span><span id="reverse_transform-1007"><a href="#reverse_transform-1007"><span class="linenos">1007</span></a><span class="sd">  Args:</span>
</span><span id="reverse_transform-1008"><a href="#reverse_transform-1008"><span class="linenos">1008</span></a><span class="sd">    transform (list[float]): the transform for which the inverse is desired.</span>
</span><span id="reverse_transform-1009"><a href="#reverse_transform-1009"><span class="linenos">1009</span></a>
</span><span id="reverse_transform-1010"><a href="#reverse_transform-1010"><span class="linenos">1010</span></a><span class="sd">  Returns:</span>
</span><span id="reverse_transform-1011"><a href="#reverse_transform-1011"><span class="linenos">1011</span></a><span class="sd">    list[float]: shapely affine transform tuple that will invert the supplied</span>
</span><span id="reverse_transform-1012"><a href="#reverse_transform-1012"><span class="linenos">1012</span></a><span class="sd">      transform.</span>
</span><span id="reverse_transform-1013"><a href="#reverse_transform-1013"><span class="linenos">1013</span></a>
</span><span id="reverse_transform-1014"><a href="#reverse_transform-1014"><span class="linenos">1014</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="reverse_transform-1015"><a href="#reverse_transform-1015"><span class="linenos">1015</span></a>  <span class="k">return</span> <span class="n">as_shapely_transform</span><span class="p">(</span>
</span><span id="reverse_transform-1016"><a href="#reverse_transform-1016"><span class="linenos">1016</span></a>    <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">as_numpy_matrix</span><span class="p">(</span><span class="n">transform</span><span class="p">)))</span>
</span></pre></div>


            <div class="docstring"><p>Return inverse shapely affine transform of the supplied transform.</p>

<p>Args:
  transform (list[float]): the transform for which the inverse is desired.</p>

<p>Returns:
  list[float]: shapely affine transform tuple that will invert the supplied
    transform.</p>
</div>


                </section>
                <section id="as_shapely_transform">
                            <input id="as_shapely_transform-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">as_shapely_transform</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">arr</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="as_shapely_transform-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#as_shapely_transform"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="as_shapely_transform-1019"><a href="#as_shapely_transform-1019"><span class="linenos">1019</span></a><span class="k">def</span><span class="w"> </span><span class="nf">as_shapely_transform</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">]:</span>
</span><span id="as_shapely_transform-1020"><a href="#as_shapely_transform-1020"><span class="linenos">1020</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return shapely affine transform equivalent to supplied numpy matrix.</span>
</span><span id="as_shapely_transform-1021"><a href="#as_shapely_transform-1021"><span class="linenos">1021</span></a>
</span><span id="as_shapely_transform-1022"><a href="#as_shapely_transform-1022"><span class="linenos">1022</span></a><span class="sd">  The numpy matrix is a conventional augmented (i.e. 3x3) affine transform</span>
</span><span id="as_shapely_transform-1023"><a href="#as_shapely_transform-1023"><span class="linenos">1023</span></a><span class="sd">  matrix.</span>
</span><span id="as_shapely_transform-1024"><a href="#as_shapely_transform-1024"><span class="linenos">1024</span></a>
</span><span id="as_shapely_transform-1025"><a href="#as_shapely_transform-1025"><span class="linenos">1025</span></a><span class="sd">  Args:</span>
</span><span id="as_shapely_transform-1026"><a href="#as_shapely_transform-1026"><span class="linenos">1026</span></a><span class="sd">    arr (np.array): augmented affine transform matrix of the desired</span>
</span><span id="as_shapely_transform-1027"><a href="#as_shapely_transform-1027"><span class="linenos">1027</span></a><span class="sd">      transform.</span>
</span><span id="as_shapely_transform-1028"><a href="#as_shapely_transform-1028"><span class="linenos">1028</span></a>
</span><span id="as_shapely_transform-1029"><a href="#as_shapely_transform-1029"><span class="linenos">1029</span></a><span class="sd">  Returns:</span>
</span><span id="as_shapely_transform-1030"><a href="#as_shapely_transform-1030"><span class="linenos">1030</span></a><span class="sd">    list[float]: desired shapely affine transform list of floats.</span>
</span><span id="as_shapely_transform-1031"><a href="#as_shapely_transform-1031"><span class="linenos">1031</span></a>
</span><span id="as_shapely_transform-1032"><a href="#as_shapely_transform-1032"><span class="linenos">1032</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="as_shapely_transform-1033"><a href="#as_shapely_transform-1033"><span class="linenos">1033</span></a>  <span class="k">return</span> <span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Return shapely affine transform equivalent to supplied numpy matrix.</p>

<p>The numpy matrix is a conventional augmented (i.e. 3x3) affine transform
matrix.</p>

<p>Args:
  arr (np.array): augmented affine transform matrix of the desired
    transform.</p>

<p>Returns:
  list[float]: desired shapely affine transform list of floats.</p>
</div>


                </section>
                <section id="as_numpy_matrix">
                            <input id="as_numpy_matrix-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">as_numpy_matrix</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">transform</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="as_numpy_matrix-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#as_numpy_matrix"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="as_numpy_matrix-1036"><a href="#as_numpy_matrix-1036"><span class="linenos">1036</span></a><span class="k">def</span><span class="w"> </span><span class="nf">as_numpy_matrix</span><span class="p">(</span><span class="n">transform</span><span class="p">:</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="as_numpy_matrix-1037"><a href="#as_numpy_matrix-1037"><span class="linenos">1037</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Convert shapely affine transform to augmented affine transform matrix.</span>
</span><span id="as_numpy_matrix-1038"><a href="#as_numpy_matrix-1038"><span class="linenos">1038</span></a>
</span><span id="as_numpy_matrix-1039"><a href="#as_numpy_matrix-1039"><span class="linenos">1039</span></a><span class="sd">  Args:</span>
</span><span id="as_numpy_matrix-1040"><a href="#as_numpy_matrix-1040"><span class="linenos">1040</span></a><span class="sd">    transform (list[float]): the transform in shapely format.</span>
</span><span id="as_numpy_matrix-1041"><a href="#as_numpy_matrix-1041"><span class="linenos">1041</span></a>
</span><span id="as_numpy_matrix-1042"><a href="#as_numpy_matrix-1042"><span class="linenos">1042</span></a><span class="sd">  Returns:</span>
</span><span id="as_numpy_matrix-1043"><a href="#as_numpy_matrix-1043"><span class="linenos">1043</span></a><span class="sd">    np.array: the transform in numpy matrix format.</span>
</span><span id="as_numpy_matrix-1044"><a href="#as_numpy_matrix-1044"><span class="linenos">1044</span></a>
</span><span id="as_numpy_matrix-1045"><a href="#as_numpy_matrix-1045"><span class="linenos">1045</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="as_numpy_matrix-1046"><a href="#as_numpy_matrix-1046"><span class="linenos">1046</span></a>  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">transform</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">transform</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">transform</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span>
</span><span id="as_numpy_matrix-1047"><a href="#as_numpy_matrix-1047"><span class="linenos">1047</span></a>                   <span class="p">[</span><span class="n">transform</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">transform</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">transform</span><span class="p">[</span><span class="mi">5</span><span class="p">]],</span>
</span><span id="as_numpy_matrix-1048"><a href="#as_numpy_matrix-1048"><span class="linenos">1048</span></a>                   <span class="p">[</span>           <span class="mi">0</span><span class="p">,</span>            <span class="mi">0</span><span class="p">,</span>            <span class="mi">1</span><span class="p">]])</span>
</span></pre></div>


            <div class="docstring"><p>Convert shapely affine transform to augmented affine transform matrix.</p>

<p>Args:
  transform (list[float]): the transform in shapely format.</p>

<p>Returns:
  np.array: the transform in numpy matrix format.</p>
</div>


                </section>
                <section id="StraightLine">
                            <input id="StraightLine-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">StraightLine</span><wbr>(<span class="base">typing.NamedTuple</span>):

                <label class="view-source-button" for="StraightLine-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StraightLine"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StraightLine-1051"><a href="#StraightLine-1051"><span class="linenos">1051</span></a><span class="k">class</span><span class="w"> </span><span class="nc">StraightLine</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
</span><span id="StraightLine-1052"><a href="#StraightLine-1052"><span class="linenos">1052</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Straight line in canonical Ax+By+C=0 form.&quot;&quot;&quot;</span>
</span><span id="StraightLine-1053"><a href="#StraightLine-1053"><span class="linenos">1053</span></a>
</span><span id="StraightLine-1054"><a href="#StraightLine-1054"><span class="linenos">1054</span></a>  <span class="n">A</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="StraightLine-1055"><a href="#StraightLine-1055"><span class="linenos">1055</span></a>  <span class="n">B</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="StraightLine-1056"><a href="#StraightLine-1056"><span class="linenos">1056</span></a>  <span class="n">C</span><span class="p">:</span> <span class="nb">float</span>
</span></pre></div>


            <div class="docstring"><p>Straight line in canonical Ax+By+C=0 form.</p>
</div>


                            <div id="StraightLine.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">StraightLine</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">A</span><span class="p">:</span> <span class="nb">float</span>, </span><span class="param"><span class="n">B</span><span class="p">:</span> <span class="nb">float</span>, </span><span class="param"><span class="n">C</span><span class="p">:</span> <span class="nb">float</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#StraightLine.__init__"></a>
    
            <div class="docstring"><p>Create new instance of StraightLine(A, B, C)</p>
</div>


                            </div>
                            <div id="StraightLine.A" class="classattr">
                                <div class="attr variable">
            <span class="name">A</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#StraightLine.A"></a>
    
            <div class="docstring"><p>Alias for field number 0</p>
</div>


                            </div>
                            <div id="StraightLine.B" class="classattr">
                                <div class="attr variable">
            <span class="name">B</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#StraightLine.B"></a>
    
            <div class="docstring"><p>Alias for field number 1</p>
</div>


                            </div>
                            <div id="StraightLine.C" class="classattr">
                                <div class="attr variable">
            <span class="name">C</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#StraightLine.C"></a>
    
            <div class="docstring"><p>Alias for field number 2</p>
</div>


                            </div>
                </section>
                <section id="get_straight_line">
                            <input id="get_straight_line-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_straight_line</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">p1</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">Point</span>,</span><span class="param">	<span class="n">p2</span><span class="p">:</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">Point</span>,</span><span class="param">	<span class="n">perpendicular</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n"><a href="#StraightLine">StraightLine</a></span>:</span></span>

                <label class="view-source-button" for="get_straight_line-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_straight_line"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_straight_line-1059"><a href="#get_straight_line-1059"><span class="linenos">1059</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_straight_line</span><span class="p">(</span>
</span><span id="get_straight_line-1060"><a href="#get_straight_line-1060"><span class="linenos">1060</span></a>    <span class="n">p1</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span><span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">,</span>
</span><span id="get_straight_line-1061"><a href="#get_straight_line-1061"><span class="linenos">1061</span></a>    <span class="n">perpendicular</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="get_straight_line-1062"><a href="#get_straight_line-1062"><span class="linenos">1062</span></a>  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StraightLine</span><span class="p">:</span>
</span><span id="get_straight_line-1063"><a href="#get_straight_line-1063"><span class="linenos">1063</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return StraightLine p1-p2, optionally perpendicular through the midpoint.</span>
</span><span id="get_straight_line-1064"><a href="#get_straight_line-1064"><span class="linenos">1064</span></a>
</span><span id="get_straight_line-1065"><a href="#get_straight_line-1065"><span class="linenos">1065</span></a><span class="sd">  Args:</span>
</span><span id="get_straight_line-1066"><a href="#get_straight_line-1066"><span class="linenos">1066</span></a><span class="sd">    p1 (geom.Point): First point.</span>
</span><span id="get_straight_line-1067"><a href="#get_straight_line-1067"><span class="linenos">1067</span></a><span class="sd">    p2 (geom.Point): Second point</span>
</span><span id="get_straight_line-1068"><a href="#get_straight_line-1068"><span class="linenos">1068</span></a><span class="sd">    perpendicular (bool, optional): If True the perpendicular bisector is</span>
</span><span id="get_straight_line-1069"><a href="#get_straight_line-1069"><span class="linenos">1069</span></a><span class="sd">      returned. Defaults to False.</span>
</span><span id="get_straight_line-1070"><a href="#get_straight_line-1070"><span class="linenos">1070</span></a>
</span><span id="get_straight_line-1071"><a href="#get_straight_line-1071"><span class="linenos">1071</span></a><span class="sd">  Returns:</span>
</span><span id="get_straight_line-1072"><a href="#get_straight_line-1072"><span class="linenos">1072</span></a><span class="sd">    StraightLine: _description_</span>
</span><span id="get_straight_line-1073"><a href="#get_straight_line-1073"><span class="linenos">1073</span></a>
</span><span id="get_straight_line-1074"><a href="#get_straight_line-1074"><span class="linenos">1074</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_straight_line-1075"><a href="#get_straight_line-1075"><span class="linenos">1075</span></a>  <span class="k">if</span> <span class="n">perpendicular</span><span class="p">:</span>
</span><span id="get_straight_line-1076"><a href="#get_straight_line-1076"><span class="linenos">1076</span></a>    <span class="n">ls</span> <span class="o">=</span> <span class="n">affine</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">LineString</span><span class="p">([</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">]),</span> <span class="mi">90</span><span class="p">)</span>
</span><span id="get_straight_line-1077"><a href="#get_straight_line-1077"><span class="linenos">1077</span></a>    <span class="n">pts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ls</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
</span><span id="get_straight_line-1078"><a href="#get_straight_line-1078"><span class="linenos">1078</span></a>    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="get_straight_line-1079"><a href="#get_straight_line-1079"><span class="linenos">1079</span></a>    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="get_straight_line-1080"><a href="#get_straight_line-1080"><span class="linenos">1080</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="get_straight_line-1081"><a href="#get_straight_line-1081"><span class="linenos">1081</span></a>    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">y</span>
</span><span id="get_straight_line-1082"><a href="#get_straight_line-1082"><span class="linenos">1082</span></a>    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span>
</span><span id="get_straight_line-1083"><a href="#get_straight_line-1083"><span class="linenos">1083</span></a>  <span class="k">return</span> <span class="n">StraightLine</span><span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">y1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return StraightLine p1-p2, optionally perpendicular through the midpoint.</p>

<p>Args:
  p1 (geom.Point): First point.
  p2 (geom.Point): Second point
  perpendicular (bool, optional): If True the perpendicular bisector is
    returned. Defaults to False.</p>

<p>Returns:
  StraightLine: _description_</p>
</div>


                </section>
                <section id="get_intersection">
                            <input id="get_intersection-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_intersection</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">line1</span><span class="p">:</span> <span class="n"><a href="#StraightLine">StraightLine</a></span>,</span><span class="param">	<span class="n">line2</span><span class="p">:</span> <span class="n"><a href="#StraightLine">StraightLine</a></span></span><span class="return-annotation">) -> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">Point</span> <span class="o">|</span> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="get_intersection-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_intersection"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_intersection-1086"><a href="#get_intersection-1086"><span class="linenos">1086</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_intersection</span><span class="p">(</span><span class="n">line1</span><span class="p">:</span><span class="n">StraightLine</span><span class="p">,</span>
</span><span id="get_intersection-1087"><a href="#get_intersection-1087"><span class="linenos">1087</span></a>                     <span class="n">line2</span><span class="p">:</span><span class="n">StraightLine</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="o">|</span><span class="kc">None</span><span class="p">:</span>
</span><span id="get_intersection-1088"><a href="#get_intersection-1088"><span class="linenos">1088</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return point of intersection of straight lines.</span>
</span><span id="get_intersection-1089"><a href="#get_intersection-1089"><span class="linenos">1089</span></a>
</span><span id="get_intersection-1090"><a href="#get_intersection-1090"><span class="linenos">1090</span></a><span class="sd">  Args:</span>
</span><span id="get_intersection-1091"><a href="#get_intersection-1091"><span class="linenos">1091</span></a><span class="sd">    line1 (StraightLine): First straight line.</span>
</span><span id="get_intersection-1092"><a href="#get_intersection-1092"><span class="linenos">1092</span></a><span class="sd">    line2 (StraightLine): Second straight line.</span>
</span><span id="get_intersection-1093"><a href="#get_intersection-1093"><span class="linenos">1093</span></a>
</span><span id="get_intersection-1094"><a href="#get_intersection-1094"><span class="linenos">1094</span></a><span class="sd">  Returns:</span>
</span><span id="get_intersection-1095"><a href="#get_intersection-1095"><span class="linenos">1095</span></a><span class="sd">    geom.Point|None: Point is returned if the lines intersect, otherwise None.</span>
</span><span id="get_intersection-1096"><a href="#get_intersection-1096"><span class="linenos">1096</span></a>
</span><span id="get_intersection-1097"><a href="#get_intersection-1097"><span class="linenos">1097</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="get_intersection-1098"><a href="#get_intersection-1098"><span class="linenos">1098</span></a>  <span class="n">x_set</span><span class="p">,</span> <span class="n">y_set</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
</span><span id="get_intersection-1099"><a href="#get_intersection-1099"><span class="linenos">1099</span></a>  <span class="n">denominator</span> <span class="o">=</span> <span class="n">line1</span><span class="o">.</span><span class="n">A</span> <span class="o">*</span> <span class="n">line2</span><span class="o">.</span><span class="n">B</span> <span class="o">-</span> <span class="n">line2</span><span class="o">.</span><span class="n">A</span> <span class="o">*</span> <span class="n">line1</span><span class="o">.</span><span class="n">B</span>
</span><span id="get_intersection-1100"><a href="#get_intersection-1100"><span class="linenos">1100</span></a>  <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">line1</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">):</span>
</span><span id="get_intersection-1101"><a href="#get_intersection-1101"><span class="linenos">1101</span></a>    <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">line1</span><span class="o">.</span><span class="n">C</span> <span class="o">/</span> <span class="n">line1</span><span class="o">.</span><span class="n">B</span>
</span><span id="get_intersection-1102"><a href="#get_intersection-1102"><span class="linenos">1102</span></a>    <span class="n">y_set</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_intersection-1103"><a href="#get_intersection-1103"><span class="linenos">1103</span></a>  <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">line2</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">):</span>
</span><span id="get_intersection-1104"><a href="#get_intersection-1104"><span class="linenos">1104</span></a>    <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">line2</span><span class="o">.</span><span class="n">C</span> <span class="o">/</span> <span class="n">line2</span><span class="o">.</span><span class="n">B</span>
</span><span id="get_intersection-1105"><a href="#get_intersection-1105"><span class="linenos">1105</span></a>    <span class="n">y_set</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_intersection-1106"><a href="#get_intersection-1106"><span class="linenos">1106</span></a>  <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">line1</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">):</span>
</span><span id="get_intersection-1107"><a href="#get_intersection-1107"><span class="linenos">1107</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">line1</span><span class="o">.</span><span class="n">C</span> <span class="o">/</span> <span class="n">line1</span><span class="o">.</span><span class="n">A</span>
</span><span id="get_intersection-1108"><a href="#get_intersection-1108"><span class="linenos">1108</span></a>    <span class="n">x_set</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_intersection-1109"><a href="#get_intersection-1109"><span class="linenos">1109</span></a>  <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">line2</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">):</span>
</span><span id="get_intersection-1110"><a href="#get_intersection-1110"><span class="linenos">1110</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">line2</span><span class="o">.</span><span class="n">C</span> <span class="o">/</span> <span class="n">line2</span><span class="o">.</span><span class="n">A</span>
</span><span id="get_intersection-1111"><a href="#get_intersection-1111"><span class="linenos">1111</span></a>    <span class="n">x_set</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="get_intersection-1112"><a href="#get_intersection-1112"><span class="linenos">1112</span></a>  <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">denominator</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">):</span>
</span><span id="get_intersection-1113"><a href="#get_intersection-1113"><span class="linenos">1113</span></a>    <span class="k">return</span> <span class="kc">None</span>
</span><span id="get_intersection-1114"><a href="#get_intersection-1114"><span class="linenos">1114</span></a>  <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x_set</span> <span class="k">else</span> <span class="p">(</span><span class="n">line1</span><span class="o">.</span><span class="n">B</span> <span class="o">*</span> <span class="n">line2</span><span class="o">.</span><span class="n">C</span> <span class="o">-</span> <span class="n">line2</span><span class="o">.</span><span class="n">B</span> <span class="o">*</span> <span class="n">line1</span><span class="o">.</span><span class="n">C</span><span class="p">)</span> <span class="o">/</span> <span class="n">denominator</span>
</span><span id="get_intersection-1115"><a href="#get_intersection-1115"><span class="linenos">1115</span></a>  <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="k">if</span> <span class="n">y_set</span> <span class="k">else</span> <span class="p">(</span><span class="n">line1</span><span class="o">.</span><span class="n">C</span> <span class="o">*</span> <span class="n">line2</span><span class="o">.</span><span class="n">A</span> <span class="o">-</span> <span class="n">line2</span><span class="o">.</span><span class="n">C</span> <span class="o">*</span> <span class="n">line1</span><span class="o">.</span><span class="n">A</span><span class="p">)</span> <span class="o">/</span> <span class="n">denominator</span>
</span><span id="get_intersection-1116"><a href="#get_intersection-1116"><span class="linenos">1116</span></a>  <span class="k">return</span> <span class="n">geom</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return point of intersection of straight lines.</p>

<p>Args:
  line1 (StraightLine): First straight line.
  line2 (StraightLine): Second straight line.</p>

<p>Returns:
  geom.Point|None: Point is returned if the lines intersect, otherwise None.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>